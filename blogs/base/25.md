---
title: 25-Umi
date: 2028-12-15
sticky: 1
sidebar: 'auto'
tags:
 - js
categories:
 - base
---


## 一，umi介绍



学习umi，分两块学习

- umi
- umi max(Ant Design Pro)



### 1，什么是umi

官网：https://umijs.org/

![1712559684917](./assets/1712559684917.png)



版本：

- v3  
- v4  直接学习v4版本





学习umi，直接看人家的文档。



### 2，项目创建 

创建项目，官方推荐使用pnpm，安装pnpm，如下：

```
npm i pnpm -g
```

![1712560057866](./assets/1712560057866.png)



创建文件夹，在cmd中进入到文件夹中：

![1712560136942](./assets/1712560136942.png)



创建项目：

![1712560207999](./assets/1712560207999.png)

![1712560328793](./assets/1712560328793.png)



使用vscode打开项目：

![1712560532472](./assets/1712560532472.png)



在后面小代码时，可能会使用到其它的依赖，先安装一下：

```
npm i antd@5.1.2 qs styled-components@5 @umijs/plugins
```



安装完毕后：

![1712567680037](./assets/1712567680037.png)





运行项目：

![1712560788650](./assets/1712560788650.png)



访问项目：

![1712560814235](./assets/1712560814235.png)





### 3，项目目录分析

人家推荐的目录结构如下：https://umijs.org/docs/guides/directory-structure



```
.
├── config
│   └── config.ts
├── dist
├── mock
│   └── app.ts｜tsx
├── src
│   ├── .umi
│   ├── .umi-production
│   ├── layouts
│   │   ├── BasicLayout.tsx
│   │   ├── index.less
│   ├── models
│   │   ├── global.ts
│   │   └── index.ts
│   ├── pages
│   │   ├── index.less
│   │   └── index.tsx
│   ├── utils // 推荐目录
│   │   └── index.ts
│   ├── services // 推荐目录
│   │   └── api.ts
│   ├── app.(ts|tsx)
│   ├── global.ts
│   ├── global.(css|less|sass|scss)
│   ├── overrides.(css|less|sass|scss)
│   ├── favicon.(ico|gif|png|jpg|jpeg|svg|avif|webp)
│   └── loading.(tsx|jsx)
├── node_modules
│   └── .cache
│       ├── bundler-webpack
│       ├── mfsu
│       └── mfsu-deps
├── .env
├── plugin.ts 
├── .umirc.ts // 与 config/config 文件 2 选一
├── package.json
├── tsconfig.json
└── typings.d.ts
```



.env文件：

![1712561065853](./assets/1712561065853.png)



除了.env文件中可以设置环境变量之外，还可以使用cross-env设置环境变量，如在package.json中：

```
"dev":cross-env PORT=3333 HOST=127.0.0.1 umi dev
```



.umirc.ts 这个文件是对webpack进行配置，*config/config.ts* 也可以对webpack进行配置，`.umirc.ts` 文件优先级较高。配置的都是非运行配置（webpack配置），运行配置一般都是放在app.ts中。

![1712561229231](./assets/1712561229231.png)

```ts
import { defineConfig } from "umi";

export default defineConfig({
  routes: [
    { path: "/", component: "index" },
    { path: "/docs", component: "docs" },
  ],
  npmClient: 'pnpm',
});
```



创建config.ts，配置都放在config.ts中，如下：

![1712561359872](./assets/1712561359872.png)



这样，就可以把umirc.ts删除了。运行配置都是放在app.ts中，如下：

![1712561533228](./assets/1712561533228.png)



public目录：

![1712561917326](./assets/1712561917326.png)



layout：

![1712562363759](./assets/1712562363759.png)



pages:

![1712562445726](./assets/1712562445726.png)



放在pages下面的组件，会自动生成路由，也就是说不需要配置路由，这种路由，叫约定式路由：

![1712562562025](./assets/1712562562025.png)

![1712562774775](./assets/1712562774775.png)

![1712562823057](./assets/1712562823057.png)



创建一个count组件，如下：

![1712562895221](./assets/1712562895221.png)



404组件：

![1712563016549](./assets/1712563016549.png)



global.tsx:

![1712563132744](./assets/1712563132744.png)



global.less, umi自动开启了 css modules以及它配置好了less，sass：

![1712563235362](./assets/1712563235362.png)





loading.tsx:

![1712563406075](./assets/1712563406075.png)

```tsx
// 当路由懒加载时，匹配到的组件，加载非常慢时，可以先显示一个loading效果

export default ()=>{
    return <div>
        加载中.... 
    </div>
}
```



favicon.ico :

![1712563586766](./assets/1712563586766.png)







## 二，umi路由



### 1，约定式路由

说白了，就是不需要写去路由表，直接创建组件，人家会根据创建的组件，在内部生成路由表。创建几个组件：

![1712564915890](./assets/1712564915890.png)

```tsx
const HomePage = () => {
  return (
      <div>
          <h1>Vote</h1>
      </div>
  );
};

export default HomePage;
```

```tsx
const CountPage = () => {
    return (
        <div>
            <h1>计数器</h1>
        </div>
    );
};

export default CountPage;
```

```tsx
const UserPage = () => {
    return (
        <div>
            <h1>个人中心</h1>
        </div>
    );
};

export default UserPage;
```

```tsx
const Order = () => {
    return (
        <div>
            <h1>我的订单</h1>
        </div>
    );
};

export default Order;
```

```tsx
const Profile = () => {
    return (
        <div>
            <h1>我的信息</h1>
        </div>
    );
};

export default Profile;
```

```tsx
const Error = () => {
    return (
        <div>
            <p>你的页面飞走了~</p>
        </div>
    );
};

export default Error;
```



测试：

![1712565088134](./assets/1712565088134.png)



在layout组件中配置导航：

![1712565632262](./assets/1712565632262.png)

```tsx
import { NavLink, Outlet } from 'umi';
import styled from 'styled-components';

let StyleLayoutBox = styled.div`
  .nav-box{
    height:50px;
    border-bottom:1px solid red;

    a{
      margin-right:20px;
      color:#000;
      text-decoration:none;
      font-size:20px;
      &.active{
        color:red;
      }
    }
  }
`;

export default function Layout() {
  return (
    <StyleLayoutBox>
      <div className="nav-box">
          <NavLink to="/">Vote</NavLink>
          <NavLink to="/count">计算器</NavLink>
          <NavLink to="/user">个人中心</NavLink>
      </div>
      <Outlet />
    </StyleLayoutBox>
  );
}
```



效果：

![1712565659653](./assets/1712565659653.png)



配置二级路由：

![1712566076835](./assets/1712566076835.png)

```tsx
import { NavLink, Outlet } from 'umi';
import styled from 'styled-components';

let StyleUserBox = styled.div`
  display:flex;
  .menu{
    display:flex;
    flex-direction:column;
    margin-right:20px;
    margin-top:20px;
    a{
        color:#000;
        &.active{
            color:blue;
        }
    }
  }
`;

const UserPage = () => {
    return (
        <StyleUserBox>
            <div className='menu'>
                <NavLink to="/user/order">订单管理</NavLink>
                <NavLink to="/user/profile">个人信息</NavLink>
            </div>
            <div className="content">
                <Outlet/>
            </div>
        </StyleUserBox>
    );
};

export default UserPage;
```



从始至终并没有配置路由表，叫约束式路由。

![1712566181727](./assets/1712566181727.png)



上面每一个组件默认都实现了懒加载的，不需要我们任何配置。



### 2，配置式路由

在config目录下面创建一个routes.ts文件，在这里配置路由，如下：

![1712566926354](./assets/1712566926354.png)

```ts
const routes = [
    {
        path: "/",
        // 自动会去pages目录下查找，也可以也指定目录
        // component:'@/a/b'
        component: 'index',
        title:"首页"
    },{
        path: "/count",
        component: 'count',
        title:"计数器"
    },{
        path: "/user",
        component: 'user',
        title:"个人中心",
        routes:[
            {
                path: "/user",
                redirect: '/user/order',
            },
            {
                path: "/user/order",
                component: 'user/order',
                title:"订单页"
            },
            {
                path: "/user/profile",
                component: 'user/profile',
                title:"个人信息"
            }
        ]
    },{
        path: "*",
        component: '404',
    }
];

export default routes;
```



在config.ts中启用：

![1712566968881](./assets/1712566968881.png)



前面写了一个loading.tsx。因为组件都是懒加载，如果网络比较慢，会先走laoding组件，如下：

![1712567052521](./assets/1712567052521.png)



看一下loading组件，如下：

![1712567081100](./assets/1712567081100.png)



要使用antd，需要开启一个配置：

![1712568534515](./assets/1712568534515.png)



可以美化一下loading组件：

![1712567148788](./assets/1712567148788.png)

![1712568863701](./assets/1712568863701.png)



```tsx
import { Spin } from "antd"
import styled from "styled-components"

const StyledLoadingBox = styled.div`
    position: fixed;
    top:0;
    left:0; 
    width: 100%;
    height: 100%;
    z-index: 999;
    background-color: rgba(0, 0, 0, .5);
    .ant-spin{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
    }
`;


export default ()=>{
    return <StyledLoadingBox>
        <Spin size="large" tip="加载中..." />
    </StyledLoadingBox>
}
```



效果：

![1712568847738](./assets/1712568847738.png)



### 3，路由跳转传参





## 三，umi配置





## 四，Models



在umi中，不说models，和dva中的model类似。 在umi max(Ant Design Pro)再去说Models。













