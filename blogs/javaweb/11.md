---
title: 新版Mybatis
date: 2028-12-15
sticky: 1
sidebar: 'auto'
tags:
 - javaweb
categories:
 -  javaweb
---



### 1，什么是框架

框架即一个半成品软件。开发者从头开发一个软件需要花费大量精力，于是有一些项目组开发出半成品软件，开发者在这些软件的基 础上进行开发，这样的软件就称之为框架。 



如果将开发完成的软件比作是一套已经装修完毕的新房，框架就好比是一套已经修建好的毛坯房。用户直接购买毛坯房，保证建筑质量和户型合理的同时可以进行风格的自由装修。



使用框架开发的好处：

- 省去大量的代码编写、减少开发时间、降低开发难度
- 限制程序员必须使用框架规范开发，增强代码的规范性，降低程序员之间沟通及日后维护的成本。 
- 将程序员的注意力从技术中抽离出来，更集中在业务层面。



使用框架就好比和世界上最优秀的软件工程师共同完成一个项目， 并且他们完成的还是基础、全局的工作。

![1721707814607](assets/1721707814607.png)



ORM（Object Relationl Mapping），对象关系映射，即在数据库和对象之间作映射处理。 之前我们使用JDBC操作数据库，必须手动进行数据库和对象间的数据转换。看一下JDBC中的新增和查询。可以看到，数据库数据与对象数据的转换代码繁琐、无技术含量。而使用ORM框架代替JDBC后，框架可以帮助程序员自动进行转换，只要像平时一样操作对象，ORM框架就会根据映射完成对数据 库的操作，极大的增强了开发效率。 



### 2，ORM框架

MyBatis是一个半自动的ORM框架，其本质是对JDBC的封装。使用MyBatis不需要写JDBC代码，但需要程序员编写SQL语句。之前是apache的一个开源项目iBatis，2010年改名为MyBatis。 



### 3，MyBatis介绍

MyBatis 是一款优秀的**持久层**框架，用于简化 JDBC 开发。它本是 Apache 的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。2013年11月迁移到Github。



官网：https://mybatis.org/mybatis-3/zh/index.html 



什么是持久层：

- 所谓持久层就是负责将数据到保存到数据库的那一层代码。JavaEE三层架构：表现层、业务层、**持久层**。



### 4，入门案例



步骤：

1. 将SQL文件导入数据库
2. 创建maven工程，引入依赖
3. 创建mybatis核心配置文件SqlMapConfig.xml
4. 将log4j.properties文件放入resources中，让控制台打印SQL语句。 
5. 创建实体类
6. 在java目录创建持久层接口
7. 在resource目录创建映射文件
8. 将映射文件配置到mybatis核心配置文件中
9. 测试持久层接口方法





映射文件注意事项：

- 映射文件要和接口名称相同。
- 映射文件要和接口的目录结构相同。
- 映射文件中namespace属性要写接口的全名。
- 映射文件中标签的id属性是接口方法的方法名。
- 映射文件中标签的resultType属性是接口方法的返回值类型。
- 映射文件中标签的parameterType属性是接口方法的参数类型。
- 映射文件中resultType、parameterType属性要写全类名，如果是集合类型，则写其泛型的全类名。











### 5，MyBatis核心对象及工作流程

![1721708265810](assets/1721708265810.png)



MyBatis核心对象：

- SqlSessionFactoryBuilder   SqlSession工厂构建者对象，使用构造者模式创建SqlSession工厂对象
- SqlSessionFactory   SqlSession工厂，使用工厂模式创建SqlSession对象。
- SqlSession    该对象可以操作数据库，也可以使用动态代理模式创建持久层接口的代理对象操作数据库。 
- Mapper   持久层接口的代理对象，他具体实现了持久层接口，用来操作数据库。



MyBatis工作流程：

- 创建SqlSessionFactoryBuilder对象
- SqlSessionFactoryBuilder对象构建了SqlSessionFactory对象：构造者模式
- SqlSessionFactory对象生产了SqlSession对象：工厂模式
- SqlSession对象创建了持久层接口的代理对象：动态代理模式
- 代理对象操作数据库









### 6，使用SqlSession操作数据库

除了代理对象能够操作数据库，SqlSession也能操作数据库。只是这种方式在开发中使用的较少，接下来我们使用SqlSession操作数据库：







### 7，MyBatis新增

持久层接口添加方法：



```java

```



映射文件添加标签:



```xml

```



编写测试方法:



```java

```





注意：

- 当接口方法的参数类型为POJO类型时，SQL语句中绑定参数时使用 #{POJO的属性名} 即可。
- MyBatis事务默认手动提交，所以在执行完增删改方法后，需要手动调用SqlSession对象的事务提交方法，否则数据库将不发生改变。 







### 8，MyBatis修改

我们发现MyBatis的测试方法在操作数据库前都需要获取代理对象，操作数据库后都需要释放资源，可以利用Junit的前置后置方法，优化测试类代码。 



这样Junit就会自动执行获取代理对象和释放资源的方法。



持久层接口添加方法：



```java

```



映射文件添加标签:



```xml

```



编写测试方法:



```java

```





### 9，MyBatis删除和根据ID查询



持久层接口添加方法：



```java

```



映射文件添加标签:



```xml

```



注意：

- 当方法的参数类型是简单数据类型时，#{}中可以写任意名称
- 简单数据类型：基本数据类型、字符串等



编写测试方法:



```java

```



接下来再根据ID查询用户，操作流程如下，持久层接口添加方法：



```java

```



映射文件添加标签:



```xml

```



编写测试方法:



```java

```





### 10，MyBatis模糊查询



持久层接口添加方法：

```java

```



映射文件添加标签:

```xml

```



编写测试方法:

```java

```





我们看到在映射文件中，parameterType的值为 string 而没有写java.lang.String ，这是为什么呢？

- 参数/返回值类型为基本数据类型/包装类/String等类型时，我们可以写全类名，也可以写别名。 

![1721708758684](assets/1721708758684.png)



模糊查询如果不想在调用方法时参数加%，可以使用拼接参数的方式设置Sql： 

```xml

```



测试方法写法如下：

```java

```



#和$的区别：

- #表示sql模板的占位符，$表示将字符串拼接到sql模板中
- #可以防止sql注入，一般能用#就不用$。
- ${}内部的参数名必须写value。



如果使用 # 还不想在调用方法的参数中添加 % ，可以使用 bind>， bind 允许我们在 Sql语句以外创建一个变量，并可以将其绑定到当前的Sql语句中。用法如下： 

```xml

```



测试方法写法如下：

```java

```



### 11，MyBatis分页查询

![1721708934341](assets/1721708934341.png)

分页查询时，Sql语句使用limit关键字，需要传入开始索引和每页条数两个参数。MyBatis的多参数处理有以下方式：

- 顺序传参
- @Param传参



Sql中的参数使用arg0，arg1...或param1，param2...表示参数的顺序。此方法可读性较低，在开发中不建议使用。

持久层接口方法：

```java

```



映射文件:

```java

```



测试类:

```java

```



在接口方法的参数列表中通过@Param定义参数名称，在Sql语句中通过注解中所定义的参数名称指定参数位置。此方式参数比较直观的，推荐使用。 



持久层接口方法:

```java

```



映射文件:

```xml

```



测试类:

```java

```





自定义POJO类，该类的属性就是要传递的参数，在SQL语句中绑定参数时使用POJO的属性名作为参数名即可。此方式推荐使用。自定义POJO：

```java

```



持久层接口方法:

```java

```



映射文件:

```xml

```



测试类：

```java

```



如果不想自定义POJO，可以使用Map作为传递参数的载体，在SQL语句中绑定参数时使用Map的Key作为参数名即可。此方法推荐使用。持久层接口方法:

```java

```



映射文件:

```xml

```



测试类：

```java

```



### 12，MyBatis聚合查询，主键回填

持久层接口方法:

```java

```



映射文件:

```xml

```



测试类：

```java

```



有时我们需要获取新插入数据的主键值。如果数据库中主键是自增的，这时我们就需要使用MyBatis的主键回填功能。 

持久层接口方法:

```java

```



映射文件:

```xml

```



注意：

- SELECT LAST_INSERT_ID()：查询刚刚插入的记录的主键值，只适用于自增主键，且必须和insert语句一起执行。 



测试类：

```java

```



### 13，MyBatis配置文件





### 14，MyBatis映射文件



### 15，MyBatis动态SQL



### 16，缓存



### 17，关联查询



### 18，一对一关联查询



### 19，一对多关联查询



### 20，多对多关联查询



### 21，分解式查询一对多



### 22，分解式查询一对一



### 23，MyBatis延迟加载



### 23，注解开发



### 24，注解开发之增删改查



### 25，注解开发动态SQL



### 26，注解开发自定义映射关系



### 27，注解开发二级缓存



### 28，注解开发一对一



### 29，注解开发一对多



### 30，注解开发成映射文件开发对比



### 31，分页插件







