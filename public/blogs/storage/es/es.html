<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES | 码路全栈开发</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/javablog/public/favicon.ico">
    <meta name="description" content="快来玩java全栈呀">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/javablog/public/assets/css/0.styles.0bd56f36.css" as="style"><link rel="preload" href="/javablog/public/assets/js/app.42e86726.js" as="script"><link rel="preload" href="/javablog/public/assets/js/66.fc23a08c.js" as="script"><link rel="preload" href="/javablog/public/assets/js/1.3c422ec2.js" as="script"><link rel="preload" href="/javablog/public/assets/js/22.2af5b9b8.js" as="script"><link rel="prefetch" href="/javablog/public/assets/js/10.298ca43f.js"><link rel="prefetch" href="/javablog/public/assets/js/100.5e641bde.js"><link rel="prefetch" href="/javablog/public/assets/js/101.d7a04606.js"><link rel="prefetch" href="/javablog/public/assets/js/102.78be7c0f.js"><link rel="prefetch" href="/javablog/public/assets/js/103.28adb148.js"><link rel="prefetch" href="/javablog/public/assets/js/11.90f292aa.js"><link rel="prefetch" href="/javablog/public/assets/js/12.c1c9dc17.js"><link rel="prefetch" href="/javablog/public/assets/js/13.6c7ba89e.js"><link rel="prefetch" href="/javablog/public/assets/js/14.3b6b858f.js"><link rel="prefetch" href="/javablog/public/assets/js/15.8ebbbc93.js"><link rel="prefetch" href="/javablog/public/assets/js/16.62ddb86a.js"><link rel="prefetch" href="/javablog/public/assets/js/17.ad5c72d7.js"><link rel="prefetch" href="/javablog/public/assets/js/18.6580802e.js"><link rel="prefetch" href="/javablog/public/assets/js/19.d27f3340.js"><link rel="prefetch" href="/javablog/public/assets/js/20.fe3c36fe.js"><link rel="prefetch" href="/javablog/public/assets/js/21.8dc17511.js"><link rel="prefetch" href="/javablog/public/assets/js/23.c0eaa2df.js"><link rel="prefetch" href="/javablog/public/assets/js/24.96a979ca.js"><link rel="prefetch" href="/javablog/public/assets/js/25.858e3596.js"><link rel="prefetch" href="/javablog/public/assets/js/26.1e4abee4.js"><link rel="prefetch" href="/javablog/public/assets/js/27.b5d49d81.js"><link rel="prefetch" href="/javablog/public/assets/js/28.cf15e2b7.js"><link rel="prefetch" href="/javablog/public/assets/js/29.9fe25a75.js"><link rel="prefetch" href="/javablog/public/assets/js/3.7aed6518.js"><link rel="prefetch" href="/javablog/public/assets/js/30.8f54025a.js"><link rel="prefetch" href="/javablog/public/assets/js/31.e03a578a.js"><link rel="prefetch" href="/javablog/public/assets/js/32.ffe44d2e.js"><link rel="prefetch" href="/javablog/public/assets/js/33.84259630.js"><link rel="prefetch" href="/javablog/public/assets/js/34.ca79f0b5.js"><link rel="prefetch" href="/javablog/public/assets/js/35.4bc788f7.js"><link rel="prefetch" href="/javablog/public/assets/js/36.cfe0840c.js"><link rel="prefetch" href="/javablog/public/assets/js/37.86312d23.js"><link rel="prefetch" href="/javablog/public/assets/js/38.6b4f43b7.js"><link rel="prefetch" href="/javablog/public/assets/js/39.b27a8872.js"><link rel="prefetch" href="/javablog/public/assets/js/4.6084835f.js"><link rel="prefetch" href="/javablog/public/assets/js/40.651724e8.js"><link rel="prefetch" href="/javablog/public/assets/js/41.dcab5f3e.js"><link rel="prefetch" href="/javablog/public/assets/js/42.c406a126.js"><link rel="prefetch" href="/javablog/public/assets/js/43.d7c93c59.js"><link rel="prefetch" href="/javablog/public/assets/js/44.4b0baec4.js"><link rel="prefetch" href="/javablog/public/assets/js/45.032f9356.js"><link rel="prefetch" href="/javablog/public/assets/js/46.19fcc8b0.js"><link rel="prefetch" href="/javablog/public/assets/js/47.3e4ea65a.js"><link rel="prefetch" href="/javablog/public/assets/js/48.20e498f5.js"><link rel="prefetch" href="/javablog/public/assets/js/49.40070491.js"><link rel="prefetch" href="/javablog/public/assets/js/5.365bd61e.js"><link rel="prefetch" href="/javablog/public/assets/js/50.5345a98e.js"><link rel="prefetch" href="/javablog/public/assets/js/51.ed17677c.js"><link rel="prefetch" href="/javablog/public/assets/js/52.4a151cd1.js"><link rel="prefetch" href="/javablog/public/assets/js/53.9c50e524.js"><link rel="prefetch" href="/javablog/public/assets/js/54.477ea339.js"><link rel="prefetch" href="/javablog/public/assets/js/55.a59b5427.js"><link rel="prefetch" href="/javablog/public/assets/js/56.4d0b9aa2.js"><link rel="prefetch" href="/javablog/public/assets/js/57.d5238304.js"><link rel="prefetch" href="/javablog/public/assets/js/58.0425e626.js"><link rel="prefetch" href="/javablog/public/assets/js/59.f37d6a28.js"><link rel="prefetch" href="/javablog/public/assets/js/6.69ae9257.js"><link rel="prefetch" href="/javablog/public/assets/js/60.55c99fed.js"><link rel="prefetch" href="/javablog/public/assets/js/61.347b3158.js"><link rel="prefetch" href="/javablog/public/assets/js/62.7af79e55.js"><link rel="prefetch" href="/javablog/public/assets/js/63.f6a2979c.js"><link rel="prefetch" href="/javablog/public/assets/js/64.6493846c.js"><link rel="prefetch" href="/javablog/public/assets/js/65.d9d807b8.js"><link rel="prefetch" href="/javablog/public/assets/js/67.2edb9191.js"><link rel="prefetch" href="/javablog/public/assets/js/68.a688c5db.js"><link rel="prefetch" href="/javablog/public/assets/js/69.028e65bc.js"><link rel="prefetch" href="/javablog/public/assets/js/7.490a09f0.js"><link rel="prefetch" href="/javablog/public/assets/js/70.33c95df3.js"><link rel="prefetch" href="/javablog/public/assets/js/71.511d082a.js"><link rel="prefetch" href="/javablog/public/assets/js/72.d2d6c305.js"><link rel="prefetch" href="/javablog/public/assets/js/73.3613d619.js"><link rel="prefetch" href="/javablog/public/assets/js/74.da6c2196.js"><link rel="prefetch" href="/javablog/public/assets/js/75.6a36b292.js"><link rel="prefetch" href="/javablog/public/assets/js/76.fdaea841.js"><link rel="prefetch" href="/javablog/public/assets/js/77.34d1cc41.js"><link rel="prefetch" href="/javablog/public/assets/js/78.17298605.js"><link rel="prefetch" href="/javablog/public/assets/js/79.4c40bbed.js"><link rel="prefetch" href="/javablog/public/assets/js/8.719aa209.js"><link rel="prefetch" href="/javablog/public/assets/js/80.c8538f64.js"><link rel="prefetch" href="/javablog/public/assets/js/81.54f24d5e.js"><link rel="prefetch" href="/javablog/public/assets/js/82.ad075798.js"><link rel="prefetch" href="/javablog/public/assets/js/83.348df900.js"><link rel="prefetch" href="/javablog/public/assets/js/84.533cfd9a.js"><link rel="prefetch" href="/javablog/public/assets/js/85.8a39fdba.js"><link rel="prefetch" href="/javablog/public/assets/js/86.f4d59a35.js"><link rel="prefetch" href="/javablog/public/assets/js/87.a4b7c682.js"><link rel="prefetch" href="/javablog/public/assets/js/88.933e1355.js"><link rel="prefetch" href="/javablog/public/assets/js/89.93306285.js"><link rel="prefetch" href="/javablog/public/assets/js/9.35060bb0.js"><link rel="prefetch" href="/javablog/public/assets/js/90.cd75e9f6.js"><link rel="prefetch" href="/javablog/public/assets/js/91.b547f0d4.js"><link rel="prefetch" href="/javablog/public/assets/js/92.13b3b5ad.js"><link rel="prefetch" href="/javablog/public/assets/js/93.861c987d.js"><link rel="prefetch" href="/javablog/public/assets/js/94.93433866.js"><link rel="prefetch" href="/javablog/public/assets/js/95.20454e4e.js"><link rel="prefetch" href="/javablog/public/assets/js/96.51d3e5c2.js"><link rel="prefetch" href="/javablog/public/assets/js/97.72782439.js"><link rel="prefetch" href="/javablog/public/assets/js/98.2962da0c.js"><link rel="prefetch" href="/javablog/public/assets/js/99.e9382e65.js">
    <link rel="stylesheet" href="/javablog/public/assets/css/0.styles.0bd56f36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>码路全栈开发</h3> <p class="description" data-v-59e6cb88>快来玩java全栈呀</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>码路</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javablog/public/" class="home-link router-link-active"><img src="/javablog/public/logo.png" alt="码路全栈开发" class="logo"> <span class="site-name">码路全栈开发</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javablog/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      全栈开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javase/" class="nav-link"><i class="undefined"></i>
  javase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/javablog/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/javablog/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/javablog/public/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    码路
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>93</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>24</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/javablog/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      全栈开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javase/" class="nav-link"><i class="undefined"></i>
  javase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/javablog/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/javablog/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>ES</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>码路</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">ES</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>码路</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>12/15/2028</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>es</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="一-es初识"><a href="#一-es初识" class="header-anchor">#</a> 一，ES初识</h2> <h3 id="_1-elasticsearch介绍"><a href="#_1-elasticsearch介绍" class="header-anchor">#</a> 1，Elasticsearch介绍</h3> <p><img src="/javablog/public/assets/img/1717390676489.6d7ebd50.png" alt="1717390676489"></p> <p>Elasticsearch是一个全文检索服务器，全文检索是一种非结构化数据的<strong>搜索方式</strong>。</p> <ul><li><p>结构化数据：指具有固定格式固定长度的数据，如数据库中的字段。</p> <p><img src="/javablog/public/assets/img/1717390722610.44504adf.png" alt="1717390722610"></p></li> <li><p>非结构化数据：指格式和长度不固定的数据，如电商网站的商品详情。</p> <p><img src="/javablog/public/assets/img/1717390770613.3048d6bb.png" alt="1717390770613"></p></li></ul> <h3 id="_2-什么是倒排索引"><a href="#_2-什么是倒排索引" class="header-anchor">#</a> 2，什么是倒排索引</h3> <p><img src="/javablog/public/assets/img/1717390838344.c1b195be.png" alt="1717390838344"></p> <p><strong>索引：</strong></p> <p>将数据中的一部分信息提取出来，重新组织成一定的数据结构，我们可以根据该结构进行快速搜索，这样的结构称之为索引。索引即目录，例如字典会将字的拼音提取出来做成目录，通过目录即可快速找到字的位置。索引分为<strong>正排索引</strong>和<strong>倒排索引</strong>。</p> <p><strong>正排索引（正向索引）：</strong></p> <p>将文档id建立为索引，通过id快速可以快速查找数据。如数据库中的主键就会创建正排索引。</p> <p><img src="/javablog/public/assets/img/1717391188564.afbf28b4.png" alt="1717391188564"></p> <p><strong>倒排索引（反向索引）：</strong></p> <p>非结构化数据中我们往往会根据关键词查询数据。此时我们将数据中的关键词建立为索引，指向文档数据，这样的索引称为倒排索引。</p> <p><img src="/javablog/public/assets/img/1717390966693.4a94a9dc.png" alt="1717390966693"></p> <p>创建倒排索引流程：</p> <p><img src="/javablog/public/assets/img/1717391379816.a1e44d6d.png" alt="1717391379816"></p> <h3 id="_3-es的出现和应用场景"><a href="#_3-es的出现和应用场景" class="header-anchor">#</a> 3，ES的出现和应用场景</h3> <p>多年前，一个刚结婚的名叫Shay的失业开发者，跟着妻子去了伦敦，他的妻子在那里学习厨师。Shay使用全文检索工具——lucene，给他的妻子做一个食谱搜索引擎。</p> <p><img src="/javablog/public/assets/img/1717391477679.486dac45.png" alt="1717391477679"></p> <p>但Lucene的操作非常复杂，且Lucene是一个单机软件，不支持联网访问。因此 Shay基于Lucene开发了开源项目 Elasticsearch。Elasticsearch本质是一个java语言开发的web项目，我们可以通过RESTful风格的接口访问该项目内部的Lucene，从而让全文搜索变得简单。</p> <p><img src="/javablog/public/assets/img/1717391543959.576b49a1.png" alt="1717391543959"></p> <p>从此以后，Elasticsearch成为了Github上最活跃的项目之一， Elastic公司围绕Elasticsearch提供商业服务，并开发新的特性。Elasticsearch将永远开源并对所有人可用。</p> <p><strong>Elasticsearch应用场景：</strong></p> <p><img src="/javablog/public/assets/img/1717391618188.6c1f07be.png" alt="1717391618188"></p> <ul><li>2013年初，GitHub抛弃了Solr，采取Elasticsearch来做PB级的搜索。GitHub使用Elasticsearch搜索20TB 的数据，包括13亿文件和1300亿行代码。</li> <li>维基百科：以Elasticsearch为基础的核心搜索架构。</li> <li>百度：百度目前广泛使用Elasticsearch作为文本数据分析，采集百度所有服务器上的各类指标数据及用户自定义数据。目前覆盖百度内部20多个业务线（包括casio、云分析、网盟、预测、文库、直达号、钱包、风控等），单集群最大100台机器，200个ES节点，每天导入30TB+数据</li> <li>新浪使用ES分析处理32亿条实时日志。</li> <li>阿里使用ES构建自己的日志采集和分析体系。</li> <li>我们可以使用Elasticsearch实现全站搜索，线上商城系统的搜索，分析日志等功能。</li></ul> <h3 id="_4-es对比solr"><a href="#_4-es对比solr" class="header-anchor">#</a> 4，ES对比Solr</h3> <p><img src="/javablog/public/assets/img/1717391714976.7061a23b.png" alt="1717391714976"></p> <p>Solr也是基于Lucene的一款全文搜索引擎，下面是他们的对比。</p> <ul><li>Solr利用Zookeeper进行分布式管理，而Elasticsearch自身带有分布式协调管理功能;</li> <li>Solr支持更多格式的数据，而Elasticsearch仅支持json文件格式；</li> <li>Solr官方提供的功能更多，而Elasticsearch本身更注重于核心功能，高级功能多由第三方插件提供；</li> <li>Solr在传统的搜索应用中表现好于Elasticsearch，但在处理实时搜索应用时效率明显低于Elasticsearch。</li></ul> <p>目前Elasticsearch的市场占有率越来越高，Spring从2020年起也已经停止Spring Data Solr的维护，更多的公司使用Elasticsearch作为搜索引擎。</p> <h3 id="_5-es数据结构"><a href="#_5-es数据结构" class="header-anchor">#</a> 5，ES数据结构</h3> <p>相关概念：</p> <ul><li><strong>文档（Document）</strong>：文档是可被查询的最小数据单元，一个 Document 就是一条数据。类似于关系型数据库中的记录的概念。</li> <li><strong>类型（Type）</strong>：具有一组共同字段的文档定义成一个类型，类似于关系型数据库中的数据表的概念。</li> <li><strong>索引（Index）</strong>：索引是多种类型文档的集合，类似于关系型数据库中的库的概念。</li> <li><strong>域（Filed）</strong>：文档由多个域组成，类似于关系型数据库中的字段的概念。</li></ul> <p>Elasticsearch跟关系型数据库中概念的对比：</p> <table><thead><tr><th>JAVA项目</th> <th>项目</th> <th>实体类</th> <th>对象</th> <th>属性</th></tr></thead> <tbody><tr><td>ES</td> <td>Index</td> <td>Type</td> <td>Document</td> <td>Filed</td></tr> <tr><td>Mysql</td> <td>Database</td> <td>Table</td> <td>Row</td> <td>Column</td></tr></tbody></table> <p>注意：ES7.X之后删除了type的概念，一个索引不会代表一个库，而是代表一张表。我们课程中使用ES8，所以目前的ES中概念对比为：</p> <table><thead><tr><th>JAVA项目</th> <th>项目</th> <th>实体类</th> <th>对象</th> <th>属性</th></tr></thead> <tbody><tr><td>ES</td> <td></td> <td>Index</td> <td>Document</td> <td>Filed</td></tr> <tr><td>Mysql</td> <td>Database</td> <td>Table</td> <td>Row</td> <td>Column</td></tr></tbody></table> <h3 id="_6-安装es"><a href="#_6-安装es" class="header-anchor">#</a> 6，安装ES</h3> <ol><li><p>准备一台搭载有CentOS7系统的虚拟机，使用XShell连接虚拟机</p></li> <li><p>关闭防火墙，方便访问ES</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#关闭防火墙：
systemctl stop firewalld.service


#禁止防火墙自启动：
systemctl disable firewalld.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>配置最大可创建文件数大小</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#打开系统文件：
vim /etc/sysctl.conf


#添加以下配置：
vm.max_map_count=655360


#配置生效：
sysctl -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>由于ES不能以root用户运行，我们需要创建一个非root用户，此处创建一个名为es的用户</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#创建用户：
useradd es
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <p><strong>安装服务:</strong></p> <ol><li><p>使用rz命令将linux版的ES上传至虚拟机</p></li> <li><p>解压ES</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#解压：
tar -zxvf elasticsearch-8.10.4-linux-x86_64.tar.gz


#重命名：
mv elasticsearch-8.10.4 elasticsearch1


#移动文件夹：
mv elasticsearch1 /usr/local/


#es用户取得该文件夹权限：
chown -R es:es /usr/local/elasticsearch1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>启动ES服务：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#切换为es用户：
su es

#进入ES安装文件夹：
cd /usr/local/elasticsearch1/bin/

#启动ES服务：
./elasticsearch 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>当启动成功，可以看到类似以下的日志输出。首次启动Elasticsearch，默认会启用安全配置功能，启用身份认证和授权，内置超级用户<code>elastic</code>，并生成默认密码，此时要注意保存，否则之后启动不会再显示。</p> <p><img src="/javablog/public/assets/img/1717396207663.cc2a6f40.png" alt="1717396207663"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 重置默认密码：
cd /usr/local/elasticsearch1/bin/
./elasticsearch-reset-password -u elastic


# 自定义密码：
cd /www/elasticsearch/bin/ ./elasticsearch-reset-password --username elastic -i
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>✅ Elasticsearch security features have been automatically configured!
✅ Authentication is enabled and cluster connections are encrypted.

ℹ️  Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):
  UTsf8dGeBIP86cNRMFNQ

ℹ️  HTTP CA certificate SHA-256 fingerprint:
  f1dabc83f4fd921047bee58113988d411e3c408a2e157a9a2d2f458c720eb6e4

ℹ️  Configure Kibana to use this cluster:
• Run Kibana and click the configuration link in the terminal when Kibana starts.
• Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes):
  eyJ2ZXIiOiI4LjEwLjQiLCJhZHIiOlsiMTAzLjM4LjgxLjIyMzo5MjAwIl0sImZnciI6ImYxZGFiYzgzZjRmZDkyMTA0N2JlZTU4MTEzOTg4ZDQxMWUzYzQwOGEyZTE1N2E5YTJkMmY0NThjNzIwZWI2ZTQiLCJrZXkiOiJ0VWR0M1k4QkZZTjYzdktOc2dxZjpiVTV6bmF2YlN0MmY0S0ZrLUpzYldnIn0=

ℹ️  Configure other nodes to join this cluster:
• On this node:
  ⁃ Create an enrollment token with `bin/elasticsearch-create-enrollment-token -s node`.
  ⁃ Uncomment the transport.host setting at the end of config/elasticsearch.yml.
  ⁃ Restart Elasticsearch.
• On other nodes:
  ⁃ Start Elasticsearch with `bin/elasticsearch --enrollment-token &lt;token&gt;`, using the enrollment token that you generated.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>连接ES，查询ES服务是否启动成功</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 参数 --cacert指定了证书
curl --cacert /www/elasticsearch/config/certs/http_ca.crt -u elastic https://localhost:9200
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <p><img src="/javablog/public/assets/img/1717396334891.3e5fcd67.png" alt="1717396334891"></p> <p>重置密码：</p> <p><img src="/javablog/public/assets/img/1717396446771.c5190e9b.png" alt="1717396446771"></p> <p>输入新密码再次测试：</p> <p><img src="/javablog/public/assets/img/1717396478430.4770965f.png" alt="1717396478430"></p> <h3 id="_7-安装kibana"><a href="#_7-安装kibana" class="header-anchor">#</a> 7，安装kibana</h3> <p>Kibana是一款开源的数据分析和可视化平台，设计用于和Elasticsearch协作。我们可以使用Kibana对Elasticsearch索引中的数据进行搜索、查看、交互操作。</p> <ol><li><p>使用rz工具将Kibana压缩文件上传到Linux虚拟机</p></li> <li><p>解压</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tar -zxvf kibana-8.10.4-linux-x86_64.tar.gz -C /usr/local/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 进入Kibana解压路径
cd /usr/local/kibana-8.10.4/config

# 修改配置文件
vim kibana.yml

# 加入以下内容
# 主机IP，服务名
server.host: &quot;虚拟机IP&quot;
server.name: &quot;kibana&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>启动：kibana不能以root用户运行，我们给es用户设置kibana目录的权限，并使用es用户运行kibana</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 给es用户设置kibana目录权限
chown -R es:es /usr/local/kibana-8.10.4/


# 切换为es用户
su es


# 启动kibana
cd /usr/local/kibana-8.10.4/bin/
./kibana
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>访问kibana：http://虚拟机IP:5601。首次访问Kibana管理台会提示输入ES生成的token秘钥，可以在ES首次启动日志中找。如果token已失效或不正确，你也可以重新生成token。紧接着输入登录账号 elastic，密码也同样是从ES首次启动日志中找。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 进入es安装目录
cd /usr/local/elasticsearch1/bin


# 重新生成kibana的token
.elasticsearch-create-enrollment-token --scope kibana
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>点击<code>Management</code> =&gt; <code>Index Management</code>可以查看es索引信息。</p></li></ol> <h2 id="二-常用操作"><a href="#二-常用操作" class="header-anchor">#</a> 二，常用操作</h2> <h3 id="_1-索引操作"><a href="#_1-索引操作" class="header-anchor">#</a> 1, 索引操作</h3> <p>Elasticsearch是使用RESTful风格的http请求访问操作的，请求参数和返回值都是Json格式的，我们可以使用kibana发送http请求操作ES。</p> <p>注：在kibana中所有的请求都会省略<code>ip地址:端口号</code>，之后的路径我们省略写<code>ip地址:端口号</code></p> <p><strong>创建没有结构的索引：</strong></p> <p><img src="/javablog/public/assets/img/1717401052044.346594e0.png" alt="1717401052044"></p> <p><strong>查看：</strong></p> <p><img src="/javablog/public/assets/img/1717401105293.42c824d5.png" alt="1717401105293"></p> <p><strong>为索引添加结构：</strong></p> <p><img src="/javablog/public/assets/img/1717401309900.c7ef3c99.png" alt="1717401309900"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>student<span class="token operator">/</span>_mapping   <span class="token comment">// 改成POST</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;integer&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;integer&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>查看：</strong></p> <p><img src="/javablog/public/assets/img/1717401336925.d31ac71a.png" alt="1717401336925"></p> <p><strong>创建有结构的索引：</strong></p> <p><img src="/javablog/public/assets/img/1717401500123.8c40d611.png" alt="1717401500123"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>student1
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;integer&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;integer&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>查看：</strong></p> <p><img src="/javablog/public/assets/img/1717401521857.21e773ae.png" alt="1717401521857"></p> <p><strong>删除索引：</strong></p> <p><img src="/javablog/public/assets/img/1717401560883.5011ee66.png" alt="1717401560883"></p> <p><strong>查看：</strong></p> <p><img src="/javablog/public/assets/img/1717401592326.b3efac29.png" alt="1717401592326"></p> <h3 id="_2-文档操作-1"><a href="#_2-文档操作-1" class="header-anchor">#</a> 2, 文档操作（1）</h3> <p><strong>新增/修改文档：</strong></p> <p><img src="/javablog/public/assets/img/1717402804905.925b4c6a.png" alt="1717402804905"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">POST</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;ityls&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注：id值不写时自动生成文档id，id和已有id重复时修改文档</p> <p><strong>根据id查询文档:</strong></p> <p><img src="/javablog/public/assets/img/1717402846737.dfbdf028.png" alt="1717402846737"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>修改文档：</strong></p> <p><img src="/javablog/public/assets/img/1717402887138.8dbfa34b.png" alt="1717402887138"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">POST</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;ityls666&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>新增时，不写ID：</strong></p> <p><img src="/javablog/public/assets/img/1717402939549.a5425141.png" alt="1717402939549"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">POST</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;malu&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span>VIUw3Y8B2yxzSE4p8_PP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>删除文档：</strong></p> <p><img src="/javablog/public/assets/img/1717402986500.f37fe781.png" alt="1717402986500"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">DELETE</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span>VIUw3Y8B2yxzSE4p8_PP
<span class="token constant">GET</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span>VIUw3Y8B2yxzSE4p8_PP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-文档操作-2"><a href="#_3-文档操作-2" class="header-anchor">#</a> 3, 文档操作（2）</h3> <p><strong>根据id批量查询文档:</strong></p> <p><img src="/javablog/public/assets/img/1717403173571.2f6ab964.png" alt="1717403173571"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">POST</span> <span class="token operator">/</span>student<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;malu&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student<span class="token operator">/</span>_mget
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;docs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
     <span class="token punctuation">{</span><span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span><span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>
   <span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>查询所有文档:</strong></p> <p><img src="/javablog/public/assets/img/1717403214572.348d6046.png" alt="1717403214572"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>student<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
   <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string-property property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>修改文档部分字段:</strong></p> <p><img src="/javablog/public/assets/img/1717403291821.9e11d5b8.png" alt="1717403291821"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">POST</span> <span class="token operator">/</span>student<span class="token operator">/</span>_update<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>
<span class="token punctuation">{</span> 
  <span class="token string-property property">&quot;doc&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;ityls888&quot;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
   <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string-property property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注意：</p> <ul><li><p>Elasticsearch执行删除操作时，ES先标记文档为deleted状态，而不是直接物理删除。当ES存储空间不足或工作空闲时，才会执行物理删除操作。</p></li> <li><p>Elasticsearch执行修改操作时，ES不会真的修改Document中的数据，而是标记ES中原有的文档为deleted状态，再创建一个新的文档来存储数据。</p></li></ul> <h3 id="_4-域的属性-index"><a href="#_4-域的属性-index" class="header-anchor">#</a> 4, 域的属性_index</h3> <p><strong>index：</strong></p> <p>该域是否创建索引。只有值设置为true，才能根据该域的关键词查询文档。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 根据关键词查询文档</span>
<span class="token constant">GET</span> <span class="token operator">/</span>索引名<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
            <span class="token literal-property property">搜索字段</span><span class="token operator">:</span> 关键字
        <span class="token punctuation">}</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717403580171.ff4a8d30.png" alt="1717403580171"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>student1
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">PUT</span> <span class="token operator">/</span>student2
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>存入数据：</p> <p><img src="/javablog/public/assets/img/1717403662415.810a29d3.png" alt="1717403662415"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">POST</span> <span class="token operator">/</span>student1<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love ityls&quot;</span>
<span class="token punctuation">}</span>

<span class="token constant">POST</span> <span class="token operator">/</span>student2<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love ityls&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>查询文档：</p> <p><img src="/javablog/public/assets/img/1717403732177.1ca10361.png" alt="1717403732177"></p> <p><img src="/javablog/public/assets/img/1717403750389.53d91483.png" alt="1717403750389"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 根据关键词查询文档</span>
<span class="token constant">GET</span> <span class="token operator">/</span>student1<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;love&quot;</span>
        <span class="token punctuation">}</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student2<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;love&quot;</span>
        <span class="token punctuation">}</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_5-域的属性-type"><a href="#_5-域的属性-type" class="header-anchor">#</a> 5, 域的属性_type</h3> <p>**type:**域的类型</p> <table><thead><tr><th>核心类型</th> <th>具体类型</th></tr></thead> <tbody><tr><td>字符串类型</td> <td>text</td></tr> <tr><td>整数类型</td> <td>long, integer, short, byte</td></tr> <tr><td>浮点类型</td> <td>double, float</td></tr> <tr><td>日期类型</td> <td>date</td></tr> <tr><td>布尔类型</td> <td>boolean</td></tr> <tr><td>数组类型</td> <td>array</td></tr> <tr><td>对象类型</td> <td>object</td></tr> <tr><td>不分词的字符串</td> <td>keyword</td></tr></tbody></table> <p>测试：</p> <p><img src="/javablog/public/assets/img/1717403963752.2321b417.png" alt="1717403963752"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token constant">DELETE</span> <span class="token operator">/</span>student2

<span class="token constant">PUT</span> <span class="token operator">/</span>student2
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">POST</span> <span class="token operator">/</span>student2<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love ityls&quot;</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student2<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love ityls&quot;</span>
        <span class="token punctuation">}</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_6-域的属性-store"><a href="#_6-域的属性-store" class="header-anchor">#</a> 6, 域的属性_store</h3> <p>是否单独存储。如果设置为true，则该域能够单独查询。</p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1717404269322.03c264aa.png" alt="1717404269322"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">DELETE</span> <span class="token operator">/</span>student1
<span class="token constant">DELETE</span> <span class="token operator">/</span>student2

<span class="token constant">PUT</span> <span class="token operator">/</span>student1
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
         <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;integer&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">PUT</span> <span class="token operator">/</span>student2
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
         <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;integer&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">POST</span> <span class="token operator">/</span>student1<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love ityls&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">10</span>
<span class="token punctuation">}</span>
<span class="token constant">POST</span> <span class="token operator">/</span>student2<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;i love ityls&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">10</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student1<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;stored_fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>student2<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;stored_fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="三-分词器"><a href="#三-分词器" class="header-anchor">#</a> 三，分词器</h2> <h3 id="_1-默认分词器"><a href="#_1-默认分词器" class="header-anchor">#</a> 1, 默认分词器</h3> <p>ES文档的数据拆分成一个个有完整含义的关键词，并将关键词与文档对应，这样就可以通过关键词查询文档。要想正确的分词，需要选择合适的分词器。</p> <p><strong>standard analyzer</strong>：Elasticsearch默认分词器，根据空格和标点符号对英文进行分词，会进行单词的大小写转换。</p> <blockquote><p>默认分词器是英文分词器，对中文的分词是一字一词。</p></blockquote> <p>查看分词效果：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_analyze
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span>测试语句<span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span>分词器
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717404477434.e9774286.png" alt="1717404477434"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_analyze
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;I love ityls~&quot;</span><span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;standard&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-ik分词器安装"><a href="#_2-ik分词器安装" class="header-anchor">#</a> 2, IK分词器安装</h3> <p>如果linux服务器使用ES不方便的话，可以在window上使用，参考地址：https://blog.csdn.net/qq_44903856/article/details/139260565</p> <p>启动ES:</p> <p><img src="/javablog/public/assets/img/1717408069010.f4a35c66.png" alt="1717408069010"></p> <p><img src="/javablog/public/assets/img/1717411186307.d65f7f76.png" alt="1717411186307"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token key atrule">xpack.security.enrollment.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">xpack.security.http.ssl</span><span class="token punctuation">:</span> 
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717408096286.d8487c85.png" alt="1717408096286"></p> <p>配置：</p> <p><img src="/javablog/public/assets/img/1717408175896.4f7a90c8.png" alt="1717408175896"></p> <p>启动kibana，如下：</p> <p><img src="/javablog/public/assets/img/1717408221615.157b573f.png" alt="1717408221615"></p> <p>访问：</p> <p><img src="/javablog/public/assets/img/1717408656981.a7d411b3.png" alt="1717408656981"></p> <p>IKAnalyzer是一个开源的，基于java语言开发的轻量级的中文分词工具包。提供了两种分词算法：</p> <ul><li>ik_smart：最少切分</li> <li>ik_max_word：最细粒度划分</li></ul> <p>插件下载地址：https://get.infini.cloud/elasticsearch/analysis-ik/8.13.4</p> <p><strong>安装IK分词器:</strong></p> <ol><li><p>关闭es服务</p> <p><img src="/javablog/public/assets/img/1717404797602.d27a6d47.png" alt="1717404797602"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ps -ef | grep elasticsearch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>使用rz命令将ik分词器上传至虚拟机，注：ik分词器的版本要和es版本保持一致。</p> <p><img src="/javablog/public/assets/img/1717404909308.54b8c615.png" alt="1717404909308"></p></li> <li><p>解压ik分词器到elasticsearch的plugins目录下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>unzip elasticsearch-analysis-ik-8.10.4.zip -d /usr/local/elasticsearch1/plugins/analysis-ik
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1717405015471.8f0113fe.png" alt="1717405015471"></p></li> <li><p>启动ES服务(比较慢，切到es用户)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>su es

#进入ES安装文件夹：
cd /usr/local/elasticsearch1/bin/

#启动ES服务：
./elasticsearch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/javablog/public/assets/img/1717405058193.cc12ff2e.png" alt="1717405058193"></p></li></ol> <p>测试：</p> <p><img src="/javablog/public/assets/img/1717411974227.2933b818.png" alt="1717411974227"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_analyze
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;我爱于老师&quot;</span><span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_smart&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>或：</p> <p><img src="/javablog/public/assets/img/1717412006863.d7855c00.png" alt="1717412006863"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_analyze
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;我爱于老师&quot;</span><span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-ik分词器词典"><a href="#_3-ik分词器词典" class="header-anchor">#</a> 3, IK分词器词典</h3> <p>IK分词器根据词典进行分词，词典文件在IK分词器的config目录中。</p> <ul><li>main.dic：IK中内置的词典。记录了IK统计的所有中文单词。</li> <li>IKAnalyzer.cfg.xml：用于配置自定义词库。</li></ul> <p><img src="/javablog/public/assets/img/1717415238243.ff52835c.png" alt="1717415238243"></p> <p><img src="/javablog/public/assets/img/1717415271740.20d0c96e.png" alt="1717415271740"></p> <p>对于英雄联盟的分词：</p> <p><img src="/javablog/public/assets/img/1717415333612.7bf090c3.png" alt="1717415333612"></p> <p>此时就需要对词典进行扩充了：</p> <p><img src="/javablog/public/assets/img/1717415420798.c82038a8.png" alt="1717415420798"></p> <p><img src="/javablog/public/assets/img/1717415452492.47430df9.png" alt="1717415452492"></p> <p><img src="/javablog/public/assets/img/1717415478359.58cd6bf7.png" alt="1717415478359"></p> <p>重启ES和kibana再次测试：</p> <p><img src="/javablog/public/assets/img/1717416637317.16c18f29.png" alt="1717416637317"></p> <h3 id="_4-拼音分词器"><a href="#_4-拼音分词器" class="header-anchor">#</a> 4, 拼音分词器</h3> <p><img src="/javablog/public/assets/img/1717415812569.0b04eb84.png" alt="1717415812569"></p> <p><strong>安装拼音分词器：</strong></p> <ol><li><p>关闭es服务</p></li> <li><p>使用rz命令将拼音分词器上传至虚拟机。拼音分词器的版本要和es版本保持一致。</p></li> <li><p>解压pinyin分词器到elasticsearch的plugins目录下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>unzip elasticsearch-analysis-pinyin-8.10.4 -d /usr/local/elasticsearch1/plugins/analysis-pinyin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动ES服务</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>su es

#进入ES安装文件夹：
cd /usr/local/elasticsearch1/bin/

#启动ES服务：
./elasticsearch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <p>window下载地址：https://get.infini.cloud/elasticsearch/analysis-pinyin/8.13.4</p> <p><img src="/javablog/public/assets/img/1717416340104.57453640.png" alt="1717416340104"></p> <p>测试分词效果：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_analyze
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span>测试语句<span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;pinyin&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/javablog/public/assets/img/1717416685799.e57a7061.png" alt="1717416685799"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_analyze
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;我爱英雄联盟&quot;</span><span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;pinyin&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-自定义分词器"><a href="#_5-自定义分词器" class="header-anchor">#</a> 5, 自定义分词器</h3> <p>真实开发中我们往往需要对一段内容既进行文字分词，又进行拼音分词，此时我们需要自定义ik+pinyin分词器。</p> <p>在创建索引时自定义分词器，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>索引名
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;settings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;analysis&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;analyzer&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;ik_pinyin&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//自定义分词器名</span>
          <span class="token string-property property">&quot;tokenizer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 基本分词器</span>
          <span class="token string-property property">&quot;filter&quot;</span><span class="token operator">:</span><span class="token string">&quot;pinyin_filter&quot;</span> <span class="token comment">// 配置分词器过滤</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;filter&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 分词器过滤时配置另一个分词器，相当于同时使用两个分词器</span>
        <span class="token string-property property">&quot;pinyin_filter&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> 
          <span class="token string-property property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;pinyin&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 另一个分词器</span>
          <span class="token comment">// 拼音分词器的配置</span>
          <span class="token string-property property">&quot;keep_separate_first_letter&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否分词每个字的首字母</span>
          <span class="token string-property property">&quot;keep_full_pinyin&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否分词全拼</span>
          <span class="token string-property property">&quot;keep_original&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否保留原始输入</span>
          <span class="token string-property property">&quot;remove_duplicated_term&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 是否删除重复项</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;域名1&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span>域的类型<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span>是否单独存储<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span>是否创建索引<span class="token punctuation">,</span>
             <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span>分词器
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;域名2&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
        <span class="token operator">...</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717416980918.b003174d.png" alt="1717416980918"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>student3
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;settings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;analysis&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;analyzer&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;ik_pinyin&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//自定义分词器名</span>
          <span class="token string-property property">&quot;tokenizer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 基本分词器</span>
          <span class="token string-property property">&quot;filter&quot;</span><span class="token operator">:</span><span class="token string">&quot;pinyin_filter&quot;</span> <span class="token comment">// 配置分词器过滤</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;filter&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 分词器过滤时配置另一个分词器，相当于同时使用两个分词器</span>
        <span class="token string-property property">&quot;pinyin_filter&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> 
          <span class="token string-property property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;pinyin&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 另一个分词器</span>
          <span class="token comment">// 拼音分词器的配置</span>
          <span class="token string-property property">&quot;keep_separate_first_letter&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否分词每个字的首字母</span>
          <span class="token string-property property">&quot;keep_full_pinyin&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否分词全拼</span>
          <span class="token string-property property">&quot;keep_original&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否保留原始输入</span>
          <span class="token string-property property">&quot;remove_duplicated_term&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 是否删除重复项</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
       <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
         <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
           <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
           <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
           <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_pinyin&quot;</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>使用：</p> <p><img src="/javablog/public/assets/img/1717417042057.9b43cd68.png" alt="1717417042057"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>student3<span class="token operator">/</span>_analyze
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;你好IT于老师&quot;</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_pinyin&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="四-elasticsearch搜索文档"><a href="#四-elasticsearch搜索文档" class="header-anchor">#</a> 四，Elasticsearch搜索文档</h2> <h3 id="_1-准备工作"><a href="#_1-准备工作" class="header-anchor">#</a> 1, 准备工作</h3> <p>Elasticsearch提供了全面的文档搜索方式，在学习前我们添加一些文档数据：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>students
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span>
        	<span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
       		<span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        	<span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>students<span class="token operator">/</span>_doc<span class="token operator">/</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;IT于老师&quot;</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;I love ityls&quot;</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>students<span class="token operator">/</span>_doc<span class="token operator">/</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;美羊羊&quot;</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;美羊羊是羊村最漂亮的人&quot;</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>students<span class="token operator">/</span>_doc<span class="token operator">/</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;懒羊羊&quot;</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;懒羊羊的成绩不是很好&quot;</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>students<span class="token operator">/</span>_doc<span class="token operator">/</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;小灰灰&quot;</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;小灰灰的年纪比较小&quot;</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>students<span class="token operator">/</span>_doc<span class="token operator">/</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;沸羊羊&quot;</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;沸羊羊喜欢美羊羊&quot;</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>students<span class="token operator">/</span>_doc<span class="token operator">/</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;灰太狼&quot;</span><span class="token punctuation">,</span>
 <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;灰太狼是小灰灰的父亲，每次都会说我一定会回来的&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>文档搜索：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>索引<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    	<span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-搜索方式-1"><a href="#_2-搜索方式-1" class="header-anchor">#</a> 2, 搜索方式（1）</h3> <p>match_all：查询所有文档</p> <p><img src="/javablog/public/assets/img/1717417397819.96612c38.png" alt="1717417397819"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>match：全文检索。将查询条件分词后再进行搜索。</p> <p><img src="/javablog/public/assets/img/1717417456978.07f83b61.png" alt="1717417456978"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;喜欢&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/javablog/public/assets/img/1717417496183.c7f6dfdb.png" alt="1717417496183"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;我喜欢成绩好的&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>注：在搜索时关键词有可能会输入错误，ES搜索提供了自动纠错功能，即ES的模糊查询。使用match方式可以实现模糊查询。模糊查询对中文的支持效果一般，我们使用英文数据测试模糊查询。</p> <p><img src="/javablog/public/assets/img/1717417564330.1ddfbd3c.png" alt="1717417564330"></p> <p><img src="/javablog/public/assets/img/1717417629918.d20dd619.png" alt="1717417629918"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;lova&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;fuzziness&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span> # 纠错一个字符    <span class="token string">&quot;fuzziness&quot;</span><span class="token operator">:</span> 最多错误字符数<span class="token punctuation">,</span>不能超过<span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-搜索方式-2"><a href="#_3-搜索方式-2" class="header-anchor">#</a> 3, 搜索方式（2）</h3> <p>range：范围搜索。对数字类型的字段进行范围搜索</p> <p><img src="/javablog/public/assets/img/1717417791757.14be8a30.png" alt="1717417791757"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;gte&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;lte&quot;</span><span class="token operator">:</span><span class="token string">&quot;3&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>match_phrase：短语检索。搜索条件不做任何分词解析，在搜索字段对应的倒排索引中精确匹配。</p> <p><img src="/javablog/public/assets/img/1717417858628.a8655c42.png" alt="1717417858628"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;match_phrase&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;喜欢&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>term/terms：单词/词组搜索。搜索条件不做任何分词解析，在搜索字段对应的倒排索引中精确匹配</p> <p><img src="/javablog/public/assets/img/1717417928952.5cec127a.png" alt="1717417928952"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;成绩&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;成绩&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;喜欢&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_4-复合搜索"><a href="#_4-复合搜索" class="header-anchor">#</a> 4, 复合搜索</h3> <p>格式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>索引<span class="token operator">/</span>_search
<span class="token punctuation">{</span> 
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token string-property property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
      <span class="token comment">// 必须满足的条件 </span>
      <span class="token string-property property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
                <span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数<span class="token punctuation">,</span>
                <span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数
       <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 多个条件有任意一个满足即可</span>
      <span class="token string-property property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数<span class="token punctuation">,</span>
               <span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数
           <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token comment">// 必须不满足的条件</span>
       <span class="token string-property property">&quot;must_not&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
               <span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数<span class="token punctuation">,</span>
               <span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数
           <span class="token punctuation">]</span>
       <span class="token punctuation">}</span> 
   <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>测试1:</p> <p><img src="/javablog/public/assets/img/1717418144117.a2b157e7.png" alt="1717418144117"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;成绩&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;gte&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>测试2：</p> <p><img src="/javablog/public/assets/img/1717418175278.2c1a55f6.png" alt="1717418175278"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;成绩&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;gte&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>测试3：</p> <p><img src="/javablog/public/assets/img/1717418213489.f833bf6a.png" alt="1717418213489"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;must_not&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;成绩&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;gte&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>测试4：</p> <p><img src="/javablog/public/assets/img/1717418351724.b9e7e974.png" alt="1717418351724"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;美羊羊喜欢成绩好的同学&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span> 
      <span class="token string-property property">&quot;must_not&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;成绩&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;gte&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_5-结果排序和分页查询"><a href="#_5-结果排序和分页查询" class="header-anchor">#</a> 5, 结果排序和分页查询</h3> <p>ES中默认使用相关度分数实现排序，可以通过搜索语法定制化排序。格式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>索引<span class="token operator">/</span>_search
<span class="token punctuation">{</span> 
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> 搜索条件<span class="token punctuation">,</span>
  <span class="token string-property property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token punctuation">{</span>
           <span class="token string-property property">&quot;字段1&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
               <span class="token string-property property">&quot;order&quot;</span><span class="token operator">:</span><span class="token string">&quot;asc&quot;</span>
           <span class="token punctuation">}</span> 
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token punctuation">{</span> 
           <span class="token string-property property">&quot;字段2&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
               <span class="token string-property property">&quot;order&quot;</span><span class="token operator">:</span><span class="token string">&quot;desc&quot;</span> 
           <span class="token punctuation">}</span> 
       <span class="token punctuation">}</span>
   <span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>由于ES对text类型字段数据会做分词处理，使用哪一个单词做排序都是不合理的，所以 ES中默认不允许对text类型的字段做排序。如果需要使用字符串做结果排序，可以使用 keyword类型的字段作为排序依据，因为keyword字段不做分词处理。</p> <p>测试：看每一个结果的分数</p> <p><img src="/javablog/public/assets/img/1717418480257.87ab05e1.png" alt="1717418480257"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;我喜欢成绩好的同学&quot;</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我们也可以指定排序规则(按id进行排序)：</p> <p><img src="/javablog/public/assets/img/1717418569460.8080e51c.png" alt="1717418569460"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;我喜欢成绩好的同学&quot;</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>不能使用text字段来排序：</p> <p><img src="/javablog/public/assets/img/1717418631288.ce756da2.png" alt="1717418631288"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;我喜欢成绩好的同学&quot;</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>注意：由于ES对text类型字段数据会做分词处理，使用哪一个单词做排序都是不合理的，所以 ES中默认不允许对text类型的字段做排序。如果需要使用字符串做结果排序，可以使用 keyword类型的字段作为排序依据，因为keyword字段不做分词处理。</p> <p>分页查询：</p> <p><img src="/javablog/public/assets/img/1717418726697.29569524.png" alt="1717418726697"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_6-高亮查询"><a href="#_6-高亮查询" class="header-anchor">#</a> 6, 高亮查询</h3> <p>在进行关键字搜索时，搜索出的内容中的关键字会显示不同的颜色，称之为高亮。为什么在网页中关键字会显示不同的颜色，我们通过开发者工具查看网页源码：</p> <p><img src="/javablog/public/assets/img/1717418826087.87363935.png" alt="1717418826087"></p> <p>我们可以在关键字左右加入标签字符串，数据传入前端即可完成高亮显示，ES可以对查询出的内容中关键字部分进行标签和样式的设置。格式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>索引<span class="token operator">/</span>_search
<span class="token punctuation">{</span> 
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span>搜索条件<span class="token punctuation">,</span>
    <span class="token string-property property">&quot;highlight&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
         <span class="token string-property property">&quot;高亮显示的字段名&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 返回高亮数据的最大长度</span>
             <span class="token string-property property">&quot;fragment_size&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>
                <span class="token comment">// 返回结果最多可以包含几段不连续的文字</span>
             <span class="token string-property property">&quot;number_of_fragments&quot;</span><span class="token operator">:</span><span class="token number">5</span>
         <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;pre_tags&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;前缀&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;post_tags&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;后缀&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717419071414.f767ea26.png" alt="1717419071414"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>students<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token string">&quot;我喜欢成绩好的同学&quot;</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;info&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;fragment_size&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;number_of_fragments&quot;</span><span class="token operator">:</span> <span class="token number">5</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;pre_tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;em&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;post_tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;/em&gt;&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_7-sql查询"><a href="#_7-sql查询" class="header-anchor">#</a> 7, SQL查询</h3> <p>在ES7之后，支持SQL语句查询文档：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_sql<span class="token operator">?</span>format<span class="token operator">=</span>txt
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token constant">SQL</span>语句
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>开源版本的ES并不支持通过Java操作SQL进行查询，如果需要操作 SQL查询，则需要氪金（购买白金版）</p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1717419170551.0b7ab67d.png" alt="1717419170551"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>_sql<span class="token operator">?</span>format<span class="token operator">=</span>txt
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token string">&quot;select * from students&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/javablog/public/assets/img/1717419254989.87ddc0ea.png" alt="1717419254989"></p> <h2 id="五-springdataes"><a href="#五-springdataes" class="header-anchor">#</a> 五，SpringDataES</h2> <h3 id="_1-项目搭建"><a href="#_1-项目搭建" class="header-anchor">#</a> 1, 项目搭建</h3> <p>Java原生代码可以操作Elasticsearch，但操作比较繁琐，类似于数据库中的JDBC，我们还需要将ES文档手动封装为Java对象。所以开发中我们一般使用框架操作Elasticsearch。</p> <p>Spring Data ElasticSearch是JAVA操作Elasticsearch的框架。它通过对原生API的封装，使得JAVA程序员可以简单的对Elasticsearch进行操作。</p> <p>创建SpringBoot项目，加入Spring Data Elasticsearch起步依赖：</p> <p><img src="/javablog/public/assets/img/1717419829356.b788e166.png" alt="1717419829356"></p> <p>依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>配置：</p> <p><img src="/javablog/public/assets/img/1717419812081.07331e4e.png" alt="1717419812081"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 连接elasticsearch</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
<span class="token key atrule">uris</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">9200</span>
<span class="token key atrule">username</span><span class="token punctuation">:</span> elastic
<span class="token key atrule">password</span><span class="token punctuation">:</span> elastic

<span class="token comment"># 日志格式</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
<span class="token key atrule">pattern</span><span class="token punctuation">:</span>
<span class="token key atrule">console</span><span class="token punctuation">:</span> <span class="token string">'%d{HH:mm:ss.SSS} %clr(%-5level) ---  [%-15thread] %cyan(%-50logger{50}):%msg%n'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>创建配置类，跳过SSL证书检查。</p> <p>从ES8开始，访问ES的协议从http变成了https，访问https请求需要SSL证书，在开发环境下我们不需要配置该证书，在项目中添加一个配置类，跳过SSL证书检查即可。</p> <p><img src="/javablog/public/assets/img/1717419971210.8ac4589c.png" alt="1717419971210"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>esdemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">HttpAsyncClientBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span><span class="token class-name">SSLContextBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span><span class="token class-name">SSLContexts</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestClientBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span></span><span class="token class-name">RestClientBuilderCustomizer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyManagementException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyStoreException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestClientBuilderCustomizerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">RestClientBuilderCustomizer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">RestClientBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 跳过SSL的证书检查
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">HttpAsyncClientBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SSLContextBuilder</span> sscb <span class="token operator">=</span> <span class="token class-name">SSLContexts</span><span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sscb<span class="token punctuation">.</span><span class="token function">loadTrustMaterial</span><span class="token punctuation">(</span><span class="token punctuation">(</span>chain<span class="token punctuation">,</span> authType<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeyStoreException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">setSSLContext</span><span class="token punctuation">(</span>sscb<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeyManagementException</span> <span class="token operator">|</span> <span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_2-编写实体类"><a href="#_2-编写实体类" class="header-anchor">#</a> 2, 编写实体类</h3> <p>创建实体类：</p> <p><img src="/javablog/public/assets/img/1717420112515.94089244.png" alt="1717420112515"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>esdemo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">FieldType</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">&quot;product&quot;</span><span class="token punctuation">,</span>createIndex <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Integer</span><span class="token punctuation">,</span>store <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">,</span>store <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>analyzer <span class="token operator">=</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>searchAnalyzer <span class="token operator">=</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productName<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">,</span>store <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>analyzer <span class="token operator">=</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>searchAnalyzer <span class="token operator">=</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productDesc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>注解：</p> <ul><li><p>@Document：标记在类上，标记实体类为文档对象，一般有如下属性：</p> <ul><li><p>indexName：对应索引的名称</p></li> <li><p>createIndex：是否自动创建索引</p></li></ul></li> <li><p>@Id：标记在成员变量上，标记一个字段为主键，该字段的值会同步到ES该文档的id值。</p></li> <li><p>@Field：标记在成员变量上，标记为文档中的域，一般有如下属性：</p> <ul><li><p>type：域的类型</p></li> <li><p>index：是否创建索引，默认是 true</p></li> <li><p>store：是否单独存储，默认是 false</p></li> <li><p>analyzer：分词器</p></li> <li><p>searchAnalyzer：搜索时的分词器</p></li></ul></li></ul> <h3 id="_3-repository接口"><a href="#_3-repository接口" class="header-anchor">#</a> 3, Repository接口</h3> <p>创建Repository接口:</p> <p><img src="/javablog/public/assets/img/1717420490291.29d9099f.png" alt="1717420490291"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>esdemo<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>esdemo<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Product</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717420954050.0ffb2275.png" alt="1717420954050"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ProductRepository</span> repository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;iphone30&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iphone30是苹果最新手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/javablog/public/assets/img/1717420976939.34e8ca87.png" alt="1717420976939"></p> <p>测试修改：</p> <p><img src="/javablog/public/assets/img/1717421036709.81a74003.png" alt="1717421036709"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;iphone31&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iphone31是苹果最新手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/javablog/public/assets/img/1717421061884.a2e9ca37.png" alt="1717421061884"></p> <p>测试查询所有：</p> <p><img src="/javablog/public/assets/img/1717421100211.875d27e8.png" alt="1717421100211"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findAllProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token operator">:</span> all<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>根据id查询：</p> <p><img src="/javablog/public/assets/img/1717421142179.5f384c46.png" alt="1717421142179"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findProductById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> product <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>测试删除：</p> <p><img src="/javablog/public/assets/img/1717421191846.422ec419.png" alt="1717421191846"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-dsl查询文档"><a href="#_4-dsl查询文档" class="header-anchor">#</a> 4, DSL查询文档</h3> <p>接下来我们讲解SpringDataES支持的查询方式，首先准备一些文档数据：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 添加一些数据</span>
repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;三体1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三体1是优秀的科幻小说&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;三体2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三体2是优秀的科幻小说&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;三体3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三体3是优秀的科幻小说&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;elasticsearch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;elasticsearch是基于lucene开发的优秀的搜索引擎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/javablog/public/assets/img/1717421331418.16a0e9eb.png" alt="1717421331418"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addAllProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 添加一些数据</span>
        repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;三体1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三体1是优秀的科幻小说&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;三体2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三体2是优秀的科幻小说&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;三体3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三体3是优秀的科幻小说&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;elasticsearch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;elasticsearch是基于lucene开发的优秀的搜索引擎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用Repository继承的方法查询文档，该方式我们之前已经讲解过了，使用DSL语句查询文档，ES通过json类型的请求体查询文档，方法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>索引<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>   <span class="token comment">// query后面跟的这个对象就是DSL语句</span>
    <span class="token literal-property property">搜索方式</span><span class="token operator">:</span>搜索参数
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>query后的json对象称为DSL语句，我们可以在接口方法上使用@Query注解自定义DSL语句查询。</p> <p><img src="/javablog/public/assets/img/1717421513937.31537c3e.png" alt="1717421513937"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>esdemo<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>esdemo<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Product</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Query</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;match\&quot;: {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;productDesc\&quot;: \&quot;?0\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    }\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  }&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByProductDescMatch</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyword<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;match\&quot;: {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;productDesc\&quot;: \&quot;?0\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    }\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  }&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByProductDescMatch</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyword<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;{\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;match\&quot;: {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;productDesc\&quot;: {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;query\&quot;: \&quot;?0\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;        \&quot;fuzziness\&quot;: 1\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      }\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    }\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  }&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByProductDescFuzzy</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyword<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByProductName</span><span class="token punctuation">(</span><span class="token class-name">String</span> productName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByProductNameOrProductDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> productName<span class="token punctuation">,</span><span class="token class-name">String</span> productDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByIdBetween</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> startId<span class="token punctuation">,</span><span class="token class-name">Integer</span> endId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717421567577.c873cd6e.png" alt="1717421567577"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByProductDescMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByProductDescMatch</span><span class="token punctuation">(</span><span class="token string">&quot;我爱看三体&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        products<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>模糊查询：</p> <p><img src="/javablog/public/assets/img/1717421664370.46a5f6e5.png" alt="1717421664370"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByProductDescFuzzy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByProductDescFuzzy</span><span class="token punctuation">(</span><span class="token string">&quot;elasticsearcha&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        products<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-按照规则命名查询方法"><a href="#_5-按照规则命名查询方法" class="header-anchor">#</a> 5, 按照规则命名查询方法</h3> <p><strong>按照规则命名方法查询文档:</strong></p> <ul><li>只需在Repository接口中按照一定的规则命名方法，该方法就能完成相应的查询。</li> <li>规则：查询方法以findBy开头，涉及查询条件时，条件的属性用条件关键字连接。</li></ul> <table><thead><tr><th>关键字</th> <th>命名规则</th> <th>解释</th> <th>示例</th></tr></thead> <tbody><tr><td>and</td> <td>ﬁndByField1AndField2</td> <td>根据Field1和Field2 获得数据</td> <td>ﬁndByTitleAndContent</td></tr> <tr><td>or</td> <td>ﬁndByField1OrField2</td> <td>根据Field1或Field2 获得数据</td> <td>ﬁndByTitleOrContent</td></tr> <tr><td>is</td> <td>ﬁndByField</td> <td>根据Field获得数据</td> <td>ﬁndByTitle</td></tr> <tr><td>not</td> <td>ﬁndByFieldNot</td> <td>根据Field获得补集数据</td> <td>ﬁndByTitleNot</td></tr> <tr><td>between</td> <td>ﬁndByFieldBetween</td> <td>获得指定范围的数据</td> <td>ﬁndByPriceBetween</td></tr></tbody></table> <p>代码如下：</p> <p><img src="/javablog/public/assets/img/1717421743114.af202e12.png" alt="1717421743114"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1717422001388.f9d971b8.png" alt="1717422001388"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByProductName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByProductName</span><span class="token punctuation">(</span><span class="token string">&quot;iphone30&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        products<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>再测试：</p> <p><img src="/javablog/public/assets/img/1717422050921.754cea92.png" alt="1717422050921"></p> <p><img src="/javablog/public/assets/img/1717422080955.a9c5d320.png" alt="1717422080955"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByProductNameOrProductDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByProductNameOrProductDesc</span><span class="token punctuation">(</span><span class="token string">&quot;iphone30&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;elasticsearch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        products<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>再测试：</p> <p><img src="/javablog/public/assets/img/1717422117916.def632f7.png" alt="1717422117916"></p> <p><img src="/javablog/public/assets/img/1717422141680.2c756638.png" alt="1717422141680"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindByIdBetween</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByIdBetween</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        products<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_6-分页查询"><a href="#_6-分页查询" class="header-anchor">#</a> 6, 分页查询</h3> <p>在使用继承或自定义的方法时，在方法中添加Pageable类型的参数，返回值为Page类型即可进行分页查询。</p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1717422293469.ae52e66a.png" alt="1717422293469"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 参数1：页数，参数2：每页条数</span>
        <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总条数:&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总页数:&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;数据:&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>带条件的分页：</p> <p><img src="/javablog/public/assets/img/1717422414239.6ca40282.png" alt="1717422414239"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindPage2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByProductDescMatch</span><span class="token punctuation">(</span><span class="token string">&quot;我喜欢三体&quot;</span><span class="token punctuation">,</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总条数:&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总页数:&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;数据:&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_7-结果排序"><a href="#_7-结果排序" class="header-anchor">#</a> 7, 结果排序</h3> <p>使用继承或自定义的方法时，在方法中添加Sort类型的参数即可进行结果排序。</p> <p><img src="/javablog/public/assets/img/1717422497560.e675aae6.png" alt="1717422497560"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token operator">:</span> all<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>分页加排序：</p> <p><img src="/javablog/public/assets/img/1717422579861.9f86c6b0.png" alt="1717422579861"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 测试分页加排序</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindSort2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByProductDescMatch</span><span class="token punctuation">(</span><span class="token string">&quot;我喜欢三体&quot;</span><span class="token punctuation">,</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总条数&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总页数&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;数据&quot;</span><span class="token operator">+</span>page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_8-template操作索引"><a href="#_8-template操作索引" class="header-anchor">#</a> 8, template操作索引</h3> <p>SpringDataElasticsearch提供了一个工具类ElasticsearchTemplate，我们使用该类对象也可以对ES进行操作。操作索引：</p> <p><img src="/javablog/public/assets/img/1717423101300.5b21b940.png" alt="1717423101300"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ElasticsearchTemplate</span> template<span class="token punctuation">;</span>

    <span class="token comment">// 新增索引</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取索引操作对象</span>
        <span class="token class-name">IndexOperations</span> indexOperations <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">indexOps</span><span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建索引</span>
        indexOperations<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>删除索引：</p> <p><img src="/javablog/public/assets/img/1717423158350.2abe3771.png" alt="1717423158350"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 删除索引</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取索引操作对象</span>
        <span class="token class-name">IndexOperations</span> indexOperations <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">indexOps</span><span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 删除索引</span>
        indexOperations<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_9-template操作文档"><a href="#_9-template操作文档" class="header-anchor">#</a> 9, template操作文档</h3> <p><img src="/javablog/public/assets/img/1717423313683.6928a454.png" alt="1717423313683"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 新增/修改文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;es2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;es是一款优秀的搜索引擎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717423301599.08c3821e.png" alt="1717423301599"></p> <p>修改：</p> <p><img src="/javablog/public/assets/img/1717423378964.9b65d599.png" alt="1717423378964"></p> <p>删除：</p> <p><img src="/javablog/public/assets/img/1717423408154.5c750553.png" alt="1717423408154"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 删除文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        template<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717423433244.1d80a58d.png" alt="1717423433244"></p> <p>根据ID查询文档：</p> <p><img src="/javablog/public/assets/img/1717423458157.14aa0a26.png" alt="1717423458157"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 根据id查询文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findDocumentById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_10-template查询文档"><a href="#_10-template查询文档" class="header-anchor">#</a> 10, template查询文档</h3> <p>查询文档1：</p> <p><img src="/javablog/public/assets/img/1717423575856.8e83ea2c.png" alt="1717423575856"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 查询文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1.构造查询条件</span>
        <span class="token class-name">NativeQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//                .withQuery(Queries.matchAllQueryAsQuery())</span>
<span class="token comment">//                .withQuery(Queries.termQueryAsQuery(&quot;productDesc&quot;,&quot;手机&quot;))</span>
                <span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">Queries</span><span class="token punctuation">.</span><span class="token function">matchQueryAsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;productDesc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;我喜欢看科幻小说&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.处理查询结果</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productSearchHit <span class="token operator">:</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Product</span> product <span class="token operator">=</span> productSearchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_11-template复杂条件查询"><a href="#_11-template复杂条件查询" class="header-anchor">#</a> 11, template复杂条件查询</h3> <p><img src="/javablog/public/assets/img/1717423649991.432685a9.png" alt="1717423649991"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 查询文档2</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchDocument2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> productName <span class="token operator">=</span> <span class="token string">&quot;三体&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> productDesc <span class="token operator">=</span> <span class="token string">&quot;优秀&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 1.构造查询条件</span>
        <span class="token class-name">NativeQueryBuilder</span> nativeQueryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果没有传入参数，查询所有</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>productName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> productDesc <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            nativeQueryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">Queries</span><span class="token punctuation">.</span><span class="token function">matchAllQueryAsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">BoolQuery<span class="token punctuation">.</span>Builder</span> boolQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>productName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                boolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">Queries</span><span class="token punctuation">.</span><span class="token function">matchQueryAsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;productName&quot;</span><span class="token punctuation">,</span>productName<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>productDesc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                boolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">Queries</span><span class="token punctuation">.</span><span class="token function">matchQueryAsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;productDesc&quot;</span><span class="token punctuation">,</span>productDesc<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            nativeQueryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span>boolQuery<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_toQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">NativeQuery</span> query <span class="token operator">=</span> nativeQueryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.处理查询结果</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productSearchHit <span class="token operator">:</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Product</span> product <span class="token operator">=</span> productSearchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_12-template分页查询"><a href="#_12-template分页查询" class="header-anchor">#</a> 12, template分页查询</h3> <p><img src="/javablog/public/assets/img/1717423900531.df68fedd.png" alt="1717423900531"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 分页查询文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchDocumentPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1.构造查询条件</span>
        <span class="token comment">// 分页条件</span>
        <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NativeQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">Queries</span><span class="token punctuation">.</span><span class="token function">matchAllQueryAsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withPageable</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.处理查询结果</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productSearchHit <span class="token operator">:</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            content<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>productSearchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/**
         * 封装Page对象
         * 参数1：具体数据，参数2：分页条件对象，参数3：总条数
         */</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageImpl</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> pageable<span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_13-template结果排序"><a href="#_13-template结果排序" class="header-anchor">#</a> 13, template结果排序</h3> <p><img src="/javablog/public/assets/img/1717423949901.f5814e4d.png" alt="1717423949901"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 结果排序</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchDocumentSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1.构造查询条件</span>
        <span class="token class-name">NativeQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">Queries</span><span class="token punctuation">.</span><span class="token function">matchAllQueryAsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSort</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.处理查询结果</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productSearchHit <span class="token operator">:</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Product</span> product <span class="token operator">=</span> productSearchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="六-集群"><a href="#六-集群" class="header-anchor">#</a> 六，集群</h2> <h3 id="_1-集群-概念"><a href="#_1-集群-概念" class="header-anchor">#</a> 1, 集群_概念</h3> <p>在单台ES服务器上，随着一个索引内数据的增多，会产生存储、效率、安全等问题。</p> <ol><li><p>假设项目中有一个500G大小的索引，但我们只有几台200G硬盘的服务器，此时是不可能将索引放入其中某一台服务器中的。</p> <p><img src="/javablog/public/assets/img/1717424210724.1ce755dd.png" alt="1717424210724"></p></li> <li><p>此时我们需要将索引拆分成多份，分别放入不同的服务器中，此时这几台服务器维护了同一个索引，我们称这几台服务器为一个<strong>集群</strong>，其中的每一台服务器为一个<strong>节点</strong>，每一台服务器中的数据称为一个<strong>分片</strong>。</p> <p><img src="/javablog/public/assets/img/1717424233095.2ebfefb0.png" alt="1717424233095"></p></li> <li><p>此时如果某个节点故障，则会造成集群崩溃，所以每个节点的分片往往还会创建<strong>副本</strong>，存放在<strong>其他节点</strong>中，此时一个节点的崩溃就不会影响整个集群的正常运行。</p> <p><img src="/javablog/public/assets/img/1717424295736.805e4fa6.png" alt="1717424295736"></p></li></ol> <p><strong>相关概念：</strong></p> <ul><li><p><strong>节点（node）</strong>：一个节点是集群中的一台服务器，是集群的一部分。它存储数据，参与集群的索引和搜索功能。集群中有一个为主节点，主节点通过ES内部选举产生。</p></li> <li><p><strong>集群（cluster）</strong>：一组节点组织在一起称为一个集群，它们共同持有整个的数据，并一起提供索引和搜索功能。</p></li> <li><p><strong>分片（shards）</strong>：ES可以把完整的索引分成多个分片，分别存储在不同的节点上。</p></li> <li><p><strong>副本（replicas）</strong>：ES可以为每个分片创建副本，提高查询效率，保证在分片数据丢失后的恢复。</p></li></ul> <p><img src="/javablog/public/assets/img/1717424319949.4d7cb75f.png" alt="1717424319949"></p> <p>注：</p> <ul><li><p>分片的数量只能在索引创建时指定，索引创建后不能再更改分片数量，但可以改变副本的数量。</p></li> <li><p>为保证节点发生故障后集群的正常运行，ES不会将某个分片和它的副本存在同一台节点上。</p></li></ul> <h3 id="_2-集群-搭建集群-1"><a href="#_2-集群-搭建集群-1" class="header-anchor">#</a> 2, 集群_搭建集群(1)</h3> <p><strong>安装第一个ES节点：</strong></p> <ul><li><p>修改系统进程最大打开文件数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#修改系统文件
vim /etc/security/limits.conf

#添加如下内容
es soft nofile 65535
es hard nofile 131072
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#解压：
tar -zxvf elasticsearch-8.10.4-linux-x86_64.tar.gz


#重命名：
mv elasticsearch-8.10.4 myes1


#移动文件夹：
mv myes1 /usr/local/


#安装ik分词器
unzip elasticsearch-analysis-ik-8.10.4.zip -d /usr/local/myes1/plugins/analysis-ik


#安装拼音分词器
unzip elasticsearch-analysis-pinyin-8.10.4.zip -d /usr/local/myes1/plugins/analysis-pinyin


#es用户取得该文件夹权限：
chown -R es:es /usr/local/myes1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>修改配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#打开节点一配置文件：
vim /usr/local/myes1/config/elasticsearch.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>配置如下信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#集群名称，保证唯一
cluster.name: my_elasticsearch
#节点名称，必须不一样
node.name: node1
#可以访问该节点的ip地址
network.host: 0.0.0.0
#该节点服务端口号
http.port: 9200
#集群间通信端口号
transport.port: 9300
#候选主节点的设备地址
discovery.seed_hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]
#候选主节点的节点名
cluster.initial_master_nodes: [&quot;node1&quot;,&quot;node2&quot;,&quot;node3&quot;]
#关闭安全认证
xpack.security.enabled: false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#切换为es用户：
su es


#后台启动第一个节点：
ES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot; /usr/local/myes1/bin/elasticsearch -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <p><strong>安装第二个ES节点：</strong></p> <ul><li><p>安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#解压：
tar -zxvf elasticsearch-8.10.4-linux-x86_64.tar.gz


#重命名：
mv elasticsearch-8.10.4 myes2


#移动文件夹：
mv myes2 /usr/local/


#安装ik分词器
unzip elasticsearch-analysis-ik-8.10.4.zip -d /usr/local/myes2/plugins/analysis-ik


#安装拼音分词器
unzip elasticsearch-analysis-pinyin-8.10.4.zip -d /usr/local/myes2/plugins/analysis-pinyin


#es用户取得该文件夹权限：
chown -R es:es /usr/local/myes2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>修改配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#打开节点二配置文件：
vim /usr/local/myes2/config/elasticsearch.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>配置如下信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#集群名称，保证唯一
cluster.name: my_elasticsearch
#节点名称，必须不一样
node.name: node2
#可以访问该节点的ip地址
network.host: 0.0.0.0
#该节点服务端口号
http.port: 9201
#集群间通信端口号
transport.port: 9301
#候选主节点的设备地址
discovery.seed_hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]
#候选主节点的节点名
cluster.initial_master_nodes: [&quot;node1&quot;,&quot;node2&quot;,&quot;node3&quot;]
#关闭安全认证
xpack.security.enabled: false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#切换为es用户：
su es


#后台启动第二个节点：
ES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot; /usr/local/myes2/bin/elasticsearch -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <p><strong>安装第三个ES节点：</strong></p> <ul><li><p>安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#解压：
tar -zxvf elasticsearch-8.10.4-linux-x86_64.tar.gz


#重命名：
mv elasticsearch-8.10.4 myes3


#移动文件夹：
mv myes3 /usr/local/


#安装ik分词器
unzip elasticsearch-analysis-ik-8.10.4.zip -d /usr/local/myes3/plugins/analysis-ik


#安装拼音分词器
unzip elasticsearch-analysis-pinyin-8.10.4.zip -d /usr/local/myes3/plugins/analysis-pinyin


#es用户取得该文件夹权限：
chown -R es:es /usr/local/myes3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>修改配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#打开节点一配置文件：
vim /usr/local/myes3/config/elasticsearch.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>配置如下信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#集群名称，保证唯一
cluster.name: my_elasticsearch
#节点名称，必须不一样
node.name: node3
#可以访问该节点的ip地址
network.host: 0.0.0.0
#该节点服务端口号
http.port: 9202
#集群间通信端口号
transport.port: 9302
#候选主节点的设备地址
discovery.seed_hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]
#候选主节点的节点名
cluster.initial_master_nodes: [&quot;node1&quot;,&quot;node2&quot;,&quot;node3&quot;]
#关闭安全认证
xpack.security.enabled: false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#切换为es用户：
su es

#后台启动第三个节点：
ES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot; /usr/local/myes3/bin/elasticsearch -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <p>测试：访问<code>http://虚拟机IP:9200/_cat/nodes</code>查看集群是否搭建成功。</p> <p><img src="/javablog/public/assets/img/1717424939484.1425c243.png" alt="1717424939484"></p> <h3 id="_3-集群-配置kibana"><a href="#_3-集群-配置kibana" class="header-anchor">#</a> 3, 集群_配置kibana</h3> <p><strong>kibana连接es集群：</strong></p> <ol><li><p>在kibana中访问集群</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 打开kibana配置文件
vim /usr/local/kibana-8.10.4/config/kibana.yml

# 该集群的所有节点
elasticsearch.hosts: [&quot;http://127.0.0.1:9200&quot;,&quot;http://127.0.0.1:9201&quot;,&quot;http://127.0.0.1:9202&quot;]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>启动kibana</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#切换为es用户：
su es


#启动kibana：
cd /usr/local/kibana-8.10.4/bin
./kibana
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>访问kibana：<code>http://虚拟机IP:5601</code></p></li></ol> <h3 id="_4-集群-测试集群状态"><a href="#_4-集群-测试集群状态" class="header-anchor">#</a> 4, 集群_测试集群状态</h3> <p>在集群中创建一个索引：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PUT /product1
{
 &quot;settings&quot;: {
  &quot;number_of_shards&quot;: 5, // 分片数
  &quot;number_of_replicas&quot;: 1 // 每个分片的副本数
  },
 &quot;mappings&quot;: {
  &quot;properties&quot;: {
   &quot;id&quot;: {
    &quot;type&quot;: &quot;integer&quot;,
    &quot;store&quot;: true,
    &quot;index&quot;: true
    },
   &quot;productName&quot;: {
    &quot;type&quot;: &quot;text&quot;,
    &quot;store&quot;: true,
    &quot;index&quot;: true
    },
   &quot;productDesc&quot;: {
    &quot;type&quot;: &quot;text&quot;,
    &quot;store&quot;: true,
    &quot;index&quot;: true
    }
   }
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>查看集群状态：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 查看集群健康状态
GET /_cat/health?v
# 查看索引状态
GET /_cat/indices?v
# 查看分片状态
GET /_cat/shards?v 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/javablog/public/assets/img/1717425249974.b6e45e43.png" alt="1717425249974"></p> <p><img src="/javablog/public/assets/img/1717425284509.f4d57e56.png" alt="1717425284509"></p> <p><img src="/javablog/public/assets/img/1717425347624.76fda7d6.png" alt="1717425347624"></p> <h3 id="_5-集群-故障应对、水平扩容"><a href="#_5-集群-故障应对、水平扩容" class="header-anchor">#</a> 5, 集群_故障应对、水平扩容</h3> <ol><li><p>关闭一个节点，可以发现ES集群可以自动进行故障应对。</p> <p><img src="/javablog/public/assets/img/1717425447298.20441651.png" alt="1717425447298"></p> <p>1分钟后，重新分配节点</p> <p><img src="/javablog/public/assets/img/1717425473943.dac8b880.png" alt="1717425473943"></p></li> <li><p>重新打开该节点，可以发现ES集群可以自动进行水平扩容。</p> <p><img src="/javablog/public/assets/img/1717425547702.aae5aea0.png" alt="1717425547702"></p></li> <li><p>分片数不能改变，但是可以改变每个分片的副本数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PUT /索引/_settings
{
  &quot;number_of_replicas&quot;: 副本数
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <h3 id="_6-优化-内存设置"><a href="#_6-优化-内存设置" class="header-anchor">#</a> 6, 优化_内存设置</h3> <p>ES默认占用内存是4GB，我们可以修改config/jvm.option设置ES的堆内存大小，Xms表示堆内存的初始大小，Xmx表示可分配的最大内存。</p> <ul><li>Xmx和Xms的大小设置为相同的，可以减轻伸缩堆大小带来的压力。</li> <li>Xmx和Xms不要超过物理内存的50%，因为ES内部的Lucene也要占据一部分物理内存。</li> <li>Xmx和Xms不要超过32GB，由于Java语言的特性，堆内存超过32G会浪费大量系统资源，所以在内存足够的情况下，最终我们都会采用设置为31G：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>-Xms 31g
-Xmx 31g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例如：在一台128GB内存的机器中，我们可以创建两个节点，每个节点分配31GB内存。</p> <h3 id="_7-优化-磁盘选择"><a href="#_7-优化-磁盘选择" class="header-anchor">#</a> 7, 优化_磁盘选择</h3> <p>ES的优化即通过调整参数使得读写性能更快</p> <p>磁盘通常是服务器的瓶颈。Elasticsearch重度使用磁盘，磁盘的效率越高，Elasticsearch的执行效率就越高。这里有一些优化磁盘的技巧：</p> <ul><li>使用SSD（固态硬盘），它比机械磁盘优秀多了。</li> <li>使用RAID0模式（将连续的数据分散到多个硬盘存储，这样可以并行进行IO操作）,代价是一块硬盘发生故障就会引发系统故障。</li> <li>不要使用远程挂载的存储。</li></ul> <h3 id="_8-优化-分片策略"><a href="#_8-优化-分片策略" class="header-anchor">#</a> 8, 优化_分片策略</h3> <p>分片和副本数并不是越多越好。每个分片的底层都是一个Lucene索引，会消耗一定的系统资源。且搜索请求需要命中索引中的所有分片，分片数过多会降低搜索性能。索引的分片数需要架构师和技术人员对业务的增长有预先的判断，一般来说我们遵循以下原则：</p> <ul><li><p>每个分片占用的硬盘容量不超过ES的最大JVM的堆空间设置(一般设置不超过32G）。比如：如果索引的总容量在500G左右，那分片数量在16个左右即可。</p></li> <li><p>分片数一般不超过节点数的3倍。比如：如果集群内有10个节点，则分片数不超过30个。</p></li> <li><p>推迟分片分配：节点中断后集群会重新分配分片。但默认集群会等待一分钟来查看节点是否重新加入。我们可以设置等待的时长，减少重新分配的次数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PUT /索引/_settings
{
  &quot;settings&quot;:{
    &quot;index.unassianed.node_left.delayed_timeout&quot;:&quot;5m&quot;
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>减少副本数量：进行写入操作时，需要把写入的数据都同步到副本，副本越多写入的效率就越慢。我们进行大批量进行写入操作时可以先设置副本数为0，写入完成后再修改回正常的状态。</p></li></ul> <h2 id="七-es案例"><a href="#七-es案例" class="header-anchor">#</a> 七，ES案例</h2> <h3 id="_1-案例-需求说明"><a href="#_1-案例-需求说明" class="header-anchor">#</a> 1, 案例_需求说明</h3> <p>接下来我们使用ES模仿百度搜索，即自动补全+搜索引擎效果：</p> <p><img src="/javablog/public/assets/img/1717426232279.47b67868.png" alt="1717426232279"></p> <h3 id="_2-案例-自动补全"><a href="#_2-案例-自动补全" class="header-anchor">#</a> 2, 案例_自动补全</h3> <p>es为我们提供了关键词的自动补全功能：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>索引<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;suggest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;prefix_suggestion&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 自定义推荐名</span>
      <span class="token string-property property">&quot;prefix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;elastic&quot;</span><span class="token punctuation">,</span><span class="token comment">// 被补全的关键字</span>
      <span class="token string-property property">&quot;completion&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;productName&quot;</span><span class="token punctuation">,</span><span class="token comment">// 查询的域</span>
        <span class="token string-property property">&quot;skip_duplicates&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 忽略重复结果</span>
        <span class="token string-property property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token comment">//最多查询到的结果数</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注：自动补全对性能要求极高，ES不是通过倒排索引来实现的，所以需要将对应的查询字段类型设置为completion。</p> <p>创建索引：</p> <p><img src="/javablog/public/assets/img/1717426389027.a74cf558.png" alt="1717426389027"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>product2
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;productName&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;completion&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;productDesc&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> 
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;store&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>product2<span class="token operator">/</span>_doc
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;productName&quot;</span><span class="token operator">:</span><span class="token string">&quot;elasticsearch1&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;productDesc&quot;</span><span class="token operator">:</span><span class="token string">&quot;elasticsearch1 is a good search engine&quot;</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>product2<span class="token operator">/</span>_doc
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;productName&quot;</span><span class="token operator">:</span><span class="token string">&quot;elasticsearch2&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;productDesc&quot;</span><span class="token operator">:</span><span class="token string">&quot;elasticsearch2 is a good search engine&quot;</span>
<span class="token punctuation">}</span>


<span class="token constant">POST</span> <span class="token operator">/</span>product2<span class="token operator">/</span>_doc
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;productName&quot;</span><span class="token operator">:</span><span class="token string">&quot;elasticsearch3&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;productDesc&quot;</span><span class="token operator">:</span><span class="token string">&quot;elasticsearch3 is a good search engine&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>查询：</p> <p><img src="/javablog/public/assets/img/1717426589392.d244bbfe.png" alt="1717426589392"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">GET</span> <span class="token operator">/</span>product2<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;suggest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;prefix_suggestion&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 自定义推荐名</span>
      <span class="token string-property property">&quot;prefix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;elastic&quot;</span><span class="token punctuation">,</span><span class="token comment">// 被补全的关键字</span>
      <span class="token string-property property">&quot;completion&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;productName&quot;</span><span class="token punctuation">,</span><span class="token comment">// 查询的域</span>
        <span class="token string-property property">&quot;skip_duplicates&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 忽略重复结果</span>
        <span class="token string-property property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token comment">//最多查询到的结果数</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-案例-创建索引"><a href="#_3-案例-创建索引" class="header-anchor">#</a> 3, 案例_创建索引</h3> <p>新闻数据：</p> <p><img src="/javablog/public/assets/img/1717426871063.ca01eb9e.png" alt="1717426871063"></p> <p>创建索引：</p> <p><img src="/javablog/public/assets/img/1717427010996.d00cebbe.png" alt="1717427010996"></p> <p><img src="/javablog/public/assets/img/1717427044988.858b955f.png" alt="1717427044988"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">PUT</span> <span class="token operator">/</span>news
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;analysis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;ik_pinyin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;tokenizer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pinyin_filter&quot;</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;tag_pinyin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;tokenizer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pinyin_filter&quot;</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;pinyin_filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pinyin&quot;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;keep_joined_full_pinyin&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;keep_original&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;remove_duplicated_term&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_pinyin&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_pinyin&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;completion&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tag_pinyin&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;search_analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tag_pinyin&quot;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="_4-案例-导入数据"><a href="#_4-案例-导入数据" class="header-anchor">#</a> 4, 案例_导入数据</h3> <p>使用logstash工具可以将mysql数据同步到es中：</p> <ol><li><p>解压logstash-8.10.4-windows-x86_64</p> <blockquote><p>logstash要和elastisearch版本一致</p></blockquote></li> <li><p>在logstash解压路径下的/config中创建mysql.conf文件，文件写入以下脚本内容：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>input {
   jdbc {
     jdbc_driver_library =&gt; &quot;D:/develop/mysql-connector-java-5.1.37-bin.jar&quot;
     jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;
     jdbc_connection_string =&gt; &quot;jdbc:mysql://123.249.16.147:3306/ityls666&quot;
     jdbc_user =&gt; &quot;ityls666&quot;
     jdbc_password =&gt; &quot;ityls666&quot;
     schedule =&gt; &quot;* * * * *&quot;
     jdbc_default_timezone =&gt; &quot;Asia/Shanghai&quot;
     statement =&gt; &quot;SELECT * FROM news;&quot;
   }
}
filter {
    mutate {
        split =&gt; {&quot;tags&quot; =&gt; &quot;,&quot;}
    }
}
output {
   elasticsearch {
        hosts =&gt; &quot;localhost:9200&quot;
     index =&gt; &quot;news&quot;
       document_id =&gt; &quot;%{id}&quot;
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>在解压路径下打开cmd黑窗口，运行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bin\logstash -f config\mysql.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看</p> <p><img src="/javablog/public/assets/img/1717428098312.82b70cc2.png" alt="1717428098312"></p></li> <li><p>测试自动补齐</p> <p><img src="/javablog/public/assets/img/1717428166486.a61faa93.png" alt="1717428166486"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>GET /news/_search
{
  &quot;suggest&quot;: {
    &quot;my_suggest&quot;: {
      &quot;prefix&quot;: &quot;li&quot;,
      &quot;completion&quot;: {
        &quot;field&quot;: &quot;tags&quot;,
        &quot;skip_duplicates&quot;: true,
        &quot;size&quot;: 10
       }
     }
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h3 id="_5-案例-项目搭建"><a href="#_5-案例-项目搭建" class="header-anchor">#</a> 5, 案例_项目搭建</h3> <p>创建项目：</p> <p><img src="/javablog/public/assets/img/1717428930123.d78947a7.png" alt="1717428930123"></p> <p>依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>配置：</p> <p><img src="/javablog/public/assets/img/1717428986683.51c8a782.png" alt="1717428986683"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 连接elasticsearch</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
<span class="token key atrule">uris</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">9200</span>

<span class="token comment"># 日志格式</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
<span class="token key atrule">pattern</span><span class="token punctuation">:</span>
<span class="token key atrule">console</span><span class="token punctuation">:</span> <span class="token string">'%d{HH:mm:ss.SSS} %clr(%-5level) ---  [%-15thread] %cyan(%-50logger{50}):%msg%n'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>启动项目，如下不报错，说明配置没有问题：</p> <p><img src="/javablog/public/assets/img/1717429056860.8abbb6eb.png" alt="1717429056860"></p> <h3 id="_6-案例-创建实体类、repository接口"><a href="#_6-案例-创建实体类、repository接口" class="header-anchor">#</a> 6, 案例_创建实体类、Repository接口</h3> <p>创建实体类：</p> <p><img src="/javablog/public/assets/img/1717429131208.fd6cbf98.png" alt="1717429131208"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">CompletionField</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>suggest<span class="token punctuation">.</span></span><span class="token class-name">Completion</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">&quot;news&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">News</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@CompletionField</span>
    <span class="token comment">//@Transient</span>
    <span class="token keyword">private</span> <span class="token class-name">Completion</span> tags<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>创建Repository接口：</p> <p><img src="/javablog/public/assets/img/1717429350597.325282af.png" alt="1717429350597"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">News</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_7-案例-自动补全功能"><a href="#_7-案例-自动补全功能" class="header-anchor">#</a> 7, 案例_自动补全功能</h3> <p><img src="/javablog/public/assets/img/1717429608126.a43a85b2.png" alt="1717429608126"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">co<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">co<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">SearchResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">co<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">CompletionSuggestOption</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">co<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">FieldSuggester</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">co<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">Suggester</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">co<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span>search<span class="token punctuation">.</span></span><span class="token class-name">Suggestion</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">News</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">NewsRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">SearchHit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ElasticsearchClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsRepository</span> repository<span class="token punctuation">;</span>

    <span class="token comment">// 自动补齐</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">autoSuggest</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyword<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.创建自动补齐查询条件</span>
        <span class="token class-name">Suggester</span> suggester <span class="token operator">=</span> <span class="token class-name">Suggester</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">suggesters</span><span class="token punctuation">(</span><span class="token string">&quot;prefix_suggestion&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FieldSuggester</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                        fs <span class="token operator">-&gt;</span> fs<span class="token punctuation">.</span><span class="token function">completion</span><span class="token punctuation">(</span>
                                cs <span class="token operator">-&gt;</span> cs<span class="token punctuation">.</span><span class="token function">skipDuplicates</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;tags&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.自动补齐查询</span>
        <span class="token class-name">SearchResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;news&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">suggest</span><span class="token punctuation">(</span>suggester<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.处理查询结果</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Suggestion</span><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">suggest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Suggestion</span><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> suggestionList <span class="token operator">=</span> resultMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;prefix_suggestion&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Suggestion</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> suggestion <span class="token operator">=</span> suggestionList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompletionSuggestOption</span><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> suggestion<span class="token punctuation">.</span><span class="token function">completion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CompletionSuggestOption</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> completionSuggestOption <span class="token operator">:</span> resultList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> text <span class="token operator">=</span> completionSuggestOption<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717429803942.06535abc.png" alt="1717429803942"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsService</span> newsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSuggest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> li <span class="token operator">=</span> newsService<span class="token punctuation">.</span><span class="token function">autoSuggest</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        li<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_8-案例-高亮搜索关键字"><a href="#_8-案例-高亮搜索关键字" class="header-anchor">#</a> 8, 案例_高亮搜索关键字</h3> <p>接口：</p> <p><img src="/javablog/public/assets/img/1717429862810.63432fbe.png" alt="1717429862810"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 高亮搜索关键字</span>
    <span class="token annotation punctuation">@Highlight</span><span class="token punctuation">(</span>fields <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@HighlightField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@HighlightField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchHit</span><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByTitleMatchesOrContentMatches</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>实现类：</p> <p><img src="/javablog/public/assets/img/1717429929872.616cf2f3.png" alt="1717429929872"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 查询关键字</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">highLightSearch</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyword<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchHit</span><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByTitleMatchesOrContentMatches</span><span class="token punctuation">(</span>keyword<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理结果，封装为News类型的集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsSearchHit <span class="token operator">:</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">News</span> news <span class="token operator">=</span> newsSearchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 高亮字段</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> highlightFields <span class="token operator">=</span> newsSearchHit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                news<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                news<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>highlightFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            newsList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>news<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> newsList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1717430043457.92516180.png" alt="1717430043457"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsList <span class="token operator">=</span> newsService<span class="token punctuation">.</span><span class="token function">highLightSearch</span><span class="token punctuation">(</span><span class="token string">&quot;演员&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newsList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_9-案例-编写controller"><a href="#_9-案例-编写controller" class="header-anchor">#</a> 9, 案例_编写Controller</h3> <p>写controller:</p> <p><img src="/javablog/public/assets/img/1717430176108.f991850e.png" alt="1717430176108"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">News</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">NewsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsService</span> newsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/autoSuggest&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">autoSuggest</span><span class="token punctuation">(</span><span class="token class-name">String</span> term<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newsService<span class="token punctuation">.</span><span class="token function">autoSuggest</span><span class="token punctuation">(</span>term<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/highLightSearch&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">highLightSearch</span><span class="token punctuation">(</span><span class="token class-name">String</span> term<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> newsService<span class="token punctuation">.</span><span class="token function">highLightSearch</span><span class="token punctuation">(</span>term<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_10-案例-前端页面"><a href="#_10-案例-前端页面" class="header-anchor">#</a> 10, 案例_前端页面</h3> <p><img src="/javablog/public/assets/img/1717430382865.1c5e72cc.png" alt="1717430382865"></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/4/2024, 12:07:22 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#一-es初识" class="sidebar-link reco-side-一-es初识" data-v-b57cc07c>一，ES初识</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_1-elasticsearch介绍" class="sidebar-link reco-side-_1-elasticsearch介绍" data-v-b57cc07c>1，Elasticsearch介绍</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_2-什么是倒排索引" class="sidebar-link reco-side-_2-什么是倒排索引" data-v-b57cc07c>2，什么是倒排索引</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_3-es的出现和应用场景" class="sidebar-link reco-side-_3-es的出现和应用场景" data-v-b57cc07c>3，ES的出现和应用场景</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_4-es对比solr" class="sidebar-link reco-side-_4-es对比solr" data-v-b57cc07c>4，ES对比Solr</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_5-es数据结构" class="sidebar-link reco-side-_5-es数据结构" data-v-b57cc07c>5，ES数据结构</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_6-安装es" class="sidebar-link reco-side-_6-安装es" data-v-b57cc07c>6，安装ES</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_7-安装kibana" class="sidebar-link reco-side-_7-安装kibana" data-v-b57cc07c>7，安装kibana</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#二-常用操作" class="sidebar-link reco-side-二-常用操作" data-v-b57cc07c>二，常用操作</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_1-索引操作" class="sidebar-link reco-side-_1-索引操作" data-v-b57cc07c>1, 索引操作</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_2-文档操作-1" class="sidebar-link reco-side-_2-文档操作-1" data-v-b57cc07c>2, 文档操作（1）</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_3-文档操作-2" class="sidebar-link reco-side-_3-文档操作-2" data-v-b57cc07c>3, 文档操作（2）</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_4-域的属性-index" class="sidebar-link reco-side-_4-域的属性-index" data-v-b57cc07c>4, 域的属性_index</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_5-域的属性-type" class="sidebar-link reco-side-_5-域的属性-type" data-v-b57cc07c>5, 域的属性_type</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_6-域的属性-store" class="sidebar-link reco-side-_6-域的属性-store" data-v-b57cc07c>6, 域的属性_store</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#三-分词器" class="sidebar-link reco-side-三-分词器" data-v-b57cc07c>三，分词器</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_1-默认分词器" class="sidebar-link reco-side-_1-默认分词器" data-v-b57cc07c>1, 默认分词器</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_2-ik分词器安装" class="sidebar-link reco-side-_2-ik分词器安装" data-v-b57cc07c>2, IK分词器安装</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_3-ik分词器词典" class="sidebar-link reco-side-_3-ik分词器词典" data-v-b57cc07c>3, IK分词器词典</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_4-拼音分词器" class="sidebar-link reco-side-_4-拼音分词器" data-v-b57cc07c>4, 拼音分词器</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_5-自定义分词器" class="sidebar-link reco-side-_5-自定义分词器" data-v-b57cc07c>5, 自定义分词器</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#四-elasticsearch搜索文档" class="sidebar-link reco-side-四-elasticsearch搜索文档" data-v-b57cc07c>四，Elasticsearch搜索文档</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_1-准备工作" class="sidebar-link reco-side-_1-准备工作" data-v-b57cc07c>1, 准备工作</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_2-搜索方式-1" class="sidebar-link reco-side-_2-搜索方式-1" data-v-b57cc07c>2, 搜索方式（1）</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_3-搜索方式-2" class="sidebar-link reco-side-_3-搜索方式-2" data-v-b57cc07c>3, 搜索方式（2）</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_4-复合搜索" class="sidebar-link reco-side-_4-复合搜索" data-v-b57cc07c>4, 复合搜索</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_5-结果排序和分页查询" class="sidebar-link reco-side-_5-结果排序和分页查询" data-v-b57cc07c>5, 结果排序和分页查询</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_6-高亮查询" class="sidebar-link reco-side-_6-高亮查询" data-v-b57cc07c>6, 高亮查询</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_7-sql查询" class="sidebar-link reco-side-_7-sql查询" data-v-b57cc07c>7, SQL查询</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#五-springdataes" class="sidebar-link reco-side-五-springdataes" data-v-b57cc07c>五，SpringDataES</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_1-项目搭建" class="sidebar-link reco-side-_1-项目搭建" data-v-b57cc07c>1, 项目搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_2-编写实体类" class="sidebar-link reco-side-_2-编写实体类" data-v-b57cc07c>2, 编写实体类</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_3-repository接口" class="sidebar-link reco-side-_3-repository接口" data-v-b57cc07c>3, Repository接口</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_4-dsl查询文档" class="sidebar-link reco-side-_4-dsl查询文档" data-v-b57cc07c>4, DSL查询文档</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_5-按照规则命名查询方法" class="sidebar-link reco-side-_5-按照规则命名查询方法" data-v-b57cc07c>5, 按照规则命名查询方法</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_6-分页查询" class="sidebar-link reco-side-_6-分页查询" data-v-b57cc07c>6, 分页查询</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_7-结果排序" class="sidebar-link reco-side-_7-结果排序" data-v-b57cc07c>7, 结果排序</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_8-template操作索引" class="sidebar-link reco-side-_8-template操作索引" data-v-b57cc07c>8, template操作索引</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_9-template操作文档" class="sidebar-link reco-side-_9-template操作文档" data-v-b57cc07c>9, template操作文档</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_10-template查询文档" class="sidebar-link reco-side-_10-template查询文档" data-v-b57cc07c>10, template查询文档</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_11-template复杂条件查询" class="sidebar-link reco-side-_11-template复杂条件查询" data-v-b57cc07c>11, template复杂条件查询</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_12-template分页查询" class="sidebar-link reco-side-_12-template分页查询" data-v-b57cc07c>12, template分页查询</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_13-template结果排序" class="sidebar-link reco-side-_13-template结果排序" data-v-b57cc07c>13, template结果排序</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#六-集群" class="sidebar-link reco-side-六-集群" data-v-b57cc07c>六，集群</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_1-集群-概念" class="sidebar-link reco-side-_1-集群-概念" data-v-b57cc07c>1, 集群_概念</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_2-集群-搭建集群-1" class="sidebar-link reco-side-_2-集群-搭建集群-1" data-v-b57cc07c>2, 集群_搭建集群(1)</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_3-集群-配置kibana" class="sidebar-link reco-side-_3-集群-配置kibana" data-v-b57cc07c>3, 集群_配置kibana</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_4-集群-测试集群状态" class="sidebar-link reco-side-_4-集群-测试集群状态" data-v-b57cc07c>4, 集群_测试集群状态</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_5-集群-故障应对、水平扩容" class="sidebar-link reco-side-_5-集群-故障应对、水平扩容" data-v-b57cc07c>5, 集群_故障应对、水平扩容</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_6-优化-内存设置" class="sidebar-link reco-side-_6-优化-内存设置" data-v-b57cc07c>6, 优化_内存设置</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_7-优化-磁盘选择" class="sidebar-link reco-side-_7-优化-磁盘选择" data-v-b57cc07c>7, 优化_磁盘选择</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_8-优化-分片策略" class="sidebar-link reco-side-_8-优化-分片策略" data-v-b57cc07c>8, 优化_分片策略</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#七-es案例" class="sidebar-link reco-side-七-es案例" data-v-b57cc07c>七，ES案例</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_1-案例-需求说明" class="sidebar-link reco-side-_1-案例-需求说明" data-v-b57cc07c>1, 案例_需求说明</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_2-案例-自动补全" class="sidebar-link reco-side-_2-案例-自动补全" data-v-b57cc07c>2, 案例_自动补全</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_3-案例-创建索引" class="sidebar-link reco-side-_3-案例-创建索引" data-v-b57cc07c>3, 案例_创建索引</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_4-案例-导入数据" class="sidebar-link reco-side-_4-案例-导入数据" data-v-b57cc07c>4, 案例_导入数据</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_5-案例-项目搭建" class="sidebar-link reco-side-_5-案例-项目搭建" data-v-b57cc07c>5, 案例_项目搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_6-案例-创建实体类、repository接口" class="sidebar-link reco-side-_6-案例-创建实体类、repository接口" data-v-b57cc07c>6, 案例_创建实体类、Repository接口</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_7-案例-自动补全功能" class="sidebar-link reco-side-_7-案例-自动补全功能" data-v-b57cc07c>7, 案例_自动补全功能</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_8-案例-高亮搜索关键字" class="sidebar-link reco-side-_8-案例-高亮搜索关键字" data-v-b57cc07c>8, 案例_高亮搜索关键字</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_9-案例-编写controller" class="sidebar-link reco-side-_9-案例-编写controller" data-v-b57cc07c>9, 案例_编写Controller</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/storage/es/es.html#_10-案例-前端页面" class="sidebar-link reco-side-_10-案例-前端页面" data-v-b57cc07c>10, 案例_前端页面</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/javablog/public/assets/js/app.42e86726.js" defer></script><script src="/javablog/public/assets/js/66.fc23a08c.js" defer></script><script src="/javablog/public/assets/js/1.3c422ec2.js" defer></script><script src="/javablog/public/assets/js/22.2af5b9b8.js" defer></script>
  </body>
</html>
