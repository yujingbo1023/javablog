<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx精讲 | 码路全栈开发</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/javablog/public/favicon.ico">
    <meta name="description" content="快来玩java全栈呀">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/javablog/public/assets/css/0.styles.0bd56f36.css" as="style"><link rel="preload" href="/javablog/public/assets/js/app.71fab523.js" as="script"><link rel="preload" href="/javablog/public/assets/js/72.426fa802.js" as="script"><link rel="preload" href="/javablog/public/assets/js/1.3c422ec2.js" as="script"><link rel="preload" href="/javablog/public/assets/js/21.579006c6.js" as="script"><link rel="prefetch" href="/javablog/public/assets/js/10.3e2e7c7f.js"><link rel="prefetch" href="/javablog/public/assets/js/100.65bb4d60.js"><link rel="prefetch" href="/javablog/public/assets/js/101.bff31c65.js"><link rel="prefetch" href="/javablog/public/assets/js/102.67798ad3.js"><link rel="prefetch" href="/javablog/public/assets/js/103.e50fbd6a.js"><link rel="prefetch" href="/javablog/public/assets/js/104.1a471b0a.js"><link rel="prefetch" href="/javablog/public/assets/js/105.46cd09f2.js"><link rel="prefetch" href="/javablog/public/assets/js/106.a6b2977a.js"><link rel="prefetch" href="/javablog/public/assets/js/107.cc3bbfb4.js"><link rel="prefetch" href="/javablog/public/assets/js/108.e5b804c7.js"><link rel="prefetch" href="/javablog/public/assets/js/109.3e15478f.js"><link rel="prefetch" href="/javablog/public/assets/js/11.5f91e392.js"><link rel="prefetch" href="/javablog/public/assets/js/110.de1d7659.js"><link rel="prefetch" href="/javablog/public/assets/js/111.fd00d46f.js"><link rel="prefetch" href="/javablog/public/assets/js/112.1bcdc0dd.js"><link rel="prefetch" href="/javablog/public/assets/js/113.15b30e49.js"><link rel="prefetch" href="/javablog/public/assets/js/114.d0d73939.js"><link rel="prefetch" href="/javablog/public/assets/js/115.ee7fb86f.js"><link rel="prefetch" href="/javablog/public/assets/js/116.a08075fb.js"><link rel="prefetch" href="/javablog/public/assets/js/117.d938e7d8.js"><link rel="prefetch" href="/javablog/public/assets/js/118.a87f0776.js"><link rel="prefetch" href="/javablog/public/assets/js/119.1db021f4.js"><link rel="prefetch" href="/javablog/public/assets/js/12.a855da84.js"><link rel="prefetch" href="/javablog/public/assets/js/120.af7b8cb1.js"><link rel="prefetch" href="/javablog/public/assets/js/121.a7889762.js"><link rel="prefetch" href="/javablog/public/assets/js/122.4b24d970.js"><link rel="prefetch" href="/javablog/public/assets/js/123.f40ca793.js"><link rel="prefetch" href="/javablog/public/assets/js/124.19f98fbe.js"><link rel="prefetch" href="/javablog/public/assets/js/125.86fe034b.js"><link rel="prefetch" href="/javablog/public/assets/js/126.9f007ac1.js"><link rel="prefetch" href="/javablog/public/assets/js/127.cdd9415b.js"><link rel="prefetch" href="/javablog/public/assets/js/128.34dc3b4e.js"><link rel="prefetch" href="/javablog/public/assets/js/129.c656d860.js"><link rel="prefetch" href="/javablog/public/assets/js/13.8dbe13b1.js"><link rel="prefetch" href="/javablog/public/assets/js/130.7f9a47ea.js"><link rel="prefetch" href="/javablog/public/assets/js/131.c015cb4d.js"><link rel="prefetch" href="/javablog/public/assets/js/132.4df00b8f.js"><link rel="prefetch" href="/javablog/public/assets/js/133.795d0959.js"><link rel="prefetch" href="/javablog/public/assets/js/134.89243b14.js"><link rel="prefetch" href="/javablog/public/assets/js/135.cb522461.js"><link rel="prefetch" href="/javablog/public/assets/js/136.6b725b0a.js"><link rel="prefetch" href="/javablog/public/assets/js/137.952df0f3.js"><link rel="prefetch" href="/javablog/public/assets/js/138.0d39f499.js"><link rel="prefetch" href="/javablog/public/assets/js/139.5f6020af.js"><link rel="prefetch" href="/javablog/public/assets/js/14.56ea5052.js"><link rel="prefetch" href="/javablog/public/assets/js/140.cb415df3.js"><link rel="prefetch" href="/javablog/public/assets/js/141.746dceda.js"><link rel="prefetch" href="/javablog/public/assets/js/142.13675eb8.js"><link rel="prefetch" href="/javablog/public/assets/js/143.ca1d50c9.js"><link rel="prefetch" href="/javablog/public/assets/js/144.e59e4509.js"><link rel="prefetch" href="/javablog/public/assets/js/15.b3fc3e4d.js"><link rel="prefetch" href="/javablog/public/assets/js/16.5064472f.js"><link rel="prefetch" href="/javablog/public/assets/js/17.026ce5f4.js"><link rel="prefetch" href="/javablog/public/assets/js/18.23b845dd.js"><link rel="prefetch" href="/javablog/public/assets/js/19.fef568b3.js"><link rel="prefetch" href="/javablog/public/assets/js/20.94571833.js"><link rel="prefetch" href="/javablog/public/assets/js/22.d917198b.js"><link rel="prefetch" href="/javablog/public/assets/js/23.0dc1025b.js"><link rel="prefetch" href="/javablog/public/assets/js/24.1ac3d230.js"><link rel="prefetch" href="/javablog/public/assets/js/25.859861ce.js"><link rel="prefetch" href="/javablog/public/assets/js/26.b727a960.js"><link rel="prefetch" href="/javablog/public/assets/js/27.82157a77.js"><link rel="prefetch" href="/javablog/public/assets/js/28.2e330f5b.js"><link rel="prefetch" href="/javablog/public/assets/js/29.1bf36d84.js"><link rel="prefetch" href="/javablog/public/assets/js/3.fa2d64f7.js"><link rel="prefetch" href="/javablog/public/assets/js/30.0c899a73.js"><link rel="prefetch" href="/javablog/public/assets/js/31.3ab836bd.js"><link rel="prefetch" href="/javablog/public/assets/js/32.a401b7c4.js"><link rel="prefetch" href="/javablog/public/assets/js/33.cb14c935.js"><link rel="prefetch" href="/javablog/public/assets/js/34.fd4eb3e9.js"><link rel="prefetch" href="/javablog/public/assets/js/35.c4e9b37e.js"><link rel="prefetch" href="/javablog/public/assets/js/36.28fb157b.js"><link rel="prefetch" href="/javablog/public/assets/js/37.1550b76f.js"><link rel="prefetch" href="/javablog/public/assets/js/38.8b8c052a.js"><link rel="prefetch" href="/javablog/public/assets/js/39.e551b0d5.js"><link rel="prefetch" href="/javablog/public/assets/js/4.67753cdc.js"><link rel="prefetch" href="/javablog/public/assets/js/40.c9a7de43.js"><link rel="prefetch" href="/javablog/public/assets/js/41.36efad2d.js"><link rel="prefetch" href="/javablog/public/assets/js/42.bb4e3a48.js"><link rel="prefetch" href="/javablog/public/assets/js/43.b288ec7e.js"><link rel="prefetch" href="/javablog/public/assets/js/44.ad31d855.js"><link rel="prefetch" href="/javablog/public/assets/js/45.6a1285f4.js"><link rel="prefetch" href="/javablog/public/assets/js/46.7f0a893a.js"><link rel="prefetch" href="/javablog/public/assets/js/47.5ae4e84a.js"><link rel="prefetch" href="/javablog/public/assets/js/48.3a6c3d85.js"><link rel="prefetch" href="/javablog/public/assets/js/49.d3562c4c.js"><link rel="prefetch" href="/javablog/public/assets/js/5.4df697c3.js"><link rel="prefetch" href="/javablog/public/assets/js/50.c7aeaca9.js"><link rel="prefetch" href="/javablog/public/assets/js/51.d21255b2.js"><link rel="prefetch" href="/javablog/public/assets/js/52.3a1cb849.js"><link rel="prefetch" href="/javablog/public/assets/js/53.910f098c.js"><link rel="prefetch" href="/javablog/public/assets/js/54.02dd0bd7.js"><link rel="prefetch" href="/javablog/public/assets/js/55.f601299e.js"><link rel="prefetch" href="/javablog/public/assets/js/56.3db9607f.js"><link rel="prefetch" href="/javablog/public/assets/js/57.938fac65.js"><link rel="prefetch" href="/javablog/public/assets/js/58.93dd49f5.js"><link rel="prefetch" href="/javablog/public/assets/js/59.23047f95.js"><link rel="prefetch" href="/javablog/public/assets/js/6.b14664fb.js"><link rel="prefetch" href="/javablog/public/assets/js/60.e35e2faf.js"><link rel="prefetch" href="/javablog/public/assets/js/61.a5e973eb.js"><link rel="prefetch" href="/javablog/public/assets/js/62.b2fbe005.js"><link rel="prefetch" href="/javablog/public/assets/js/63.e7c72c4d.js"><link rel="prefetch" href="/javablog/public/assets/js/64.9d04d1f5.js"><link rel="prefetch" href="/javablog/public/assets/js/65.a76b1cd0.js"><link rel="prefetch" href="/javablog/public/assets/js/66.ca2bbcd7.js"><link rel="prefetch" href="/javablog/public/assets/js/67.34ed2036.js"><link rel="prefetch" href="/javablog/public/assets/js/68.e548b76e.js"><link rel="prefetch" href="/javablog/public/assets/js/69.84d27c78.js"><link rel="prefetch" href="/javablog/public/assets/js/7.ebab8817.js"><link rel="prefetch" href="/javablog/public/assets/js/70.7a5636d0.js"><link rel="prefetch" href="/javablog/public/assets/js/71.a2398ef9.js"><link rel="prefetch" href="/javablog/public/assets/js/73.53d9cf6f.js"><link rel="prefetch" href="/javablog/public/assets/js/74.74d3adf6.js"><link rel="prefetch" href="/javablog/public/assets/js/75.287a3b57.js"><link rel="prefetch" href="/javablog/public/assets/js/76.76e5264f.js"><link rel="prefetch" href="/javablog/public/assets/js/77.1ec52958.js"><link rel="prefetch" href="/javablog/public/assets/js/78.6ecddb13.js"><link rel="prefetch" href="/javablog/public/assets/js/79.80439570.js"><link rel="prefetch" href="/javablog/public/assets/js/8.c708997a.js"><link rel="prefetch" href="/javablog/public/assets/js/80.e8ace8b7.js"><link rel="prefetch" href="/javablog/public/assets/js/81.ebec4e2d.js"><link rel="prefetch" href="/javablog/public/assets/js/82.0542200c.js"><link rel="prefetch" href="/javablog/public/assets/js/83.b3df0f0d.js"><link rel="prefetch" href="/javablog/public/assets/js/84.be217d79.js"><link rel="prefetch" href="/javablog/public/assets/js/85.a04cedcd.js"><link rel="prefetch" href="/javablog/public/assets/js/86.92a1227a.js"><link rel="prefetch" href="/javablog/public/assets/js/87.e468635e.js"><link rel="prefetch" href="/javablog/public/assets/js/88.f2cac14d.js"><link rel="prefetch" href="/javablog/public/assets/js/89.05477ede.js"><link rel="prefetch" href="/javablog/public/assets/js/9.af02c652.js"><link rel="prefetch" href="/javablog/public/assets/js/90.558fb22a.js"><link rel="prefetch" href="/javablog/public/assets/js/91.380f5981.js"><link rel="prefetch" href="/javablog/public/assets/js/92.0c8c54d1.js"><link rel="prefetch" href="/javablog/public/assets/js/93.1fb3318f.js"><link rel="prefetch" href="/javablog/public/assets/js/94.4862a9d1.js"><link rel="prefetch" href="/javablog/public/assets/js/95.9a3c2800.js"><link rel="prefetch" href="/javablog/public/assets/js/96.e55981f6.js"><link rel="prefetch" href="/javablog/public/assets/js/97.29e39d65.js"><link rel="prefetch" href="/javablog/public/assets/js/98.aa5fa0da.js"><link rel="prefetch" href="/javablog/public/assets/js/99.862e683c.js">
    <link rel="stylesheet" href="/javablog/public/assets/css/0.styles.0bd56f36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>码路全栈开发</h3> <p class="description" data-v-59e6cb88>快来玩java全栈呀</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>码路</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javablog/public/" class="home-link router-link-active"><img src="/javablog/public/logo.png" alt="码路全栈开发" class="logo"> <span class="site-name">码路全栈开发</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javablog/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      全栈开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/javablog/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/javablog/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/javablog/public/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    码路
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>134</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>42</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/javablog/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      全栈开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/javablog/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/javablog/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Nginx精讲</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>码路</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Nginx精讲</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>码路</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>12/15/2028</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>linux</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="一-nginx初识"><a href="#一-nginx初识" class="header-anchor">#</a> 一，Nginx初识</h2> <h3 id="_1-nginx概述"><a href="#_1-nginx概述" class="header-anchor">#</a> 1，Nginx概述</h3> <p>Nginx是一款轻量级的Web服务器、反向代理服务器，由于它的内存占用少，启动极快，高并发能力强，在互联网项目中广泛 应用。Nginx 专为性能优化而开发，使用异步非阻塞事件驱动模型。</p> <p>没有nginx的情况下：</p> <p><img src="/javablog/public/assets/img/1716456018591.35f317a3.png" alt="1716456018591"></p> <p>有了nginx的情况下：</p> <p><img src="/javablog/public/assets/img/1716456082401.f7adc7bf.png" alt="1716456082401"></p> <h3 id="_2-nginx四大应用场景"><a href="#_2-nginx四大应用场景" class="header-anchor">#</a> 2，Nginx四大应用场景</h3> <p><strong>充当HTTP服务器：</strong></p> <p>Nginx本身也是一个静态资源的服务器，当只有静态资源的时候，就可以使用Nginx来做服务器，如果一个网站只是静态页面的话， 那么就可以通过这种方式来实现部署。</p> <p><img src="/javablog/public/assets/img/1716456127717.635dff69.png" alt="1716456127717"></p> <p><strong>反向代理：</strong></p> <p>反向代理应该是Nginx使用最多的功能了，反向代理(Reverse Proxy)方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</p> <p><img src="/javablog/public/assets/img/1716456248854.e770bfb0.png" alt="1716456248854"></p> <p><strong>负载均衡：</strong></p> <p>负载均衡也是Nginx常用的一个功能，负载均衡其意思就是分摊到多个操作单元上进行执行，例如Web服务器、FTP服务器、企业关键应用服务器和其它关键任务服务器等，从而共同完成工作任务。</p> <p><img src="/javablog/public/assets/img/1716456354672.79634e70.png" alt="1716456354672"></p> <p><strong>动静分离</strong></p> <p>动静分离是让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作，这就是网站静态化处理的核心思路。</p> <p><img src="/javablog/public/assets/img/1716456525774.09ef6867.png" alt="1716456525774"></p> <h3 id="_3-为什么用nginx"><a href="#_3-为什么用nginx" class="header-anchor">#</a> 3，为什么用Nginx</h3> <p>互联网飞速发展的今天,大用户量高并发已经成为互联网的主体.怎样能让一个网站能够承载几万个或几十万个用户的持续访问呢？</p> <p><strong>单机架构：</strong></p> <p><img src="/javablog/public/assets/img/1716456660271.a4147f1a.png" alt="1716456660271"></p> <p>Tomcat 默认配置的最大请求数是150，也就是说同时支持150个并发。具体能承载多少并发，须要看硬件的配置，线程CPU 越多性能越高，分配给JVM的内存越多性能也就越高，但也会加剧GC的负担。</p> <p><strong>引入反向代理实现负载均衡：</strong></p> <p><img src="/javablog/public/assets/img/1716456704978.dd4c2da3.png" alt="1716456704978"></p> <p>负载均衡就是一个web服务器解决不了的问题可以通过多个web服务器来平均分担压力来解决，并发过来的请求被平均分配到多个后台web服务器来处理，这样压力就被分解开来。</p> <h3 id="_4-环境准备"><a href="#_4-环境准备" class="header-anchor">#</a> 4，环境准备</h3> <p>操作系统：Centos7.5 X64</p> <p>确认可以上网：</p> <p><img src="/javablog/public/assets/img/1716456986455.dcfc3650.png" alt="1716456986455"></p> <p>确定yum源是否可用：</p> <p><img src="/javablog/public/assets/img/1716457040748.50f84508.png" alt="1716457040748"></p> <p>永久关闭防火墙：</p> <p><img src="/javablog/public/assets/img/1716457151026.3e084256.png" alt="1716457151026"></p> <p>关闭selinux防护：</p> <p><img src="/javablog/public/assets/img/1716457284632.6ab8f261.png" alt="1716457284632"></p> <p>安装（nginx所依赖的库）：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum -y install gcc make automake pcre-devel zlib zlib-devel openssl openssl-devel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1716457362543.fc7c7f1b.png" alt="1716457362543"></p> <p>说明：</p> <ul><li>gcc：编译依赖gcc环境</li> <li>pcre：PCRE(Perl Compatible Regular Expressions)是一个Perl库，包括 Perl 兼容的正则表达式库。</li> <li>zlib：zlib库提供了很多种压缩和解压缩的方式，Nginx使用zlib对http包的内容进行gzip，所以需要在linux上安装zlib库。</li> <li>Openssl：OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议，并提供丰富的应用程序供测试或其它目的使用。</li></ul> <h3 id="_5-nginx下载与安装"><a href="#_5-nginx下载与安装" class="header-anchor">#</a> 5，Nginx下载与安装</h3> <p>官网下载Nginx软件：http://Nginx.org</p> <p><img src="/javablog/public/assets/img/1716457484218.4c2c23f7.png" alt="1716457484218"></p> <p><img src="/javablog/public/assets/img/1716457524735.d404a37f.png" alt="1716457524735"></p> <p><strong>Nginx</strong> <strong>官方提供了三个类型的版本：</strong></p> <ul><li>Mainline Version：主线版，是最新版，但未经过过多的生产测试。</li> <li>Stable Version：稳定版，生产环境使用版本。</li> <li>Legacy Version：老版本。</li></ul> <p>注意：</p> <p>我们需要下载的是 Stable Version。其中又分为两种版本： Linux 版与 Windows 版。开发时这两个版本我们都下载。 Linux 版用于生产环境，而 Windows 版用于开发测试,选择需要的版本进行下载。</p> <p>Nginx源码编译步骤：</p> <ol><li>创建存放源文件的文件夹，首先在目录/opt下创建apps目录，用于存放源文件以及解压后的文件，上传Nginx到步骤1创建的目录下</li></ol> <p><img src="/javablog/public/assets/img/1716457708225.648aeb9e.png" alt="1716457708225"></p> <ol start="2"><li><p>解压nigix</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tar -zxvf nginx-1.20.1.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1716457827473.c5de1457.png" alt="1716457827473"></p> <p><img src="/javablog/public/assets/img/1716457922568.07de0aad.png" alt="1716457922568"></p></li> <li><p>生成makefile，在 Nginx 解压目录下运行 make 命令，用于完成编译。但此时会给出提示：没有指定目标，并且没有发现编译文件 makefile。</p> <p><img src="/javablog/public/assets/img/1716457978102.caf9537c.png" alt="1716457978102"></p> <p>编译命令 make 需要根据编译文件 makefile 进行编译，所以在编译之前需要先生成编译文件 makefile。使用 configure 命令可以生成该文件(目的是把环境检查一遍)。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@node1 Nginx-1.20.1]# mkdir -p /var/temp/nginx/client
[root@node1 Nginx-1.20.1]# pwd
/opt/apps/nginx-1.20.1
[root@node1 Nginx-1.20.1]# ./configure \
--prefix=/usr/local/nginx \
--pid-path=/usr/local/nginx/logs/nginx.pid \
--error-log-path=/usr/local/nginx/logs/error.log \
--http-log-path=/usr/local/nginx/logs/access.log \
--with-http_ssl_module \
--with-http_gzip_static_module \
--http-client-body-temp-path=/var/temp/nginx/client \
--http-proxy-temp-path=/var/temp/nginx/proxy \
--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \
--http-uwsgi-temp-path=/var/temp/nginx/uwsgi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/javablog/public/assets/img/1716458172993.d3f03b6a.png" alt="1716458172993"></p></li> <li><p>安装：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>make &amp;&amp; make install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：这是两个命令，make 为编译命令，make install 为安装命令，可以分别执行。这里使用&amp;&amp;将两个命令连接执行，会在前面命令执行成功的前提下才会执行第二个命令。</p></li></ol> <p>安装成功后：</p> <p><img src="/javablog/public/assets/img/1716458619966.56b0731c.png" alt="1716458619966"></p> <h3 id="_6-nginx目录详解"><a href="#_6-nginx目录详解" class="header-anchor">#</a> 6，Nginx目录详解</h3> <p>安装成功后：</p> <p><img src="/javablog/public/assets/img/1716458770825.61ffcd34.png" alt="1716458770825"></p> <p><strong>conf目录</strong></p> <p>Nginx所有配置文件的目录，极其重要。在该目录中包含一个Nginx.conf配置文件。</p> <p><img src="/javablog/public/assets/img/1716458834973.0a06b3b4.png" alt="1716458834973"></p> <p><strong>html目录</strong></p> <p>Nginx的默认站点目录。</p> <p><img src="/javablog/public/assets/img/1716458875108.5d5d65ac.png" alt="1716458875108"></p> <p><strong>logs目录</strong></p> <p>存放Nginx的日志文件。 access.log error.log</p> <p><img src="/javablog/public/assets/img/1716458904508.a285b994.png" alt="1716458904508"></p> <p><strong>sbin目录</strong></p> <p>Nginx命令的目录，如Nginx的启动命令。</p> <p><img src="/javablog/public/assets/img/1716458960678.1966cd64.png" alt="1716458960678"></p> <h3 id="_7-docker安装nginx"><a href="#_7-docker安装nginx" class="header-anchor">#</a> 7，Docker安装Nginx</h3> <p>拉取官方的Nginx镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> docker pull nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1716459207164.c0cd7ad5.png" alt="1716459207164"></p> <p>以下命令使用 Nginx 默认的配置来启动一个 Nginx 容器实例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@localhost ~]# docker run --rm --name mynginx -p 8080:80 -d nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数：</p> <ul><li>--rm：容器终止运行后，自动删除容器文件</li> <li>--name nginx-test：容器的名字叫做Nginx-test,名字自己定义</li> <li>-p: 端口进行映射，将本地 8080 端口映射到容器内部的 80 端口</li> <li>-d：容器启动后，在后台运行</li></ul> <p><img src="/javablog/public/assets/img/1716459234141.20446691.png" alt="1716459234141"></p> <p>Nginx服务部署,映射本地目录到Nginx容器，创建本地目录，用于存放Nginx的相关文件信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir -p /opt/nginx/www /opt/nginx/conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数：</p> <ul><li>www: 目录将映射为 nginx 容器配置的虚拟目录</li> <li>conf: 目录里的配置文件将映射为 nginx 容器的配置文件。</li></ul> <p>拷贝容器内Nginx默认配置文件到本地当前目录下的conf目录,容器ID可以查看docker ps命令输入中的第一列</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker cp 817475fdc4a2:/etc/nginx/nginx.conf /opt/nginx/conf/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1716459512426.a669b281.png" alt="1716459512426"></p> <p><strong>部署命令</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --rm -d -p 8081:80 --name mynginx \
  -v /opt/nginx/www:/usr/share/nginx/html \
  -v /opt/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \
  nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/javablog/public/assets/img/1716459694243.d2c59c99.png" alt="1716459694243"></p> <p>参数：</p> <ul><li>--rm：容器终止运行后，自动删除容器文件。</li> <li>-p 8081:80： 将容器的 80 端口映射到主机的 8082 端口</li> <li>--name mynginx：将容器命名为 mynginx</li> <li>-v /home/Nginx/www:/usr/share/Nginx/html：将我们自己创建的 www 目录挂载到容器的 /usr/share/Nginx/html。</li> <li>-v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf：将我们自己创建的 nginx.conf 挂载到容器的 /etc/nginx/nginx.conf。</li></ul> <h3 id="_8-nginx服务的启停控制"><a href="#_8-nginx服务的启停控制" class="header-anchor">#</a> 8，Nginx服务的启停控制</h3> <p>在Linux 平台下,启动Nginx服务器直接运行安装目录下sbin目录中的二进制文件即可。</p> <p><img src="/javablog/public/assets/img/1716459943704.00dcd32c.png" alt="1716459943704"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716460850951.a94c9b5e.png" alt="1716460850951"></p> <p>启动nginx所带的参数：</p> <ul><li>-v ： 打印版本号</li> <li>-V ： 打印版本号和配置</li> <li>-t：测试配置正确性并退出</li> <li>-q：测试配置时只显示错误</li> <li>-s：向主进程发送信号</li> <li>-p：指定Nginx服务器路径前缀</li> <li>-c： 指定Nginx配置文件路径</li> <li>-g： 指定Nginx附加配置文件路径</li></ul> <p><strong>Nginx服务的停止的两种方式：</strong></p> <ul><li><p>快速停止，快速停止是指立即停止当前Nginx服务正在处理的所有网络请求，马上丢弃连接，停止工作。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>nginx -s stop   # 快速关闭
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>平缓停止(建议使用平缓停止)，平缓停止是指允许Nginx服务将当前正在处理的网络请求处理完成，但不再接收新的请求，之后关闭连接，停止工作。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>nginx -s quit   # 等待工作进程处理完成后关闭
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716461114870.494dc934.png" alt="1716461114870"></p> <p><strong>Nginx服务的重启</strong></p> <p>更改Nginx服务器的配置和加入新模块后，如果希望当前的Nginx服务应用新的配置或使新模块生效，就需要重启Nginx服务。当然我们可以先关闭Nginx服务，然后使用新的Nginx配置文件重启服务。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>nginx -s reload # 向主进程发送信号，重新加载配置文件，热重启
nginx -s reopen # 重启 Nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1716461328941.9ccfdced.png" alt="1716461328941"></p> <h2 id="二-nginx配置指令详解"><a href="#二-nginx配置指令详解" class="header-anchor">#</a> 二，Nginx配置指令详解</h2> <p><img src="/javablog/public/assets/img/1716524339603.b04efc11.png" alt="1716524339603"></p> <h3 id="_1-全局块"><a href="#_1-全局块" class="header-anchor">#</a> 1，全局块</h3> <p><strong>配置运行Nginx服务器用户(组)：</strong> 用于配置运行Nginx服务器用户（组）的指令是user。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>user user [group]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：只有被设置的用户或者用户组成员才有权限启动你那个Nginx进程，如果是其他用户尝试启动Nginx进程，将报错。</p> <p>如果希望所有用户都可以启动Nginx进程，有两种办法：一是将次指令注释：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># user [user] [group]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者把用户（和用户组）设置为nobody；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>user nobody nobody;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：在Nginx配置文件中，每一条指令配置必须以分号结束，请不要忘记。</p> <p>**配置允许生成worker process数：**worker process是Nginx服务器实现并发处理的关键所在。理论来说worker_process的值越大，可以支持的并发处理也越多。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>worker_process number | auto
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>number 指定Nginx进程最多可以产生的worker_process数。</li> <li>auto ，设置此值，Nginx进程将自动检测。</li></ul> <p>在默认的配置文件中，Number=1.启动Nginx服务器后，使用以下命令可以看出Nginx服务器除了主进程master process ../sbin/Nginx之外，还生成了一个worker_process.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ps aux|grep Nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>**配置Nginx进程PID存放路径：**Nginx进程作为系统的守护进程运行，我们需要在某文件中保存当前运行程序的主进程号。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>pid file;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：次指令只能在全局快中设置。 在指令path的时候，一定要包括文件名，如果只设置了路径，没有设置文件名，会报错。</p> <p>**配置错误日志的存放路径：**在全局块、http块和 server 块中都可以对Nginx服务器的日志进行相关配置。这里首先介绍全局块下日志的存放配置，后两种情况的配置基本相同，只是作用域不同。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>error_log_file | stderr[ debug|info | notice|warn |error|crit|alert]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：指定的文件对于运行Nginx进程的用户具有写权限，否则在启动Nginx进程的时候会出现报错。</p> <p>**配置文件的引入：**在一些情况下，我们可能需要将其他的Nginx配置或者第三方模块的配置引用到当前的主配置文件中。Nginx 提供了include指令来完成配置文件的引入</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>include file;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：其中，file是要引入的配置文件，它支持相对路径。</p> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716527784687.48b68f44.png" alt="1716527784687"></p> <h3 id="_2-events块"><a href="#_2-events块" class="header-anchor">#</a> 2，events块</h3> <p><img src="/javablog/public/assets/img/1716527882852.1a374822.png" alt="1716527882852"></p> <p><strong>事件驱动模型</strong></p> <p>Nginx服务器提供了多种事件驱动模型来处理网络消息。配置文件中为我们提供了相关的指令来强制Nginx服务器选择哪种事件驱动模型进行消息处理。 语法结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>use method;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，method可选择的内容有: select、poll、kqueue、epoll、 rtsig、/dev/poll l以及 eventport。</p> <p><strong>标准事件模型</strong></p> <ul><li>Select、poll属于标准事件模型，如果当前系统不存在更有效的方法，Nginx会选择select或poll</li></ul> <p><strong>高效事件模型</strong></p> <ul><li>Kqueue：使用于FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 和 MacOS X.使用双处理器的MacOSX系统使用kqueue可能会造成内核崩溃。</li> <li>Epoll：使用于Linux内核2.6版本及以后的系统。</li> <li>/dev/poll：使用于Solaris 7 11/99+，HP/UX 11.22+ (eventport)，IRIX 6.5.15+ 和 Tru64 UNIX 5.1A+。</li> <li>Eventport：使用于Solaris 10。 为了防止出现内核崩溃的问题， 有必要安装安全补丁。</li></ul> <p>**配置最大连接数：**指令worker_connections主要用来设置允许每一个worker process同时开启的最大连接数。其语法结构为:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>worker_connections number; # 此指令的默认设置为512。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：每个工作进程的最大连接数量。根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把cpu跑到100%就行。每个进 程允许的最多连接数，理论上每台Nginx服务器的最大连接数为。worker_processes * worker_connections</p> <p>配置：</p> <p><img src="/javablog/public/assets/img/1716528213221.a794aa43.png" alt="1716528213221"></p> <h3 id="_3-http块"><a href="#_3-http块" class="header-anchor">#</a> 3，http块</h3> <p><img src="/javablog/public/assets/img/1716528266015.1f01193e.png" alt="1716528266015"></p> <p><strong>定义MIME-Type</strong></p> <p>在常用的浏览器中，可以显示的内容有HTML、XML、GIF及Flash等 种类繁多的文本、媒体等资源，浏览器为区分这些资源，需要使用MIME Type。换言之，MIME Type是网络资源的媒体类型。Nginx服务器作为Web服务器，必须能够识别前端请求的资源类型。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>include       mime.types;
default_type application/octet-stream;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/javablog/public/assets/img/1716528362891.af34dd28.png" alt="1716528362891"></p> <p><strong>自定义服务日志</strong></p> <p>记录Nginx服务器提供服务过程应答前端请求的日志，我们将其称为服务日志以示区分。 Nginx服务器支持对服务日志的格式、大小、输出等进行配置，需要使用两个指令，分别是access _log 和 log_format指令。access_log指令的语法结构为:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>access_log path[format[buffer=size]]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数：</p> <ul><li>path，配置服务日志的文件存放的路径和名称。</li> <li>format,可选项,自定义服务日志的格式字符串,也可以通过“格式串的名称”使log_format指令定义好的格式。“格式串的名称”在 log_format 指令中定义。</li> <li>size，配置临时存放日志的内存缓存区大小。</li></ul> <p>和access_log联合使用的另一个指令是log_format，它专门用于定义服务日志的格式，并且可以为格式字符串定义一个名字，以便access_log 指令可以直接调用。其语法格式为:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>log_format name string ..;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数：</p> <ul><li>name，格式字符串的名字，默认的名字为combined。</li> <li>string，服务日志的格式字符串。在定义过程中，可以使用Nginx 配置预设的一些变量获取相关内容，变量的名称使用双引号括起来，string整体使用单引号括起来。在string 中可以使用的变量后面会说明。</li></ul> <p><img src="/javablog/public/assets/img/1716528406133.8b02c0f5.png" alt="1716528406133"></p> <p><img src="/javablog/public/assets/img/1716528461262.e3ce266c.png" alt="1716528461262"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>日志格式设置 :
$remote_addr与$http_x_forwarded_for用以记录客户端的ip地址；
$remote_user：用来记录客户端用户名称；
$time_local： 用来记录访问时间与时区；
$request： 用来记录请求的url与http协议；
$status： 用来记录请求状态；成功是200，
$body_bytes_sent ：记录发送给客户端文件主体内容大小；
$http_referer：用来记录从那个页面链接访问过来的；
$http_user_agent：记录客户浏览器的相关信息；

通常web服务器放在反向代理的后面，这样就不能获取到客户
的IP地址了，通过$remote_add拿到的IP地址是反向代理服务
器的iP地址。反向代理服务器在转发请求的http头信息中，可以
增加x_forwarded_for信息，用以记录原有客户端的IP地址和原
来客户端的请求的服务器地址。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>配置连接超时时间</strong> (此指令还可以出现在server块和 location块中。)</p> <p>与用户建立会话连接后，Nginx服务器可以保持这些连接打开一段时间，指令 keepalive_timeout就是用来设置此时间的。 语法结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>keepalive_timeout timeout [header timeout];
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数：</p> <ul><li>timeout，服务器端对连接的保持时间。默认值为75s。</li> <li>header_timeout，可选项，在应答报文头部的Keep-Alive域设置超时时间&quot;Keep-Alive:timeout= header_timeout”。报文中的这个指令可以被Mozilla或者Konqueror识别。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>keepalive_timeout 120s 100s;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其含义是，在服务器端保持连接的时间设置为120 s，发给用户端的应答报文头部中Keep-Alive域的超时时间设置为100 s。</p> <p><img src="/javablog/public/assets/img/1716528787041.00f6ca44.png" alt="1716528787041"></p> <p>**配置虚拟主机：**server{} 包含在http{}内部，每一个server{}都是一个虚拟主机（站点），语法结构</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server{
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>配置网络监听</strong></p> <p>配置监听使用指令listen，其配置方法主要有二种。 第一种配置监听的IP地址，语法结构为:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>listen address[:port]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>第二种配置监听端口，语法结构为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>listen port
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数：</p> <ul><li>address，IP地址，如果是IPv6的地址，需要使用中括号“[”括起来，比如[fe80::1]等</li> <li>port，端口号，如果只定义了IP地址没有定义端口号，就使用80端口</li></ul> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>listen 192.168.1.10:8000; #监听具体的IP和具体的端口上的连接
listen 192.168.1.10;     #监听具体IP的所有端口上的连接（没用）
listen 8000;             #监听具体端口上的所有IP连接
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>操作：</p> <p><img src="/javablog/public/assets/img/1716528975291.eda5387e.png" alt="1716528975291"></p> <p><strong>基于名称虚拟主机配置</strong></p> <p>这里的“主机”，就是指此server块对外提供的虚拟主机。设置了主机的名称并配置好 DNS，用户就可以使用这个名称向此虚拟主机发送请求了。 语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server_name name1 name2 name3 ...;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server_name www.baidu.com       //精确匹配
server_name   *.baidu.com;           //通配
server_name www.baidu.com *baidu.com;
server_name   ~^www\.baidu\.*$;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>优先级：</p> <p><img src="/javablog/public/assets/img/1716529070438.41854272.png" alt="1716529070438"></p> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716529134179.b2eeb43c.png" alt="1716529134179"></p> <h3 id="_4-location指令"><a href="#_4-location指令" class="header-anchor">#</a> 4，location指令</h3> <p><strong>配置location块</strong>，语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>URL // http://ip:port/

location [ = | ~ | ~* | ^~] uri {
    ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/javablog/public/assets/img/1716529192162.7771a40f.png" alt="1716529192162"></p> <p>举例：没有修饰符 表示：必须以指定模式开始，如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
 　　server_name *.*;
 　　location /abc {
 　　　　……
 　　}
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意如下是对的：</p> <ul><li>http://baidu.com/abc</li> <li>http://baidu.com/abc?p1=12312&amp;name=w24</li> <li>http://baidu.com/abc/</li> <li>http://baidu.com/abcde</li></ul> <p>举例：= 表示：必须与指定的模式精确匹配</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
 　　server_name *.*;
 　　location = /abc {
 　　　　……
 　　}
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意如下是对的：</p> <ul><li>http://baidu.com/abc</li> <li>http://baidu.com/abc?p1</li></ul> <p>如下是错的：</p> <ul><li>http://baidu.com/abc/</li> <li>http://baidu.com/abcde</li></ul> <p>举例：~ 表示：指定的正则表达式要区分大小写</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
 　　server_name *.*;
 　　location ~ ^/abc$ {
 　　　　……
 　　}
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意如下是对的：</p> <ul><li>http://baidu.com/abc</li> <li>http://baidu.com/abc?name=wcc&amp;password=123</li></ul> <p>如下是错的：</p> <ul><li>http://baidu.com/ABC</li> <li>http://baidu.com/abc/</li> <li>http://baidu.com/abcde</li></ul> <p>举例：~* 表示：指定的正则表达式不区分大小写</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
 　　server_name *.*;
 　　location  ~* ^/abc$ {
 　　　　……
 　　}
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意如下是对的：</p> <ul><li>http://baidu.com/abc</li> <li>http://baidu.com/ABC</li> <li>http://baidu.com/abc?p1=11&amp;p2=22</li></ul> <p>如下是错的：</p> <ul><li>http://baidu.com/abc/</li> <li>http://baidu.com/abcde</li></ul> <p>举例：没有修饰符 表示：必须以指定模式开始，如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
 　　server_name *.*;
 　　location /abc {
 　　　　……
 　　}
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意如下是对的：</p> <ul><li>http://baidu.com/abc</li> <li>http://baidu.com/abc?p1</li></ul> <p>如何是错的：</p> <ul><li>http://baidu.com/abc/</li> <li>http://baidu.com/abcde</li></ul> <p><strong>优先级：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location  = / {
  # 只匹配请求 &quot;/&quot;
  [ configuration A ] 
}
location  / {
  # 匹配任何请求，因为所有请求都是以&quot;/&quot;开始
  # 但是更长字符匹配或者正则表达式匹配会优先匹配
  [ configuration B ] 
}
location /documents/ {
  # 匹配所有 /documents/ 开头的请求，在没有正则表达
  # 式匹配时选择该locaiton
  [ configuration C ]
}
location ^~ /images/ {
  # 匹配任何以 /images/ 开始的请求，并停止匹配其它location
  [ configuration D ] 
}
location ~* .(gif|jpg|jpeg)$ {
  # 匹配以 gif, jpg, or jpeg结尾的请求. 
  # 但是所有 /images/ 目录的请求将由 [Configuration D]处理.  
  [ configuration E ] 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>结论：</strong></p> <ol><li>/ -&gt; 匹配A</li> <li>/index.html -&gt; 匹配B</li> <li>/documents/a.html -&gt; 匹配C</li> <li>/images/1.gif -&gt; 匹配D</li> <li>/documents/1.jpg -&gt; 匹配E</li></ol> <p><img src="/javablog/public/assets/img/1716529775265.446468be.png" alt="1716529775265"></p> <p><strong>配置请求的根目录</strong></p> <p>Web服务器接收到网络请求之后，首先要在服务器端指定目录中寻找请求资源。在Nginx服务器中，指令root就是用来配置这个根目录的。 语法结构</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>root path;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：path为Nginx服务器接收到请求以后查找资源的根目录路径。</p> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /data/ {
    root /localtion1;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>解释：当location块接收到“data/index.htm”的请求时，将在locationtest1/data/目录下找到index.htm响应请求。</p> <h2 id="三-虚拟主机的分类"><a href="#三-虚拟主机的分类" class="header-anchor">#</a> 三，虚拟主机的分类</h2> <p><img src="/javablog/public/assets/img/1716529998384.d3bd077b.png" alt="1716529998384"></p> <h3 id="_1-三种类型的虚拟主机配置"><a href="#_1-三种类型的虚拟主机配置" class="header-anchor">#</a> 1，三种类型的虚拟主机配置</h3> <p>虚拟主机是一种特殊的软硬件技术，它可以将网络上的每一台计算机分成多个虚拟主机，每个虚拟主机可以独立对外提供www服务，这样就可以实现一台主机对外提供多个web服务，每个虚拟主机之间是独立的，互不影响的。</p> <p><img src="/javablog/public/assets/img/1716530096727.da17caa0.png" alt="1716530096727"></p> <p><strong>基于IP的虚拟主机</strong></p> <p><img src="/javablog/public/assets/img/1716530139041.1549510e.png" alt="1716530139041"></p> <p><strong>基于端口的虚拟主机</strong></p> <p><img src="/javablog/public/assets/img/1716530161865.87d979d0.png" alt="1716530161865"></p> <p><strong>基于域名的虚拟主机</strong></p> <p><img src="/javablog/public/assets/img/1716530347973.e85b53cb.png" alt="1716530347973"></p> <h3 id="_2-单网卡多ip配置"><a href="#_2-单网卡多ip配置" class="header-anchor">#</a> 2，单网卡多IP配置</h3> <p><img src="/javablog/public/assets/img/1716530875417.1dc8e0c9.png" alt="1716530875417"></p> <p>通过不同的IP区分不同的虚拟主机，此类虚拟主机对应的企业应用非常少见，一般不同业务需要使用多IP的常见都会在负载均衡器上进行IP绑定，而不是在Web上通过绑定IP区分不同的虚拟机。</p> <h3 id="_3-基于域名的配置"><a href="#_3-基于域名的配置" class="header-anchor">#</a> 3，基于域名的配置</h3> <p><img src="/javablog/public/assets/img/1716531429904.40070fe8.png" alt="1716531429904"></p> <p>两个域名指向同一个nginx服务器，用户访问不同的域名时显示不同的内容。域名规划：</p> <ul><li>www.abc.com ==&gt; 前台</li> <li>www.def.com ==&gt; 后台</li></ul> <p>修改windows的hosts文件配置域名与ip的映射，文件路径：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>C:\Windows\System32\drivers\etc\hosts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1716531686580.f1c20462.png" alt="1716531686580"></p> <p>修改nginx.conf配置文件:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server {
        listen       80;
        #为虚拟机指定IP或者是域名
        server_name  www.abc.com;
        #主要配置路由访问信息
        location / {
            #用于指定访问根目录时，访问虚拟主机的web目录
            root   abc;
            #在不指定访问具体资源时，默认的展示资源的列表
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }
    server {
        listen       80;
        server_name  www.def.com;
        location / {
            root   def;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><img src="/javablog/public/assets/img/1716531929172.e1c14c15.png" alt="1716531929172"></p> <p>创建页面：</p> <p><img src="/javablog/public/assets/img/1716532071644.ea8afb6b.png" alt="1716532071644"></p> <p>重启nginx服务：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> ./nginx -s reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1716532122967.934d6fe7.png" alt="1716532122967"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716532192155.e5b18a6a.png" alt="1716532192155"></p> <h3 id="_4-基于多端口配置"><a href="#_4-基于多端口配置" class="header-anchor">#</a> 4，基于多端口配置</h3> <p><img src="/javablog/public/assets/img/1716532226006.056d0405.png" alt="1716532226006"></p> <p>通过不同的端口来区分不同的虚拟主机。此类虚拟主机对应的企业应用主要为公司内部的网站。</p> <p>Nginx对提供8888与9999两个端口的监听服务</p> <ul><li>请求8888端口则访问abc目录下的index.html</li> <li>请求9999端口则访问def目录下的index.html</li></ul> <p>配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server {
        listen       8888;
        server_name  localhost;
        location / {
            root   abc;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }
    server {
        listen       9999;
        server_name  localhost;
        location / {
            root   def;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><img src="/javablog/public/assets/img/1716532369881.68575f6c.png" alt="1716532369881"></p> <p>重启nginx：</p> <p><img src="/javablog/public/assets/img/1716532409438.dcbcd454.png" alt="1716532409438"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716532460551.30cc0c7d.png" alt="1716532460551"></p> <h2 id="四-核心指令"><a href="#四-核心指令" class="header-anchor">#</a> 四，核心指令</h2> <h3 id="_1-root和alias指令"><a href="#_1-root和alias指令" class="header-anchor">#</a> 1，root和alias指令</h3> <p>区别：</p> <ul><li>共同点 : root和alias两者都都是用来指定URI和磁盘文件的映射关系;</li> <li>区别: root会将定义路径与URI叠加;而alias只取定义路径;</li></ul> <p>root示例：</p> <p>客户端请求www.abc.com/images/1.jpg则对应磁盘映射路径/usr/local/nginx/html/images/images/1.jpg</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /images {
   root /opt/nginx/html/images;
   index index.html index.htm;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意：也就是说使用root 请求的真实路径是 rootpath + /uri ,也就是文件目录 + URI / 后面的内容。</p> <p>alias示例：</p> <p>客户端请求www.abc.com/images/1.jpg则对应磁盘映射路 径/usr/local/nginx/html/images/1.jpg</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /images {
   alias /opt/nginx/html/images/; //最后面一定要加 &quot;/&quot;
   index index.html index.htm;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意：使用alias uri和文件路径进行了叠加,其实就是alias + 请求的文件。</p> <h3 id="_2-return指令"><a href="#_2-return指令" class="header-anchor">#</a> 2，return指令</h3> <p>return指令用于完成对请求的处理，直接向客户端返回。</p> <p><img src="/javablog/public/assets/img/1716533052361.137237ca.png" alt="1716533052361"></p> <p>return功能</p> <ul><li>停止处理请求,直接返回响应码或重定向到其他URL;</li> <li>执行return指令后,location中后序指令将不会被执行;</li></ul> <p>return语法结构</p> <ul><li>return code [text]; # 如果返回2XX的,text才有意义,text会在body中;</li> <li>return code URL; #主要用于重定向;</li> <li>return URL; #须以http或者https开头的;</li></ul> <p>常用的状态码：</p> <ul><li>200 请求成功</li> <li>301 永久转移到其他URL</li> <li>404 请求资源不存在</li> <li>500 内部服务器错误</li></ul> <p><img src="/javablog/public/assets/img/1716533361633.38448239.png" alt="1716533361633"></p> <p>code+text示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location / {
   return 200 'your success';
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/javablog/public/assets/img/1716533441446.b90dcc55.png" alt="1716533441446"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716533542370.6c0b63e5.png" alt="1716533542370"></p> <p>code+URL示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#302 表示临时性重定向。访问一个Url时，被重定向到另一个url上。常#用于页面跳转。
location / {
   return 302 /bbs;
}
location /bbs {
   alias html;
   index index.html;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/javablog/public/assets/img/1716533720613.70142878.png" alt="1716533720613"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716533735600.8ec05cab.png" alt="1716533735600"></p> <p>测试URL，直接重定向到百度</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location / {
   return http://baidu.com;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/javablog/public/assets/img/1716533792397.c231899f.png" alt="1716533792397"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716533807916.f72dd055.png" alt="1716533807916"></p> <h3 id="_3-rewrite指令"><a href="#_3-rewrite指令" class="header-anchor">#</a> 3，rewrite指令</h3> <p>地址重写和地址转发：</p> <ul><li>地址重写是实际上是为了实现址标准化，就像访问www.baidu.cn可以出现www.baidu.com的首页，服务器会把www.baidu.cn重写成www.baidu.com，浏览器的地址栏也会显示www.baidu.com。</li> <li>地址转发一般发生在同一站点项目内，而地址重写则没有限制。</li></ul> <p>区别：</p> <ul><li><p>地址转发后客户端浏览器地址栏中的地址显示是不改变的;而地址重写后客户端浏览器地址栏中的地址改变为服务器选择确定的地址。</p></li> <li><p>在一次地址转发整个过程中，只产生一次网络请求;而一次地址重写一般会产生两次请求。地址转发一般发生在同一站点项目内;而地址重写没有该限制。</p></li> <li><p>地址转发的速度较地址重定向快。</p></li> <li><p>地址转发过程中，可以将客户端请求的request范围内的属性传递给新的页面，但地址重写不</p> <p>可以。</p></li></ul> <p>rewrite常用全局变量：https://blog.csdn.net/qq_34939308/article/details/120635970</p> <table><thead><tr><th><strong>变量</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>$args</td> <td>请求中的参数，如<a href="http://www.123.com/1.php?a=1&amp;b=2" target="_blank" rel="noopener noreferrer">www.123.com/1.php?a=1&amp;b=2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的$args就是a=1&amp;b=2</td></tr> <tr><td>$body_bytes_sent</td> <td>服务器发送给客户端的响应body字节数</td></tr> <tr><td>$content_length</td> <td>HTTP请求信息里的&quot;Content-Length&quot;</td></tr> <tr><td>$conten_type</td> <td>HTTP请求信息里的&quot;Content-Type&quot;</td></tr> <tr><td>$document_root</td> <td>nginx虚拟主机配置文件中的root参数对应的值</td></tr> <tr><td>$document_uri</td> <td>当前请求中不包含指令的URI，如<a href="http://www.123.com/1.php?a=1&amp;b=2" target="_blank" rel="noopener noreferrer">www.123.com/1.php?a=1&amp;b=2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的$document_uri就是1.php,不包含后面的参数</td></tr> <tr><td>$http_referer</td> <td>记录此次请求是从哪个连接访问过来的，可以根据该参数进行防盗链设置</td></tr> <tr><td>$host</td> <td>主机头，也就是域名</td></tr> <tr><td>$http_user_agent</td> <td>客户端的详细信息，也就是浏览器的标识，用curl -A可以指定</td></tr> <tr><td>$http_cookie</td> <td>客户端的cookie信息</td></tr> <tr><td>$http_x_forwarded_for</td> <td>当前端有代理服务器时，设置web节点记录客户端地址的配置，此参数生效的前提是代理服务器也要进行相关的x_forwarded_for设置</td></tr> <tr><td>$limit_rate</td> <td>如果nginx服务器使用limit_rate配置了显示网络速率，则会显示，如果没有设置， 则显示0</td></tr> <tr><td>$remote_addr</td> <td>客户端的公网ip</td></tr> <tr><td>$remote_port</td> <td>客户端的port</td></tr> <tr><td>$remote_user</td> <td>如果nginx有配置认证，该变量代表客户端认证的用户名</td></tr> <tr><td>$request</td> <td>请求的URI和HTTP协议，如“GET /article-10000.html HTTP/1.1”</td></tr> <tr><td>$request_body_file</td> <td>做反向代理时发给后端服务器的本地资源的名称</td></tr> <tr><td>$request_method</td> <td>请求资源的方式，GET/PUT/DELETE等</td></tr> <tr><td>$request_filename</td> <td>当前请求的资源文件的路径名称，相当于是$document_root/$document_uri的组合</td></tr> <tr><td>$request_uri</td> <td>请求的链接，包括$document_uri和$args</td></tr> <tr><td>$scheme</td> <td>请求的协议，如ftp,http,https</td></tr> <tr><td>$server_protocol</td> <td>客户端请求资源使用的协议的版本，如HTTP/1.0，HTTP/1.1，HTTP/2.0等</td></tr> <tr><td>$server_addr</td> <td>服务器IP地址</td></tr> <tr><td>$server_name</td> <td>服务器的主机名</td></tr> <tr><td>$server_port</td> <td>服务器的端口号</td></tr> <tr><td>$status</td> <td>http状态码，记录请求返回的状态码，例如：200、301、404等</td></tr> <tr><td>$uri</td> <td>和$document_uri相同</td></tr> <tr><td>$http_referer</td> <td>客户端请求时的referer，通俗讲就是该请求是通过哪个链接跳过来的，用curl -e可以指定</td></tr> <tr><td>$time_local</td> <td>记录访问时间与时区，如18/Jul/2014:17:00:01 +0800</td></tr></tbody></table> <p>rewrite指令：该指令通过正则表达式的使用来改变URI。可以同时存在一个或者多个指令，按照顺序依次对URL进行匹配和处理。 该指令可以在server快或者location块中配置，其语法结构为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rewrite regex replacement [flag];
关键字   正则   替代内容     flag标记
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：</p> <ul><li>regex，用于匹配URI的正则表达式。使用括号 &quot;（）&quot; 标记要截取的内容。</li></ul> <p>rewrite参数的标签段位置：</p> <div class="language-\ line-numbers-mode"><pre class="language-text"><code>server,location,if
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>常用正则表达式</p> <table><thead><tr><th>字符</th> <th>描述</th></tr></thead> <tbody><tr><td>\</td> <td>将后面接着的字符标记为一个特殊字符或者一个原义字符或一个向后引用</td></tr> <tr><td>^</td> <td>匹配输入字符串的起始位置</td></tr> <tr><td>$</td> <td>匹配输入字符串的结束位置</td></tr> <tr><td>*</td> <td>匹配前面的字符零次或者多次</td></tr> <tr><td>+</td> <td>匹配前面字符串一次或者多次</td></tr> <tr><td>?</td> <td>匹配前面字符串的零次或者一次</td></tr> <tr><td>.</td> <td>匹配除“\n”之外的所有单个字符</td></tr> <tr><td>(pattern)</td> <td>匹配括号内的pattern</td></tr></tbody></table> <p>rewrite最后一项flag参数：</p> <table><thead><tr><th>标记符号</th> <th>说明</th></tr></thead> <tbody><tr><td>last</td> <td>本条规则匹配完成后继续向下匹配新的location URI规则</td></tr> <tr><td>break</td> <td>本条规则匹配完成后终止，不在匹配任何规则</td></tr> <tr><td>redirect</td> <td>返回302临时重定向</td></tr> <tr><td>permanent</td> <td>返回301永久重定向</td></tr></tbody></table> <p>示例：无论/search 后面跟什么内容,最后都会被永久重定向到百度页面</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /search {
   rewrite   ^/(.*)   http://baidu.com permanent;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>示例：创建三个文件夹,每个文件夹下有个1.html文件;</p> <p><img src="/javablog/public/assets/img/1716534958006.f3fc8ccb.png" alt="1716534958006"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /images {
   rewrite /images/(.*) /pics/$1;      //将URL  /images/1.html 重写为  /pics/1.html
}

location /pics {
   rewrite /pics/(.*)  /photos/$1;    //将URL  /pics/1.html 重写为  /photos/1.html
}

location /photos {

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>示例：将URL /images/1.html 重写为 /pics/1.html, 并且不再匹配其他location段</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /images {
   rewrite /images/(.*) /pics/$1  break; 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>示例：将URL /images/1.html 重写为 /pics/1.html, 重新进入server段后匹配了/pics location段,然后又被重写。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /images {
   rewrite /images/(.*) /pics/$1  last;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Nginx的rewrite功能在企业里应用非常广泛：</strong></p> <ul><li>可以调整用户浏览的URL，看起来更规范，合乎开发及产品人员的需求。</li> <li>网址换新域名后，让旧的访问跳转到新的域名上。</li> <li>根据特殊变量、目录、客户端的信息进行URL调整等。</li></ul> <p><strong>域名跳转:</strong> 旧域名<a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">www.test.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>直接跳转到新域名<a href="http://www.ityls.com/" target="_blank" rel="noopener noreferrer">www.ityls.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
   listen   80;
   server_name  www.ityls1.com;
   rewrite ^/(.*) http://www.ityls2.com/$1 permanent;
}
server {
     listen    80;
     server_name  www.ityls2.com;
     location / {
       root  html;
       index  index.html index.htm;
     }
     access_log logs/brian.log main gzip buffer=128k flush=5s; 
     error_page  500 502 503 504  /50x.html;
     location = /50x.html {
       root  html;
     }
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>操作：</p> <p><img src="/javablog/public/assets/img/1716785795953.57fcb6a2.png" alt="1716785795953"></p> <p><img src="/javablog/public/assets/img/1716785770579.d6a4f8d4.png" alt="1716785770579"></p> <p>效果：</p> <p><img src="/javablog/public/assets/img/1716785752281.5d9b17eb.png" alt="1716785752281"></p> <h3 id="_4-if指令"><a href="#_4-if指令" class="header-anchor">#</a> 4，if指令</h3> <p>该指令用来支持条件判断,并根据条件判断结果选择不同的Nginx配置,可以在server块或locatio块中配置该指令。</p> <p><strong>语法结构:</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if (condition)  { ... }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，花括号代表一个作用域，形成一个if配置块，是条件为真时的Nginx配置。condition为判断条件（ true/false )，它可以支持以下几种设置方法:</p> <ul><li><p>变量名-如果变量的值为空字符串或者“0”开头的任意字符串，if指令认为条件为false，其他情况为true，比如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if ($slow) {
  .....   #Nginx配置 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>使用 &quot;=&quot;(等于) 和 &quot;!=&quot; (不等于) 比较变量和字符串是否相等，相等时if指令为条件为true，反之为false。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if ($request_method = POST) {
  return 405;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <p>注意：这里的字符串不需要加引号。</p> <p><strong>变量与正则表达式：</strong></p> <ul><li>~ 表示匹配过程对大小写敏感</li> <li>~* 表示匹配过程对大小写不敏感</li> <li>!~ 表示匹配失败是if指令认为条件为true否则为false</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>if ($http_user_agent  ~  MSIE) {
  # $http_user_agent 的值中是否包含MSIE字符串，如果包含，为true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>示例：判断ip地址是否为115.57.243.71，如果是返回“if  test  sucess”</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>     location <span class="token operator">/</span>search <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>$remote_addr <span class="token operator">=</span> <span class="token string">&quot;115.57.243.71&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;if  test  sucess&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">500</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>查看本机IP：</p> <p><img src="/javablog/public/assets/img/1716786810569.c8d0b428.png" alt="1716786810569"></p> <p>测试：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
     listen    80;
     server_name  www.ityls2.com;
     location /search {
        if ($remote_addr = &quot;115.57.243.71&quot;){
         return 200 &quot;if  test  sucess&quot;;
        }
        return 500;
     }
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/javablog/public/assets/img/1716786837940.b9341077.png" alt="1716786837940"></p> <p>示例：不允许谷歌浏览器访问，如果时候谷歌浏览器放回500</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>$http_user_agent <span class="token operator">~</span> Chrome<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token number">500</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>操作：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
     listen    80;
     server_name  www.ityls2.com;
     location /search {
        if ($http_user_agent ~ Chrome){
            return 500;
        }
        return 200 &quot;hello ityls&quot;;
     }
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/javablog/public/assets/img/1716787036985.67df3766.png" alt="1716787036985"></p> <p><img src="/javablog/public/assets/img/1716787018880.b4fed97d.png" alt="1716787018880"></p> <h3 id="_5-set和break指令"><a href="#_5-set和break指令" class="header-anchor">#</a> 5，set和break指令</h3> <p>set指令，该指令用于设置一个新的变量。语法结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>set variable value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：</p> <ul><li>variable，为变量的名称。注意要用符号“$”作为变量的第一个字符，且变量不能与Nginx服务器预设的全局变量同名。</li> <li>value，为变量的值，可以是字符串、其他变量或变量的组合等。</li></ul> <p><img src="/javablog/public/assets/img/1716787132800.0cab9f55.png" alt="1716787132800"></p> <p><img src="/javablog/public/assets/img/1716787172937.e5e86908.png" alt="1716787172937"></p> <p>break指令，该指令用于中断当前相同作用域中的其他Nginx配置。语法结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>break;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location / {
  if ($slow){
   set $id $1 ; # 处于break指令之前，配置生效
   break;    
   limit_rate 10k; #处于break指令之后，配置无效
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_6-gzip压缩指令"><a href="#_6-gzip压缩指令" class="header-anchor">#</a> 6，gzip压缩指令</h3> <p>Gzip压缩的优点：</p> <ul><li>大副度提高页面加载速度</li> <li>提高请求效果</li> <li>节约宽带</li></ul> <p>Nginx开启Gzip压缩功能， 可以使网站的css、js 、xml、html 文件在传输时进行压缩，提高访问速度, 进而优化Nginx性能!</p> <p><strong>Gzip压缩作用</strong></p> <p>将响应报⽂发送⾄客户端之前可以启⽤压缩功能，这能够有效地节约带宽，并提⾼响应⾄客户端的速度。Gzip压缩可以配置http,server和location模块下。Nginx开启Gzip压缩参数说明：</p> <table><thead><tr><th>指令</th> <th>含义</th></tr></thead> <tbody><tr><td>gzip on</td> <td>决定是否开启gzip模块，on表示开启，off表示关闭；</td></tr> <tr><td>gzip_min_length 1k</td> <td>设置允许压缩的页面最小字节(从header头的Content-Length中获取) ，当返回内容大于此值时才会使用gzip进行压缩,以K为单位,当值为0时，所有页面都进行压缩。建议大于1k</td></tr> <tr><td>gzip_buffers 4 16k;</td> <td>设置gzip申请内存的大小,其作用是按块大小的倍数申请内存空间,param2:int(k) 后面单位是k。这里设置以16k为单位,按照原始数据大小以16k为单位的4倍申请内存</td></tr> <tr><td>gzip_http_version 1.1;</td> <td>识别http协议的版本,早起浏览器可能不支持gzip自解压,用户会看到乱码</td></tr> <tr><td>gzip_comp_level 2;</td> <td>设置gzip压缩等级，等级越底压缩速度越快文件压缩比越小，反之速度越慢文件压缩比越大；等级1-9，最小的压缩最快 但是消耗cpu</td></tr> <tr><td>gzip_types text<code>/plain</code> <code>application</code>/x-javascript<code>text`/css` `application`/xml</code>;</td> <td>设置需要压缩的MIME类型,非设置值不进行压缩，即匹配压缩类型</td></tr> <tr><td>gzip_vary on;</td> <td>启用应答头&quot;Vary: Accept-Encoding&quot;</td></tr> <tr><td>gzip_proxied off;</td> <td>nginx做为反向代理时启用,off(关闭所有代理结果的数据的压缩),expired(启用压缩,如果header头中包括<code>&quot;Expires&quot;</code>头信息),no-cache(启用压缩,header头中包含<code>&quot;Cache-Control:no-cache&quot;</code>), no-store(启用压缩,header头中包含<code>&quot;Cache-Control:no-store&quot;</code>),private(启用压缩,header头中包含<code>&quot;Cache-Control:private&quot;</code>),no_last_modefied(启用压缩,header头中不包含 <code>&quot;Last-Modified&quot;</code>),no_etag(启用压缩,如果header头中不包含<code>&quot;Etag&quot;</code>头信息),auth(启用压缩,如果header头中包含<code>&quot;Authorization&quot;</code>头信息)</td></tr> <tr><td>gzip_disable msie6;</td> <td>(IE5.5和IE6 SP1使用msie6参数来禁止<code>gzip</code>压缩 )指定哪些不需要<code>gzip</code>压缩的浏览器(将和User-Agents进行匹配),依赖于PCRE库</td></tr></tbody></table> <p>如下是线上常使用的Gzip压缩配置:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http {
   gzip  on;
   gzip_min_length  1k;
   gzip_buffers   4 16k;
   gzip_http_version 1.1;
   gzip_comp_level 9;
   gzip_types    text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/javascript application/json;
   gzip_disable &quot;MSIE [1-6]\.&quot;;
   gzip_vary on;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>Nginx的Gzip压缩功能虽然好用，但是下面两类文件资源不太建议启用此压缩功能。</strong></p> <ul><li><p>图片类型资源 (还有视频文件)，原因：图片如jpg、png文件本身就会有压缩，所以就算开启gzip后，压缩前和压缩后大小没有多大区别，所以开启了反而会白白的浪费资源。</p></li> <li><p>大文件资源， 原因：会消耗大量的cpu资源，且不一定有明显的效果。</p></li></ul> <p>操作：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server{
        listen 80;
        server_name *.*;
        location ~ .*\.(html)$ {
            gzip on;
            gzip_http_version 1.1;
            gzip_comp_level 2;
            gzip_types text/html application/javascript application/xml;
            root html;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="/javablog/public/assets/img/1716787909254.bc1a136a.png" alt="1716787909254"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716787925692.28b0e9c5.png" alt="1716787925692"></p> <h2 id="五-nginx场景实践"><a href="#五-nginx场景实践" class="header-anchor">#</a> 五，Nginx场景实践</h2> <h3 id="_1-浏览器缓存"><a href="#_1-浏览器缓存" class="header-anchor">#</a> 1，浏览器缓存</h3> <p><img src="/javablog/public/assets/img/1716788190480.6ecd74c4.png" alt="1716788190480"></p> <p><strong>浏览器缓存：</strong></p> <p>浏览器缓存是为了加速浏览，浏览器在用户磁盘上，对最近请求过的文档进行存储。当访问者再次请求这个页面时，浏览器就可以从本地磁盘显示文档，这样，就可以加速页面的阅览，缓存的方式节约了网络的资源，提高了网络的效率。</p> <p>实现浏览器缓存步骤</p> <p><img src="/javablog/public/assets/img/1716788303189.39f09348.png" alt="1716788303189"></p> <p>浏览器缓存可以通过expires指令输出Header头来实现。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>语法：expires[time| epoch | max |off]
默认值：expires off
作用域：http、server、location
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>一个HTML页面，会引用一些JavaScript文件、图片文件、而这些格式的文件很少会被修改，则可以通过expires设置浏览器缓存。</p> <p>**示例：**比如，对常见格式的图片、Flash文件在浏览器本地缓存30天，对JS、CSS文件在浏览器本地缓存1小时，代码如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server{
        listen 80;
        server_name *.*;
        location ~ .*\.(png|jpg)$ {
            expires 10d;
            root html;
        }
        location ~ .*\.(js|css)$ {
            expires 1h;
            root html;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>操作：</p> <p><img src="/javablog/public/assets/img/1716788548313.b70f6f78.png" alt="1716788548313"></p> <p><img src="/javablog/public/assets/img/1716788600376.5d857ea5.png" alt="1716788600376"></p> <p><img src="/javablog/public/assets/img/1716788625500.da7097fd.png" alt="1716788625500"></p> <p><strong>Cache-Control:</strong></p> <p>设置相对过期时间, max-age指明以秒为单位的缓存时间. 若对静态资源只缓存一次, 可以设置max-age的值为315360000000 (一万年). 比如对于提交的订单，为了防止浏览器回退重新提交，可以使用Cache-Control之no-store绝对禁止缓存，即便浏览器回退依然请求的是服务器，进而判断订单的状态给出相应的提示信息！</p> <p><strong>Http协议的cache-control的常见取值及其组合释义:</strong></p> <ul><li>no-cache: 数据内容不能被缓存, 每次请求都重新访问服务器, 若有max-age, 则缓存期间不访问服务器</li> <li>no-store: 不仅不能缓存, 连暂存也不可以(即: 临时文件夹中不能暂存该资源)</li> <li>private(默认): 只能在浏览器中缓存, 只有在第一次请求的时候才访问服务器, 若有- - max-age, 则缓存期间不访问服务器</li> <li>public: 可以被任何缓存区缓存, 如: 浏览器、服务器、代理服务器等</li> <li>max-age: 相对过期时间, 即以秒为单位的缓存时间</li></ul> <p>语法结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># expires 1d;
add_header Cache-Control no-cache;
add_header Cache-Control private;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>缓存流程：</p> <p><img src="/javablog/public/assets/img/1716788696341.5d342c75.png" alt="1716788696341"></p> <p>**企业实战示例：**下面是开发部门同事发过来的配置需求:</p> <ol><li>禁用html文件缓存，即cache control设置为no-cache;</li> <li>对于js，图片，css，字体等，设置max-age=2592000. 也就是30天;</li></ol> <p>注意：缓存控制字段cache-control的配置(add_header)要放在http, server, location区域, 或是放在location的if判断里, 例如&quot;add_header Cache-Control no-cache;&quot;</p> <p>配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server{
        listen 80;
        server_name 192.168.66.100;
        location ~ \.(css|js|gif|jpg|jpeg|png|bmp|swf|ttf|woff|otf|ttc|pfa)$ {
            root html;
            expires 30d;
        } 
        location ~ \.(html|htm)$ {
            root html;
            add_header Cache-Control no-cache;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1716789119982.8742dba1.png" alt="1716789119982"></p> <p><img src="/javablog/public/assets/img/1716789140685.ba8a48c3.png" alt="1716789140685"></p> <h3 id="_2-防盗链"><a href="#_2-防盗链" class="header-anchor">#</a> 2，防盗链</h3> <p>内容不在自己的服务器上，通过技术手段将其他网站的内容（比如一些音乐、图片、软件的下载地址）放置在自己的网站中，通过这种方法盗取其他网站的空间和流量。</p> <p><img src="/javablog/public/assets/img/1716789696769.22ba41e0.png" alt="1716789696769"></p> <p><strong>防盗链技术背景:</strong></p> <p>防止第三方引用链接访问我们的图片，消耗服务器资源和网络流量，我们可以在服务器上做防盗链限制。</p> <p><img src="/javablog/public/assets/img/1716789752919.d49439a9.png" alt="1716789752919"></p> <p>**防盗链设置思路:**首要方式：区别那些请求是非正常的用户请求。</p> <p><img src="/javablog/public/assets/img/1716789794265.f0c5d4c0.png" alt="1716789794265"></p> <p>**基于http_refer防盗链配置模块:**HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器籍此可以获得一些信息用于处理。比如从我主页上链接到一个朋友那里，他的服务器就能够从HTTP Referer中统计出每天有多少用户点击我主页上的链接访问他的网站。</p> <p><img src="/javablog/public/assets/img/1716789971045.55bb6ff5.png" alt="1716789971045"></p> <p>语法结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>valid_referers none blocked 192.168.66.100;
if ($invalid_referer) {
   return 403;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>参数：</strong></p> <ul><li>none : 允许没有http_refer的请求访问资源；</li> <li>blocked : 允许不是http://开头的，不带协议的请求访问资源；</li> <li>192.168.66.100: 只允许指定ip来的请求访问资源；</li></ul> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716790003712.ee84dd0a.png" alt="1716790003712"></p> <p><img src="/javablog/public/assets/img/1716790135720.d47cbacf.png" alt="1716790135720"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server{
        listen 80;
        server_name *.*;
        location ~ \.(css|js|gif|jpg|jpeg|png|bmp|swf|ttf|woff|otf|ttc|pfa)$ {
            root html;
            expires 30d;
            # 允许本站访问
            valid_referers none blocked 115.57.243.71;
    
            # 如果不是从允许的来源访问，返回403
            if ($invalid_referer) {
                return 403;
            }
        } 
        location ~ \.(html|htm)$ {
            root html;
            add_header Cache-Control no-cache;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><img src="/javablog/public/assets/img/1716790570437.e922558c.png" alt="1716790570437"></p> <h3 id="_3-代理服务"><a href="#_3-代理服务" class="header-anchor">#</a> 3，代理服务</h3> <p><img src="/javablog/public/assets/img/1716790732697.3827d976.png" alt="1716790732697"></p> <p><strong>正向代理：</strong></p> <p>正向代理，是在用户端的。比如需要访问某些国外网站，我们可能需要购买vpn。</p> <p>正向代理最大的特点：</p> <ol><li>客户端非常明确要访问的服务器地址；</li> <li>服务器只清楚请求来自哪个代理服务器，而不清楚来自哪个具体的客户端；</li> <li>正向代理模式屏蔽或者隐藏了真实客户端信息。</li></ol> <p><img src="/javablog/public/assets/img/1716790747001.e99d14c9.png" alt="1716790747001"></p> <p><strong>反向代理：</strong></p> <p>客户端给服务器发送的请求，nginx服务器接收到之后，按照一定的规则分发给了后端的业务处理服务器进行处理了。此时请求的来源也就是客户端是明确的，但是请求具体由哪台服务器处理的并不明确了，nginx扮演的就是一个反向代理角色。</p> <p>反向代理，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息。</p> <p><img src="/javablog/public/assets/img/1716790878373.3b80947c.png" alt="1716790878373"></p> <h3 id="_4-反向代理"><a href="#_4-反向代理" class="header-anchor">#</a> 4，反向代理</h3> <p><img src="/javablog/public/assets/img/1716790976867.6617c405.png" alt="1716790976867"></p> <p>单体架构：</p> <p><img src="/javablog/public/assets/img/1716791048336.b71b6499.png" alt="1716791048336"></p> <p><strong>单体架构问题：</strong></p> <ul><li>复杂性高：模块多，模块边界模糊，代码质量参差不齐，每次修改代码都心惊胆战</li> <li>技术债务：随着时间的推移，需求变更和人员迭代，会逐渐形成应用程序的技术债务，并且越积越多</li> <li>部署频率低：随着代码增多，构建和部署的时间也会增多，每次部署都要重新部署整个项目</li> <li>可靠性差：某个应用有bug，可能会导致整个应用崩溃</li> <li>扩展能力受限：单体应用只能作为一个整体应用进行扩展，无法根据业务模块的需要进行伸缩</li></ul> <p><strong>反向代理设置指令：</strong></p> <p>学习Nginx服务器的反向代理服务，要涉及与后端代理服务器相关的配置指令比较重要，是为客户端提供正常Web服务的基础，大家应该熟练掌握尤其是proxy_pass指令，在实际应用过程中需要注意一些配置细节，需要小心使用。</p> <p><strong>proxy_pass指令：</strong></p> <p>该指令用来设置被代理服务器的地址，可以是主机名称、IP地址加端口号等形式。</p> <p><strong>语法结构:</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>proxy_pass URL;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数：URL为要设置的被代理服务器的地址，包含传输协议、主机名称或P地址加端口号、URI等要素。传输协议通常是&quot;http&quot;或者&quot;https://&quot;。</p> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server{
  ....
  listen 80;
  server_name *.*;
  location / {
    proxy_pass http://192.168.66.101:8080;
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>操作：</p> <p><img src="/javablog/public/assets/img/1716791264076.0c3b92c2.png" alt="1716791264076"></p> <h3 id="_5-负载均衡"><a href="#_5-负载均衡" class="header-anchor">#</a> 5，负载均衡</h3> <p><img src="/javablog/public/assets/img/1716791930715.081ffc5e.png" alt="1716791930715"></p> <p><strong>什么是负载均衡：</strong></p> <p>负载均衡是高可用网络基础架构的关键组件，通常用于将工作负载分布到多个服务器来提高网站、应用、数据库或其他服务的性能和可靠性。</p> <p><strong>没有负载均衡的 web 架构：</strong></p> <p><img src="/javablog/public/assets/img/1716792122261.44ecf3d2.png" alt="1716792122261"></p> <p><strong>有负载均衡web架构:</strong></p> <p><img src="/javablog/public/assets/img/1716792050521.41536a53.png" alt="1716792050521"></p> <p><strong>upstream指令：</strong></p> <p>upstream块不属于虚拟主机，只能在http块里配置，它定义了在反向代理时Nginx需要访问的后端服务器集群和负载均衡策略。</p> <p><strong>语法结构：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream  back_end {       # upstream 需要一个名字
  server 192.168.66.100 max_conns=2 fail_timeout=1s;
  server 192.168.66.101 weight = 1;
  server 192.168.66.102 weight = 1;
}
server{
  lisetn 80;
  server_name *.*;
  location / {
   proxy_set_header Host $host;  #转发原始请求的host头部
   proxy_pass http://back_end;  #转发到upstream块定义的服务器集群。 
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>upstream参数：</strong></p> <ul><li>max_conns 节点的最大连接数</li> <li>slow_start 缓慢启动时间</li> <li>down 节点下线</li> <li>backup 备用节点</li> <li>max_fails 允许的最大失败数</li> <li>fail_timeout 超过最大失败数后的等待时间</li></ul> <p>操作：</p> <p>创建两台tomcat，如下：</p> <p><img src="/javablog/public/assets/img/1716792353081.91bfc3ac.png" alt="1716792353081"></p> <p>访问：</p> <p><img src="/javablog/public/assets/img/1716792379755.2c079508.png" alt="1716792379755"></p> <p><img src="/javablog/public/assets/img/1716792393577.dd85c2d0.png" alt="1716792393577"></p> <p>配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    upstream myapp1 {
        server 103.38.81.223:9090;
        server 103.38.81.223:9091;
    }

    server{
        listen 80;
        location / {
            proxy_pass http://myapp1;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="/javablog/public/assets/img/1716793216800.598cf15a.png" alt="1716793216800"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716793245228.220716ed.png" alt="1716793245228"></p> <p>此时关闭一台服务：</p> <p><img src="/javablog/public/assets/img/1716793292080.74506218.png" alt="1716793292080"></p> <p>再访问：</p> <p><img src="/javablog/public/assets/img/1716793305051.839e492c.png" alt="1716793305051"></p> <p>把另一台服务也关了：</p> <p><img src="/javablog/public/assets/img/1716793333950.8313ddbd.png" alt="1716793333950"></p> <p>再测试：</p> <p><img src="/javablog/public/assets/img/1716793345642.d3e6d81f.png" alt="1716793345642"></p> <h3 id="_6-负载均衡算法"><a href="#_6-负载均衡算法" class="header-anchor">#</a> 6，负载均衡算法</h3> <p><strong>负载均衡算法：</strong></p> <ul><li>轮询</li> <li>轮询加权重</li> <li>ip_hash</li> <li>url_hash</li> <li>fair</li></ul> <p><strong>轮询(默认）：</strong></p> <p>轮询方式，依</p> <p>次将请求分配到各个后台服务器中，默认的负载均衡方式。 适用于后台机器性能一致的情况。 挂掉的机器可以自动从服务列表中剔除。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    upstream myapp1 {
        server 103.38.81.223:9090;
        server 103.38.81.223:9091;
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>轮询加权重:</strong></p> <p>根据权重来分发请求到不同的机器中，指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    upstream myapp1 {
        server 103.38.81.223:9090 weight=10;
        server 103.38.81.223:9091 weight=10;  
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>IP_hash:</strong></p> <p><img src="/javablog/public/assets/img/1716812778891.55e3d878.png" alt="1716812778891"></p> <p>每个请求按访问IP的哈希结果分配，使来自同一个IP的访客固定访问一台后端服务器，并且可以有效解决动态网页存在的session共享问题。俗称IP绑定。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream  backServer{
       server 127.0.0.1:8080 ;
        server 127.0.0.1:8081 ;
        ip_hash; 
    }
    
    server {
     listen    80;
     server_name  www.test.com;
     location / {
           ### 指定上游服务器负载均衡服务器
           proxy_pass http://backServer;
       	   index  index.html index.htm;
     }
   } 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>url_hash:</strong></p> <p><img src="/javablog/public/assets/img/1716812859070.146a3500.png" alt="1716812859070"></p> <p>按访问的URL的哈希结果来分配请求，使每个URL定向到一台后端服务器，可以进一步提高后端缓存服务器的效率。Nginx本身不支持url_hash，如果需要这种调度算法，则必须安装Nginx的hash软件包。</p> <p><strong>fair:</strong></p> <p>比 weight、ip_hash更加智能的负载均衡算法，fair算法可以根据页面大小和加载时间长短智能地进行负载均衡，也就是根据后端服务器的响应时间 来分配请求，响应时间短的优先分配。Nginx本身不支持fair，如果需要这种调度算法，则必须安装upstream_fair模块。</p> <h3 id="_7-fair模块"><a href="#_7-fair模块" class="header-anchor">#</a> 7，fair模块</h3> <p><img src="/javablog/public/assets/img/1716812925574.736ba424.png" alt="1716812925574"></p> <p><strong>模块介绍：</strong></p> <p>fair采用的不是内建负载均衡使用的轮换的均衡算法，而是可以根据页面大小、加载时间长短智能的进行负载均衡。</p> <p>**安装：**切换到nginx目录执行一下操作</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>./configure --prefix=/usr/local/nginx --add-module=/opt/nginx-upstream-fair-master
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>编译：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>make
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>备份原来的nginx命令：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx-bak
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>替换原来的 nginx 命令：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cp /usr/local/nginx-1.16.1/objs/nginx /usr/local/nginx/sbin/nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>配置实现：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream backserver { 
 fair; 
 server 192.168.0.14; 
 server 192.168.0.15; 
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>总结：</p> <ul><li>已安装Nginx，配置第三方模块时，只需要--add-module=/第三方模块目录，然后make编译一下就可以，不要 make install 安装。编译后复制objs下面的nginx到指定目录下。</li></ul> <h3 id="_8-nginx配置故障转移"><a href="#_8-nginx配置故障转移" class="header-anchor">#</a> 8，nginx配置故障转移</h3> <p><img src="/javablog/public/assets/img/1716813161505.76b6e285.png" alt="1716813161505"></p> <p>当上游服务器(真实访问服务器),一旦出现故障或者是没有及时相应的话，应该直接轮训到下一台服务器，保证服务器的高可用。</p> <p><strong>Nginx配置代码：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
     listen    80;
     server_name  www.test.com;
     location / {
           ### 指定上游服务器负载均衡服务器
           proxy_pass http://backServer;
           #故障转移的条件：如果后端的服务器返回502、504、执行超时等错误，自动将请求转发到upstream负载均衡池中的另一台服务器，实现故障转移。 
   proxy_next_upstream http_502 http_504 error timeout invalid_header; 
        ###nginx与上游服务器(真实访问的服务器)超时时间 后端服务器连接的超时时间_发起握手等候响应超时时间
            proxy_connect_timeout 1s;
            ###nginx发送给上游服务器(真实访问的服务器)超时时间
       proxy_send_timeout 1s;
            ### nginx接受上游服务器(真实访问的服务器)超时时间
       proxy_read_timeout 1s;
       index  index.html index.htm;
     }
   }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>创建两台tomcat，如下：</p> <p><img src="/javablog/public/assets/img/1716815165990.9236ff93.png" alt="1716815165990"></p> <p>进入tomcat，修改一下代码：</p> <p><img src="/javablog/public/assets/img/1716816476375.804d0ac2.png" alt="1716816476375"></p> <p><img src="/javablog/public/assets/img/1716816484894.a4d4329e.png" alt="1716816484894"></p> <p>同理修改第二台服务器：</p> <p><img src="/javablog/public/assets/img/1716816692321.bfd610cd.png" alt="1716816692321"></p> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716817066724.638477ed.png" alt="1716817066724"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    upstream myapp1 {
        server 103.38.81.223:9090;
        server 103.38.81.223:9091;
    }

    server{
        listen 80;
        location / {
            # 转发原始请求的host头部
            proxy_set_header Host $host;
            # 指定上游服务器负载均衡服务器
            proxy_pass http://myapp1;
            # 故障转移的条件：如果后端的服务器返回502、504、执行超时等错误，自动将请求转发到upstream负载均衡池中的另一台服务器，实现故障转移。
            # error 连接到服务器发生错误
            # timeout 连接服务器超时
            # invalid_header 服务器返回空或者错误应答 
            proxy_next_upstream http_502 http_504 error timeout invalid_header; 
            # 代理发送超时时间
            proxy_send_timeout 1s;
            # 代理接收超时时间
            proxy_read_timeout 1s;
            # 重试次数
            proxy_next_upstream_tries 3;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>没有故障，测试：</p> <p><img src="/javablog/public/assets/img/1716817124622.aed64853.png" alt="1716817124622"></p> <p>让其中一台暂停：</p> <p><img src="/javablog/public/assets/img/1716817155390.adc9b3a6.png" alt="1716817155390"></p> <p>再次测试：</p> <p><img src="/javablog/public/assets/img/1716817188957.912f4fdd.png" alt="1716817188957"></p> <h3 id="_9-跨域问题"><a href="#_9-跨域问题" class="header-anchor">#</a> 9，跨域问题</h3> <p><img src="/javablog/public/assets/img/1716817321240.70507b70.png" alt="1716817321240"></p> <p><strong>为什么会出现跨域问题:</strong></p> <p>出于浏览器的同源策略限制。同源策略是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说Web是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。</p> <p><strong>什么是跨域:</strong></p> <p>当一个请求URL的<strong>协议、域名、端口</strong>三者之间任意一个与当前页面url不同即为跨域。</p> <table><thead><tr><th><strong>当前页面url</strong></th> <th><strong>被请求页面url</strong></th> <th><strong>是否跨域</strong></th> <th><strong>原因</strong></th></tr></thead> <tbody><tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://www.test.com/index.html" target="_blank" rel="noopener noreferrer">http://www.test.com/index.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>否</td> <td>同源（协议、域名、端口号相同）</td></tr> <tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="https://www.test.com/index.html" target="_blank" rel="noopener noreferrer">https://www.test.com/index.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>协议不同（http/https）</td></tr> <tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://www.baidu.com/" target="_blank" rel="noopener noreferrer">http://www.baidu.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>主域名不同（test/baidu）</td></tr> <tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://blog.test.com/" target="_blank" rel="noopener noreferrer">http://blog.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>子域名不同（www/blog）</td></tr> <tr><td><a href="http://www.test.com:8080/" target="_blank" rel="noopener noreferrer">http://www.test.com:8080/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://www.test.com:7001/" target="_blank" rel="noopener noreferrer">http://www.test.com:7001/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>端口号不同（8080/7001）</td></tr></tbody></table> <p>前端页面：</p> <p><img src="/javablog/public/assets/img/1716817349987.1c4113d7.png" alt="1716817349987"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://libs.baidu.com/jquery/2.0.0/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">function</span> <span class="token function">test</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://103.38.81.223/abc&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>服务器：</p> <p><img src="/javablog/public/assets/img/1716817447318.cee83683.png" alt="1716817447318"></p> <p>postman测试：</p> <p><img src="/javablog/public/assets/img/1716817469921.4a53270b.png" alt="1716817469921"></p> <p>代码测试：</p> <p><img src="/javablog/public/assets/img/1716817581537.57577ff8.png" alt="1716817581537"></p> <p>报错如下：</p> <p><img src="/javablog/public/assets/img/1716817595737.e4a8b553.png" alt="1716817595737"></p> <h3 id="_10-跨域问题解决"><a href="#_10-跨域问题解决" class="header-anchor">#</a> 10，跨域问题解决</h3> <p><strong>解决方案:</strong></p> <p>只需要在Nginx的配置文件中配置以下参数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  location / { 
   add_header Access-Control-Allow-Origin *;
   add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
   add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';


   if ($request_method = 'OPTIONS') {
     return 204;
   }
} 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>参数：</p> <ol><li>Access-Control-Allow-Origin 表示服务器可以接受所有的请求源（Origin）,即接受所有跨域的请求。</li> <li>Access-Control-Allow-Methods 明确了客户端所要访问的资源允许使用的方法或方法列表。</li> <li>Access-Control-Allow-Headers 设置预检请求。</li></ol> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716817774507.b93b282c.png" alt="1716817774507"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server{
        listen 80;
        location /abc {
            # 服务器默认不准跨域  代表服务可以接收所有请求源接收所有跨域
            add_header Access-Control-Allow-Origin *;
            # 运行客户端请求类型
            add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
            # 设置预检请求 w3c http首部字段
            add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
            if ($request_method = 'OPTIONS') {
                return 204;
            }
            return 200 &quot;hello ityls&quot;;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1716817756717.ec66ab4d.png" alt="1716817756717"></p> <h3 id="_11-动静分离"><a href="#_11-动静分离" class="header-anchor">#</a> 11，动静分离</h3> <p><img src="/javablog/public/assets/img/1716817852766.d6123ac3.png" alt="1716817852766"></p> <p>Nginx动静分离简单来说就是把动态和静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求和静态请求分开，可以理解成使用Nginx处理静态请求，Tomcat处理动态请求。</p> <p><strong>什么是动静分离：</strong></p> <ul><li>动：必须依赖服务器生存的文件 比如jsp。</li> <li>静：不需要依赖容器的比如css/js或者图片等文件</li></ul> <p><strong>动静分离的好处：</strong></p> <ul><li>Nginx本身就是一个高性能的静态web服务器</li> <li>其实静态文件有一个特点就是基本上变化不大，所以动静分离以后我们可以对静态文件进行缓存、或者压缩提高网站性能</li></ul> <p><strong>静态资源的类型：</strong></p> <p>在Nginx的conf目录下，有一个mime.types文件里边列出了 静态资源的类型,如下:</p> <p><img src="/javablog/public/assets/img/1716817920288.ab402c57.png" alt="1716817920288"></p> <p>当用户访问一个网站，然后从服务器端获取相应的资源，通过浏览器进行解析渲染最后展示给用户，服务端可以返回各种类型的内容，比如xml、jpg、png、gif、flash、MP4、html、css等等，浏览器就是根据mime-type来决定用什么形式来解析和展示的。服务器返回的资源给到浏览器时，会把媒体类型告知浏览器，这个告知的标识就是Content-Type，比如Content-Type:text/html。</p> <h3 id="_12-动静分离实战"><a href="#_12-动静分离实战" class="header-anchor">#</a> 12，动静分离实战</h3> <p><img src="/javablog/public/assets/img/1716817994633.63f21561.png" alt="1716817994633"></p> <p><strong>静态资源的准备：</strong></p> <p>在服务器中准备文件夹放置图片、css、js。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># mkdir -p /usr/local/nginx/static
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/javablog/public/assets/img/1716818169678.15458907.png" alt="1716818169678"></p> <p><strong>通过请求分离:</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream  webservers  {
     server 192.168.66.101:8080 weight=5;
     server 192.168.66.102:8080 weight=5;
}
   server {
     listen    80;
     server_name  *.*;
     location / {
       root  html;
       index  index.html index.htm;
       proxy_set_header Host $host;
       proxy_pass http://webservers;
     }
     location /image/ {
       root static;
     }
     location /web/ {
       proxy_set_header Host $host;
       proxy_pass http://webservers;
     }
   }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>操作：</p> <p><img src="/javablog/public/assets/img/1716818947279.3b60fcb0.png" alt="1716818947279"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    upstream myapp1 {
        server 103.38.81.223:9090;
        server 103.38.81.223:9091;
    }

    server{
        listen 80;
        location /image/ {
            root html;
        }
        location / {
            # 转发原始请求的host头部
            proxy_set_header Host $host;
            # 指定上游服务器负载均衡服务器
            proxy_pass http://myapp1;
            # 故障转移的条件：如果后端的服务器返回502、504、执行超时等错误，自动将请求转发到upstream负载均衡池中的另一台服务器，实现故障转移。
            # error 连接到服务器发生错误
            # timeout 连接服务器超时
            # invalid_header 服务器返回空或者错误应答 
            proxy_next_upstream http_502 http_504 error timeout invalid_header; 
            # 代理发送超时时间
            proxy_send_timeout 1s;
            # 代理接收超时时间
            proxy_read_timeout 1s;
            # 重试次数
            proxy_next_upstream_tries 3;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1716818390028.af15b950.png" alt="1716818390028"></p> <p><img src="/javablog/public/assets/img/1716818965673.a366cd7e.png" alt="1716818965673"></p> <p><strong>根据扩展名分离:</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>upstream  webservers {
     server 192.168.66.101:8080 weight=5;
     server 192.168.66.102:8080 weight=5;
}
   server {
     listen    80;
     server_name  *.*;
     location / {
       root  html;
       index  index.html index.htm;
       proxy_set_header Host $host;
       proxy_pass http://webservers;
     }
     location ~ .*.(jpg|png|gif|css|js)$ {
     root static;
     }
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>操作：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    upstream myapp1 {
        server 103.38.81.223:9090;
        server 103.38.81.223:9091;
    }

    server{
        listen 80;
        location ~ .*.(jpg|png|gif|css|js)$ {
            root html;
        }
        location / {
            # 转发原始请求的host头部
            proxy_set_header Host $host;
            # 指定上游服务器负载均衡服务器
            proxy_pass http://myapp1;
            # 故障转移的条件：如果后端的服务器返回502、504、执行超时等错误，自动将请求转发到upstream负载均衡池中的另一台服务器，实现故障转移。
            # error 连接到服务器发生错误
            # timeout 连接服务器超时
            # invalid_header 服务器返回空或者错误应答 
            proxy_next_upstream http_502 http_504 error timeout invalid_header; 
            # 代理发送超时时间
            proxy_send_timeout 1s;
            # 代理接收超时时间
            proxy_read_timeout 1s;
            # 重试次数
            proxy_next_upstream_tries 3;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><img src="/javablog/public/assets/img/1716819039702.2f2780fd.png" alt="1716819039702"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716819066606.19c3f7fe.png" alt="1716819066606"></p> <h3 id="_13-限流和限流算法"><a href="#_13-限流和限流算法" class="header-anchor">#</a> 13，限流和限流算法</h3> <p><img src="/javablog/public/assets/img/1716819132960.d455b1eb.png" alt="1716819132960"></p> <p><strong>生活中的限流:</strong></p> <p>春运，一项全人类历史上最大规模的迁移活动，抢火车票一直是每年跨年以后的热点话题。</p> <p><img src="/javablog/public/assets/img/1716819147903.9d30b514.png" alt="1716819147903"></p> <p><strong>为什么需要限流:</strong></p> <p>系统设计时一般会预估负载，当系统暴露在公网中时，恶意攻击或正常突发流量等都可能导致系统被压垮，而限流就是保护措施之一。</p> <p><strong>Nginx 的二种限流设置:</strong></p> <ul><li>控制速率。</li> <li>控制并发连接数。</li></ul> <h3 id="_14-限流算法与实践"><a href="#_14-限流算法与实践" class="header-anchor">#</a> 14，限流算法与实践</h3> <p>限流算法：</p> <ul><li>令牌桶算法</li> <li>漏桶算法</li></ul> <p><strong>漏桶算法：</strong></p> <p><img src="/javablog/public/assets/img/1716819368293.41014131.png" alt="1716819368293"></p> <p><strong>原理：</strong></p> <p>漏桶算法思路很简单，水（请求）先进入到漏桶里，漏桶以一定的速度出水，当水流入速度过大会直接溢出，可以看出漏桶算法能强行限制数据的传输速率。</p> <p><strong>令牌桶算法：</strong></p> <p><img src="/javablog/public/assets/img/1716819435063.f4e7ce40.png" alt="1716819435063"></p> <p><strong>原理:</strong></p> <p>令牌桶算法的原理是系统会以一个恒定的速度往桶里放入令牌，而如果请求需要被处理，则需要先从桶里获取一个令牌，当桶里没有令牌可取时，则拒绝服务。</p> <p><strong>漏桶 vs 令牌桶的区别：</strong></p> <p>漏桶的天然特性决定了它不会发生突发流量，就算每秒1000个请求到来，那么它对后台服务输出的访问速率永远恒定。而令牌桶则不同，其特性可以“预存”一定量的令牌，因此在应对突发流量的时候可以在短时间消耗所有令牌，其突发流量处理效率会比漏桶高，但是导向后台系统的压力也会相应增多。</p> <p><img src="/javablog/public/assets/img/1716819468967.7eb8efd2.png" alt="1716819468967"></p> <p>Nginx配置限流：</p> <ul><li>limit_conn_zone 指令</li> <li>limit_req_zone指令</li></ul> <p>根据nginx官网提供的说法,有两种算法,一种是漏桶算法,一种是令牌桶算法</p> <ul><li>limit_req_zone 用来限制单位时间内的请求数目,以及速度限制。</li> <li>limit_req_conn 用来限制同一时间连接数，即并发限制。</li></ul> <p><strong>Nginx限速配置指令：</strong> 语法结构，放在http{} 内</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>参数解析：</strong></p> <ul><li>第一个参数：$binary_remote_addr 限制同一客户端ip地址。</li> <li>第二个参数：zone=mylimit:10m 用来存储访问的频次信息。</li> <li>第三个参数：rate=1r/s表示允许相同标识的客户端的访问频次，这里限制的是每秒1次，还可以有比如30r/m的。</li></ul> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716819656737.892a1692.png" alt="1716819656737"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    # 限流模块
    limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;

    server{
        listen 80;
        server_name *.*;
        location / {
           root html;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1716819693445.6b562d7e.png" alt="1716819693445"></p> <p>放在server{}内：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>limit_req zone=mylimit burst=1 nodelay;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>参数：</strong></p> <ul><li>第一个参数：zone=one 设置使用哪个配置区域来做限制，与上面limit_req_zone 里的name对应。</li> <li>第二个参数：burst=5，重点说明一下这个配置，burst爆发的意思，这个配置的意思是设置一个大小为5的缓冲区当有大量请求（爆发）过来时，超过了访问频次限制的请求可以先放到这个缓冲区内。</li> <li>第三个参数：nodelay，如果设置，超过访问频次而且缓冲区也满了的时候就会直接返回503，如果没有设置，则所有请求会等待排队。</li></ul> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716819754183.e3573da5.png" alt="1716819754183"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    server{
        listen 80;
        server_name *.*;
        location / {
           limit_req zone=mylimit burst=1 nodelay;
           root html;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1716819783447.5e1b62a9.png" alt="1716819783447"></p> <p><strong>Nginx并发限制配置指令：</strong></p> <p>ngx_http_limit_conn_module 提供了限制连接数的能力，利用 limit_conn_zone 和 limit_conn 两个指令即可。语法结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http{
  #ip limit
  limit_conn_zone $binary_remote_addr zone=perip:10m;
  limit_conn_zone $server_name zone=perserver:10m;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>操作：</p> <p><img src="/javablog/public/assets/img/1716819828609.3a75fb88.png" alt="1716819828609"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    limit_conn_zone $binary_remote_addr zone=perip:10m;
    limit_conn_zone $server_name zone=perserver:10m;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在需要 <strong>限制并发数</strong> 和 <strong>下载带宽</strong> 的网站配置 <strong>server</strong> {}里加上如下代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
   limit_conn perip 10;
   limit_conn perserver 100;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>补充说明下参数：</p> <ul><li>limit_conn perip 10 作用的key 是 $binary_remote_addr，表示限制单个IP同时最多能持有10个连接。</li> <li>limit_conn perserver 100 作用的key是 $server_name，表示虚拟主机(server) 同时能处理并发连接的总数。</li></ul> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716819891751.646d4e45.png" alt="1716819891751"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1716820600984.603c95f2.png" alt="1716820600984"></p> <p><img src="/javablog/public/assets/img/1716820607794.88ff4da6.png" alt="1716820607794"></p> <p><img src="/javablog/public/assets/img/1716820616033.e01a7a8a.png" alt="1716820616033"></p> <p><strong>设置白名单:</strong></p> <p>限流主要针对外部访问，内网访问相对安全，可以不做限流，通过设置白名单即可。利用 Nginx ngx_http_geo_module 和 ngx_http_map_module 两个工具模块即可搞定。</p> <p>查看是否具有该功能</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>./configure --help |grep http_limit_req_module
./configure --help |grep http_geo_module
./configure --help |grep http_map_module
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在 nginx.conf 的 http 部分中配置白名单：</p> <p><img src="/javablog/public/assets/img/1716820305113.2ae9b446.png" alt="1716820305113"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    geo $limit {
        default 1;
        39.100.243.125 0;
        192.168.0.0/24 0;
        172.20.0.35 0;
    }
    map $limit $limit_key {
        0 &quot;&quot;;
        1 $binary_remote_addr;
    }
    limit_req_zone $limit_key zone=myRateLimit:10m rate=10r/s;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>参数：</strong></p> <ul><li>geo 对于白名单(子网或IP都可以) 将返回0，其他IP将返回1。</li> <li>map 将limit转换为 limit_key，如果是 $limit 是0(白名单)，则返回空字符串；如果是1，则返回客户端实际IP。</li> <li>limit_req_zone 限流的key不再使用 binary_remote_addr，而是limit_key 来动态获取值。如果是白名单，limit_req_zone 的限流key则为空字符串，将不会限流；若不是白名单，将会对客户端真实IP进行限流。</li></ul> <h3 id="_15-缓存机制"><a href="#_15-缓存机制" class="header-anchor">#</a> 15，缓存机制</h3> <p>Nginx缓存机制：</p> <ul><li>proxy Cache</li> <li>Nging与Squid组合</li></ul> <p>响应速度历来是衡量WEB应用和服务性能优劣的重要指标之一，尤其动态网站在网络上泛滥的今天。除了优化发布内容以外，另外一个主要的办法就是把不需要实时更新的动态页面输出结果转为静态网页形式缓存，进而按照静态网页来访问。</p> <p><strong>proxy Cache缓存机制:</strong></p> <p><img src="/javablog/public/assets/img/1716820793571.6fd09b93.png" alt="1716820793571"></p> <p>**配置proxy_cache模块: ** 语法结构,在nginx.conf文件中添加如下代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http{
   ......
   proxy_cache_path /data/nginx/tmp-test levels=1:2 keys_zone=tmp-test:100m inactive=7d max_size=1000g;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>参数说明:</strong></p> <ul><li>proxy_cache_path 缓存文件路径</li> <li>levels 设置缓存文件目录层次；levels=1:2 表示两级目录</li> <li>keys_zone 设置缓存名字和共享内存大小</li> <li>inactive 在指定时间内没人访问则被删除</li> <li>max_size 最大缓存空间，如果缓存空间满，默认覆盖掉缓存时间最长的资源。</li></ul> <p>操作：</p> <p><img src="/javablog/public/assets/img/1716820944721.34bb3905.png" alt="1716820944721"></p> <p><img src="/javablog/public/assets/img/1716820956184.ea1234f6.png" alt="1716820956184"></p> <p>当配置好之后，重启nginx，如果不报错，则配置的proxy_cache会生效，查看 proxy_cache_path / data/ nginx / 目录， 会发现生成了 tmp -test 文件夹。</p> <p>不使用缓存测试：</p> <p><img src="/javablog/public/assets/img/1716821056665.3782ee54.png" alt="1716821056665"></p> <p>如何使用proxy_cache，语法配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /tmp-test/ {
  proxy_cache tmp-test;
  proxy_cache_valid  200 206 304 301 302 10d;
  proxy_cache_key $uri;
  proxy_set_header Host $host:$server_port;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header  X-Forwarded-For      $proxy_add_x_forwarded_for;
  proxy_pass http://127.0.0.1:8081/media_store.php/tmp-test/;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>参数：</strong></p> <ul><li>Proxy_cache tmp -test 使用名为 tmp -test 的对应缓存配置 proxy_cache_valid 200 206 304 301 302 10d; 对httpcode为200…的缓存10天</li> <li>proxy_cache_key $uri 定义缓存唯一key,通过唯一key来进行hash存取</li> <li>proxy_set_header 自定义http header头，用于发送给后端真实服务器。</li> <li>proxy_pass 指代理后转发的路径，注意是否 需要 最后的 /</li></ul> <p>使用缓存：</p> <p><img src="/javablog/public/assets/img/1716821142570.9f76f275.png" alt="1716821142570"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    upstream myapp1 {
        server 103.38.81.223:9090;
        server 103.38.81.223:9091;
    }
    # 限流模块
    limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;
    limit_conn_zone $binary_remote_addr zone=perip:10m;
    limit_conn_zone $server_name zone=perserver:10m;
    proxy_cache_path /data/nginx/tmp-test levels=1:2 keys_zone=tmp-test:100m inactive=7d max_size=1000g;

    server{
        listen 80;
        location / {
            proxy_cache tmp-test;
            proxy_cache_valid  200 206 304 301 302 10d;
            proxy_cache_key $uri;
            proxy_set_header Host $host:$server_port;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header  X-Forwarded-For      $proxy_add_x_forwarded_for;
            proxy_pass http://myapp1;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>加了缓存后，测试：</p> <p><img src="/javablog/public/assets/img/1716821203776.8191afca.png" alt="1716821203776"></p> <p>提出问题：到此，就完成了最基本的proxy_cache配置和访问过程介绍，但是最基本的配置，往往无法满足我们的业务需求，我们往往会提出以下疑问和需求：</p> <ol><li>需要主动清理缓存文件</li></ol> <p>解决问题：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /tmp-test/ {
    allow 127.0.0.1; //只允许本机访问
    deny all; //禁止其他所有ip
    proxy_cache_purge tmp-test $uri;  //清理缓存
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_16-nginx高可用"><a href="#_16-nginx高可用" class="header-anchor">#</a> 16，nginx高可用</h3> <p><img src="/javablog/public/assets/img/1716821334578.3d0eb481.png" alt="1716821334578"></p> <p><strong>什么是高可用：</strong></p> <p>高可用HA（High Availability）是分布式系统架构设计中必须考虑的因素之一，它通常是指，通过设计减少系统不能提供服务的时间。如果一个系统能够一直提供服务，那么这个可用性则是百分之百，但是天有不测风云。所以我们只能尽可能的去减少服务的故障。</p> <p><img src="/javablog/public/assets/img/1716821388487.ef1fb5f8.png" alt="1716821388487"></p> <p><strong>解决的问题：</strong></p> <p>在生产环境上很多时候是以<code>Nginx</code>做反向代理对外提供服务，但是一天Nginx难免遇见故障，如：服务器宕机。当<code>Nginx</code>宕机那么所有对外提供的接口都将导致无法访问。虽然我们无法保证服务器百分之百可用，但是也得想办法避免这种悲剧，今天我们使用<code>keepalived</code>来实现<code>Nginx</code>的高可用。</p> <p><strong>双机热备方案：</strong></p> <p>这种方案是国内企业中最为普遍的一种高可用方案，双机热备其实就是指一台服务器在提供服务，另一台为某服务的备用状态，当一台服务器不可用另外一台就会顶替上去。</p> <p><img src="/javablog/public/assets/img/1716821433793.56851a02.png" alt="1716821433793"></p> <h3 id="_17-lvs负载均衡"><a href="#_17-lvs负载均衡" class="header-anchor">#</a> 17，LVS负载均衡</h3> <p><img src="/javablog/public/assets/img/1716821486551.ed997efd.png" alt="1716821486551"></p> <p>LVS是一个开源的软件，可以实现传输层四层负载均衡。LVS是Linux Virtual Server的缩写，意思是Linux虚拟服务器。</p> <p><strong>目标</strong>：</p> <p>通过 LVS 达到的负载均衡技术和 Linux 操作系统实现一个高性能高可用的 Linux 服务器集群，它具有良好的可靠性、可扩展性和可操作性。从而以低廉的成本实现最优的性能。</p> <p><img src="/javablog/public/assets/img/1716821644096.ab6fe727.png" alt="1716821644096"></p> <p><strong>LVS的八种调度算法：</strong></p> <ol><li>轮叫调度 rr</li> <li>加权轮叫 wrr</li> <li>最少链接 lc</li> <li>加权最少链接 wlc</li> <li>基于局部性的最少连接调度算法 lblc</li> <li>复杂的基于局部性最少的连接算法 lblcr</li> <li>目标地址散列调度算法 dh</li> <li>源地址散列调度算法 sh</li></ol> <h3 id="_18-keepalived健康监测"><a href="#_18-keepalived健康监测" class="header-anchor">#</a> 18，keepalived健康监测</h3> <p><img src="/javablog/public/assets/img/1716821741168.7553e0f3.png" alt="1716821741168"></p> <p><img src="/javablog/public/assets/img/1716821806626.4cd2e9ed.png" alt="1716821806626"></p> <p>LVS可以实现负载均衡，但是不能够进行健康检查，比如一个rs出现故障，LVS 仍然会把请求转发给故障的rs服务器，这样就会导致请求的无效性。keepalive 软件可以进行健康检查，而且能同时实现 LVS 的高可用性，解决 LVS 单点故障的问题，其实 keepalive 就是为 LVS 而生的。</p> <p><strong>keepalived工作原理：</strong></p> <p>keepalived是基于VRRP协议实现的保证集群高可用的一个服务软件，主要功能是实现真机的故障隔离和负载均衡器间的失败切换，防止单点故障。</p> <p><strong>VRRP协议：</strong></p> <p>VRRP是一种容错协议，它保证当主机的下一跳路由器出现故障时，由另一台路由器来代替出现故障的路由器进行工作，从而保持网络通信的连续性和可靠性。</p> <p><strong>主要作用：</strong></p> <p>VRRP可以将两台或者多台物理路由器设备虚拟成一个虚拟路由，这个虚拟路由器通过虚拟IP（一个或者多个)对外提供服务。</p> <h3 id="_19-企业双机热备方案"><a href="#_19-企业双机热备方案" class="header-anchor">#</a> 19，企业双机热备方案</h3> <p>大家自行实践：</p> <p><img src="/javablog/public/assets/img/1716821960815.1d26d586.png" alt="1716821960815"></p> <p>参考：https://blog.csdn.net/weixin_47188171/article/details/122909207</p> <p><strong>环境服务配置：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>两台Nginx服务器
Nginx 主服务器  192.168.66.100
Nginx 备服务器  192.168.66.101
Lvs 虚拟VIP   192.168.66.99
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>环境搭建:</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum install -y  keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>keepalived 常用命令:</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service keepalived start
service keepalived stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>启动报错：</strong></p> <p>Starting keepalived (via systemctl): Job for keepalived.service failed. See 'systemctl status keepalived.service' and 'journalctl -xn' for details.</p> <p><strong>解决办法</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@edu-proxy-01 sbin]# cd /usr/sbin/
[root@edu-proxy-01 sbin]# rm -f keepalived
[root@edu-proxy-01 sbin]# cp /usr/local/keepalived/sbin/keepalived /usr/sbin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>使用keepalived虚拟VIP，修改主keepalived信息：</strong></p> <p>修改主Nginx服务器keepalived文件, /etc/keepalived/keepalived.conf，State 为MASTER</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>! Configuration File for keepalived


vrrp_script chk_nginx {
   script &quot;/etc/keepalived/nginx_check.sh&quot; #运行脚本，脚本内容下面有，就是起到一个nginx宕机以后，自动开启服务
   interval 2 #检测时间间隔
   weight -20 #如果条件成立的话，则权重 -20
}
# 定义虚拟路由，VI_1 为虚拟路由的标示符，自己定义名称
vrrp_instance VI_1 {
   state MASTER #来决定主从
   interface ens33 # 绑定虚拟 IP 的网络接口，根据自己的机器填写
   virtual_router_id 121 # 虚拟路由的 ID 号， 两个节点设置必须一样
   mcast_src_ip 192.168.212.141 #填写本机ip
   priority 100 # 节点优先级,主要比从节点优先级高
   nopreempt # 优先级高的设置 nopreempt 解决异常恢复后再次抢占的问题
   advert_int 1 # 组播信息发送间隔，两个节点设置必须一样，默认 1s
   authentication {
     auth_type PASS
     auth_pass 1111
   }
   # 将 track_script 块加入 instance 配置块
   track_script {
     chk_nginx #执行 Nginx 监控的服务
   }


   virtual_ipaddress {
     192.168.212.110 # 虚拟ip,也就是解决写死程序的ip怎么能切换的ip,也可扩展，用途广泛。可配置多个。
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>修改从keepalived信息，修改主Nginx服务器keepalived文件, /etc/keepalived/keepalived.conf：</strong></p> <p>State 为BACKUP</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>! Configuration File for keepalived


vrrp_script chk_nginx {
   script &quot;/etc/keepalived/nginx_check.sh&quot; #运行脚本，脚本内容下面有，就是起到一个nginx宕机以后，自动开启服务
   interval 2 #检测时间间隔
   weight -20 #如果条件成立的话，则权重 -20
}
# 定义虚拟路由，VI_1 为虚拟路由的标示符，自己定义名称
vrrp_instance VI_1 {
   state BACKUP #来决定主从
   interface ens33 # 绑定虚拟 IP 的网络接口，根据自己的机器填写
   virtual_router_id 121 # 虚拟路由的 ID 号， 两个节点设置必须一样
   mcast_src_ip 192.168.212.141 #填写本机ip
   priority 100 # 节点优先级,主要比从节点优先级高
   nopreempt # 优先级高的设置 nopreempt 解决异常恢复后再次抢占的问题
   advert_int 1 # 组播信息发送间隔，两个节点设置必须一样，默认 1s
   authentication {
     auth_type PASS
     auth_pass 1111
   }
   # 将 track_script 块加入 instance 配置块
   track_script {
     chk_nginx #执行 Nginx 监控的服务
   }


   virtual_ipaddress {
     192.168.212.110 # 虚拟ip,也就是解决写死程序的ip怎么能切换的ip,也可扩展，用途广泛。可配置多个。
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>Nginx+keepalived实现高可用:</strong></p> <p>写入nginx_check.sh脚本 /etc/keepalived/nginx_check.sh</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#!/bin/bash
A=`ps -C nginx –no-header |wc -l`
if [ $A -eq 0 ];then
   /usr/local/nginx/sbin/nginx
   sleep 2
   if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then
     killall keepalived
   fi
fi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>该脚本一定要授权。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>chmod 777 nginx_check.sh3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/27/2024, 11:16:09 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#一-nginx初识" class="sidebar-link reco-side-一-nginx初识" data-v-b57cc07c>一，Nginx初识</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_1-nginx概述" class="sidebar-link reco-side-_1-nginx概述" data-v-b57cc07c>1，Nginx概述</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_2-nginx四大应用场景" class="sidebar-link reco-side-_2-nginx四大应用场景" data-v-b57cc07c>2，Nginx四大应用场景</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_3-为什么用nginx" class="sidebar-link reco-side-_3-为什么用nginx" data-v-b57cc07c>3，为什么用Nginx</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_4-环境准备" class="sidebar-link reco-side-_4-环境准备" data-v-b57cc07c>4，环境准备</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_5-nginx下载与安装" class="sidebar-link reco-side-_5-nginx下载与安装" data-v-b57cc07c>5，Nginx下载与安装</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_6-nginx目录详解" class="sidebar-link reco-side-_6-nginx目录详解" data-v-b57cc07c>6，Nginx目录详解</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_7-docker安装nginx" class="sidebar-link reco-side-_7-docker安装nginx" data-v-b57cc07c>7，Docker安装Nginx</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_8-nginx服务的启停控制" class="sidebar-link reco-side-_8-nginx服务的启停控制" data-v-b57cc07c>8，Nginx服务的启停控制</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#二-nginx配置指令详解" class="sidebar-link reco-side-二-nginx配置指令详解" data-v-b57cc07c>二，Nginx配置指令详解</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_1-全局块" class="sidebar-link reco-side-_1-全局块" data-v-b57cc07c>1，全局块</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_2-events块" class="sidebar-link reco-side-_2-events块" data-v-b57cc07c>2，events块</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_3-http块" class="sidebar-link reco-side-_3-http块" data-v-b57cc07c>3，http块</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_4-location指令" class="sidebar-link reco-side-_4-location指令" data-v-b57cc07c>4，location指令</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#三-虚拟主机的分类" class="sidebar-link reco-side-三-虚拟主机的分类" data-v-b57cc07c>三，虚拟主机的分类</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_1-三种类型的虚拟主机配置" class="sidebar-link reco-side-_1-三种类型的虚拟主机配置" data-v-b57cc07c>1，三种类型的虚拟主机配置</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_2-单网卡多ip配置" class="sidebar-link reco-side-_2-单网卡多ip配置" data-v-b57cc07c>2，单网卡多IP配置</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_3-基于域名的配置" class="sidebar-link reco-side-_3-基于域名的配置" data-v-b57cc07c>3，基于域名的配置</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_4-基于多端口配置" class="sidebar-link reco-side-_4-基于多端口配置" data-v-b57cc07c>4，基于多端口配置</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#四-核心指令" class="sidebar-link reco-side-四-核心指令" data-v-b57cc07c>四，核心指令</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_1-root和alias指令" class="sidebar-link reco-side-_1-root和alias指令" data-v-b57cc07c>1，root和alias指令</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_2-return指令" class="sidebar-link reco-side-_2-return指令" data-v-b57cc07c>2，return指令</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_3-rewrite指令" class="sidebar-link reco-side-_3-rewrite指令" data-v-b57cc07c>3，rewrite指令</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_4-if指令" class="sidebar-link reco-side-_4-if指令" data-v-b57cc07c>4，if指令</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_5-set和break指令" class="sidebar-link reco-side-_5-set和break指令" data-v-b57cc07c>5，set和break指令</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_6-gzip压缩指令" class="sidebar-link reco-side-_6-gzip压缩指令" data-v-b57cc07c>6，gzip压缩指令</a></li><li class="level-2" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#五-nginx场景实践" class="sidebar-link reco-side-五-nginx场景实践" data-v-b57cc07c>五，Nginx场景实践</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_1-浏览器缓存" class="sidebar-link reco-side-_1-浏览器缓存" data-v-b57cc07c>1，浏览器缓存</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_2-防盗链" class="sidebar-link reco-side-_2-防盗链" data-v-b57cc07c>2，防盗链</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_3-代理服务" class="sidebar-link reco-side-_3-代理服务" data-v-b57cc07c>3，代理服务</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_4-反向代理" class="sidebar-link reco-side-_4-反向代理" data-v-b57cc07c>4，反向代理</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_5-负载均衡" class="sidebar-link reco-side-_5-负载均衡" data-v-b57cc07c>5，负载均衡</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_6-负载均衡算法" class="sidebar-link reco-side-_6-负载均衡算法" data-v-b57cc07c>6，负载均衡算法</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_7-fair模块" class="sidebar-link reco-side-_7-fair模块" data-v-b57cc07c>7，fair模块</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_8-nginx配置故障转移" class="sidebar-link reco-side-_8-nginx配置故障转移" data-v-b57cc07c>8，nginx配置故障转移</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_9-跨域问题" class="sidebar-link reco-side-_9-跨域问题" data-v-b57cc07c>9，跨域问题</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_10-跨域问题解决" class="sidebar-link reco-side-_10-跨域问题解决" data-v-b57cc07c>10，跨域问题解决</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_11-动静分离" class="sidebar-link reco-side-_11-动静分离" data-v-b57cc07c>11，动静分离</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_12-动静分离实战" class="sidebar-link reco-side-_12-动静分离实战" data-v-b57cc07c>12，动静分离实战</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_13-限流和限流算法" class="sidebar-link reco-side-_13-限流和限流算法" data-v-b57cc07c>13，限流和限流算法</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_14-限流算法与实践" class="sidebar-link reco-side-_14-限流算法与实践" data-v-b57cc07c>14，限流算法与实践</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_15-缓存机制" class="sidebar-link reco-side-_15-缓存机制" data-v-b57cc07c>15，缓存机制</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_16-nginx高可用" class="sidebar-link reco-side-_16-nginx高可用" data-v-b57cc07c>16，nginx高可用</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_17-lvs负载均衡" class="sidebar-link reco-side-_17-lvs负载均衡" data-v-b57cc07c>17，LVS负载均衡</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_18-keepalived健康监测" class="sidebar-link reco-side-_18-keepalived健康监测" data-v-b57cc07c>18，keepalived健康监测</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/pyfp/08.html#_19-企业双机热备方案" class="sidebar-link reco-side-_19-企业双机热备方案" data-v-b57cc07c>19，企业双机热备方案</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/javablog/public/assets/js/app.71fab523.js" defer></script><script src="/javablog/public/assets/js/72.426fa802.js" defer></script><script src="/javablog/public/assets/js/1.3c422ec2.js" defer></script><script src="/javablog/public/assets/js/21.579006c6.js" defer></script>
  </body>
</html>
