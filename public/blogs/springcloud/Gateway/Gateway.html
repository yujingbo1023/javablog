<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>04-Gateway | 码路全栈开发</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/javablog/public/favicon.ico">
    <meta name="description" content="快来玩java全栈呀">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/javablog/public/assets/css/0.styles.0bd56f36.css" as="style"><link rel="preload" href="/javablog/public/assets/js/app.e7970ae7.js" as="script"><link rel="preload" href="/javablog/public/assets/js/91.b7a84495.js" as="script"><link rel="preload" href="/javablog/public/assets/js/1.8cfd729d.js" as="script"><link rel="preload" href="/javablog/public/assets/js/66.d37dcd18.js" as="script"><link rel="prefetch" href="/javablog/public/assets/js/10.6bf09733.js"><link rel="prefetch" href="/javablog/public/assets/js/100.d72b93e5.js"><link rel="prefetch" href="/javablog/public/assets/js/101.bfcf98f4.js"><link rel="prefetch" href="/javablog/public/assets/js/102.5e96e7f3.js"><link rel="prefetch" href="/javablog/public/assets/js/103.1cd72481.js"><link rel="prefetch" href="/javablog/public/assets/js/104.c442255f.js"><link rel="prefetch" href="/javablog/public/assets/js/105.97c2f27d.js"><link rel="prefetch" href="/javablog/public/assets/js/106.5a53bc8c.js"><link rel="prefetch" href="/javablog/public/assets/js/107.f0c8fdd5.js"><link rel="prefetch" href="/javablog/public/assets/js/108.af90ee78.js"><link rel="prefetch" href="/javablog/public/assets/js/109.0f853f05.js"><link rel="prefetch" href="/javablog/public/assets/js/11.8a02f8bd.js"><link rel="prefetch" href="/javablog/public/assets/js/110.acc3d3b8.js"><link rel="prefetch" href="/javablog/public/assets/js/111.017368fd.js"><link rel="prefetch" href="/javablog/public/assets/js/112.b6791e4f.js"><link rel="prefetch" href="/javablog/public/assets/js/113.4e76b6c3.js"><link rel="prefetch" href="/javablog/public/assets/js/114.d3d3a9d8.js"><link rel="prefetch" href="/javablog/public/assets/js/115.550ffa33.js"><link rel="prefetch" href="/javablog/public/assets/js/116.a5dd78f5.js"><link rel="prefetch" href="/javablog/public/assets/js/117.c30e0a09.js"><link rel="prefetch" href="/javablog/public/assets/js/118.263eedf6.js"><link rel="prefetch" href="/javablog/public/assets/js/119.9a9f7fb5.js"><link rel="prefetch" href="/javablog/public/assets/js/12.cb27b9e2.js"><link rel="prefetch" href="/javablog/public/assets/js/120.79cc19b3.js"><link rel="prefetch" href="/javablog/public/assets/js/121.070d9e2a.js"><link rel="prefetch" href="/javablog/public/assets/js/122.596d374e.js"><link rel="prefetch" href="/javablog/public/assets/js/123.79fd23ee.js"><link rel="prefetch" href="/javablog/public/assets/js/124.0d11e0cd.js"><link rel="prefetch" href="/javablog/public/assets/js/125.04190ce7.js"><link rel="prefetch" href="/javablog/public/assets/js/126.2c208815.js"><link rel="prefetch" href="/javablog/public/assets/js/127.9a513caf.js"><link rel="prefetch" href="/javablog/public/assets/js/128.ea88757d.js"><link rel="prefetch" href="/javablog/public/assets/js/129.b647cdd0.js"><link rel="prefetch" href="/javablog/public/assets/js/13.b6ecc47e.js"><link rel="prefetch" href="/javablog/public/assets/js/130.da252088.js"><link rel="prefetch" href="/javablog/public/assets/js/131.ebc33e1d.js"><link rel="prefetch" href="/javablog/public/assets/js/132.e20990cd.js"><link rel="prefetch" href="/javablog/public/assets/js/133.3cd27609.js"><link rel="prefetch" href="/javablog/public/assets/js/134.1b266470.js"><link rel="prefetch" href="/javablog/public/assets/js/135.f1433ba0.js"><link rel="prefetch" href="/javablog/public/assets/js/136.f6c3b6ee.js"><link rel="prefetch" href="/javablog/public/assets/js/137.5bdc390e.js"><link rel="prefetch" href="/javablog/public/assets/js/138.2e253eab.js"><link rel="prefetch" href="/javablog/public/assets/js/139.f880188d.js"><link rel="prefetch" href="/javablog/public/assets/js/14.6aace181.js"><link rel="prefetch" href="/javablog/public/assets/js/140.435c0842.js"><link rel="prefetch" href="/javablog/public/assets/js/141.9d1bc96f.js"><link rel="prefetch" href="/javablog/public/assets/js/142.06470f8b.js"><link rel="prefetch" href="/javablog/public/assets/js/143.52cb8544.js"><link rel="prefetch" href="/javablog/public/assets/js/144.a2c92327.js"><link rel="prefetch" href="/javablog/public/assets/js/145.71f4ff26.js"><link rel="prefetch" href="/javablog/public/assets/js/146.6431fbc3.js"><link rel="prefetch" href="/javablog/public/assets/js/147.5d57fd89.js"><link rel="prefetch" href="/javablog/public/assets/js/148.80b9c111.js"><link rel="prefetch" href="/javablog/public/assets/js/149.013f1f55.js"><link rel="prefetch" href="/javablog/public/assets/js/15.0a32ef1c.js"><link rel="prefetch" href="/javablog/public/assets/js/150.a7bf6f11.js"><link rel="prefetch" href="/javablog/public/assets/js/151.97060f0a.js"><link rel="prefetch" href="/javablog/public/assets/js/152.9e3c6525.js"><link rel="prefetch" href="/javablog/public/assets/js/153.40d7b3e1.js"><link rel="prefetch" href="/javablog/public/assets/js/154.9aacdcab.js"><link rel="prefetch" href="/javablog/public/assets/js/155.ae0c2574.js"><link rel="prefetch" href="/javablog/public/assets/js/156.8717b494.js"><link rel="prefetch" href="/javablog/public/assets/js/157.1f00499c.js"><link rel="prefetch" href="/javablog/public/assets/js/158.7b52a3f1.js"><link rel="prefetch" href="/javablog/public/assets/js/159.1500e75a.js"><link rel="prefetch" href="/javablog/public/assets/js/16.dece7035.js"><link rel="prefetch" href="/javablog/public/assets/js/160.32b9db8e.js"><link rel="prefetch" href="/javablog/public/assets/js/161.68f2d5f7.js"><link rel="prefetch" href="/javablog/public/assets/js/162.847501fb.js"><link rel="prefetch" href="/javablog/public/assets/js/163.ae44fe53.js"><link rel="prefetch" href="/javablog/public/assets/js/164.0f5077f0.js"><link rel="prefetch" href="/javablog/public/assets/js/165.18b9d4b0.js"><link rel="prefetch" href="/javablog/public/assets/js/166.3dd24fef.js"><link rel="prefetch" href="/javablog/public/assets/js/167.a2338bd6.js"><link rel="prefetch" href="/javablog/public/assets/js/168.4ad84db4.js"><link rel="prefetch" href="/javablog/public/assets/js/169.af424d2e.js"><link rel="prefetch" href="/javablog/public/assets/js/17.efdf1fb7.js"><link rel="prefetch" href="/javablog/public/assets/js/170.a56e8e4b.js"><link rel="prefetch" href="/javablog/public/assets/js/171.efc9119f.js"><link rel="prefetch" href="/javablog/public/assets/js/172.19cb6470.js"><link rel="prefetch" href="/javablog/public/assets/js/173.52603538.js"><link rel="prefetch" href="/javablog/public/assets/js/174.54dc826b.js"><link rel="prefetch" href="/javablog/public/assets/js/175.c9a500c6.js"><link rel="prefetch" href="/javablog/public/assets/js/176.aa57fba3.js"><link rel="prefetch" href="/javablog/public/assets/js/177.8f753609.js"><link rel="prefetch" href="/javablog/public/assets/js/18.8b6f8577.js"><link rel="prefetch" href="/javablog/public/assets/js/19.06aa8af0.js"><link rel="prefetch" href="/javablog/public/assets/js/20.b627ebf8.js"><link rel="prefetch" href="/javablog/public/assets/js/21.f64adcfc.js"><link rel="prefetch" href="/javablog/public/assets/js/22.29813aa6.js"><link rel="prefetch" href="/javablog/public/assets/js/23.3bd978d1.js"><link rel="prefetch" href="/javablog/public/assets/js/24.0777630a.js"><link rel="prefetch" href="/javablog/public/assets/js/25.e0249943.js"><link rel="prefetch" href="/javablog/public/assets/js/26.a3ab0578.js"><link rel="prefetch" href="/javablog/public/assets/js/27.c44ead5f.js"><link rel="prefetch" href="/javablog/public/assets/js/28.f6849bdc.js"><link rel="prefetch" href="/javablog/public/assets/js/29.db67f27a.js"><link rel="prefetch" href="/javablog/public/assets/js/3.8b779750.js"><link rel="prefetch" href="/javablog/public/assets/js/30.3a2c6eaa.js"><link rel="prefetch" href="/javablog/public/assets/js/31.176af05c.js"><link rel="prefetch" href="/javablog/public/assets/js/32.85f570b7.js"><link rel="prefetch" href="/javablog/public/assets/js/33.acf6303a.js"><link rel="prefetch" href="/javablog/public/assets/js/34.6c5e0a44.js"><link rel="prefetch" href="/javablog/public/assets/js/35.ee1c273e.js"><link rel="prefetch" href="/javablog/public/assets/js/36.a8e0cabd.js"><link rel="prefetch" href="/javablog/public/assets/js/37.25b8b93d.js"><link rel="prefetch" href="/javablog/public/assets/js/38.c56bd786.js"><link rel="prefetch" href="/javablog/public/assets/js/39.69f9d5ba.js"><link rel="prefetch" href="/javablog/public/assets/js/4.65c6fe12.js"><link rel="prefetch" href="/javablog/public/assets/js/40.aeeb0f16.js"><link rel="prefetch" href="/javablog/public/assets/js/41.66892695.js"><link rel="prefetch" href="/javablog/public/assets/js/42.3f23360c.js"><link rel="prefetch" href="/javablog/public/assets/js/43.db56edef.js"><link rel="prefetch" href="/javablog/public/assets/js/44.5133ca2a.js"><link rel="prefetch" href="/javablog/public/assets/js/45.9e01bafa.js"><link rel="prefetch" href="/javablog/public/assets/js/46.33bd736b.js"><link rel="prefetch" href="/javablog/public/assets/js/47.e8f56a8d.js"><link rel="prefetch" href="/javablog/public/assets/js/48.f9ac661b.js"><link rel="prefetch" href="/javablog/public/assets/js/49.0b79000b.js"><link rel="prefetch" href="/javablog/public/assets/js/5.95e5fdc8.js"><link rel="prefetch" href="/javablog/public/assets/js/50.d589eee0.js"><link rel="prefetch" href="/javablog/public/assets/js/51.2671d790.js"><link rel="prefetch" href="/javablog/public/assets/js/52.18a34b53.js"><link rel="prefetch" href="/javablog/public/assets/js/53.08eaaca8.js"><link rel="prefetch" href="/javablog/public/assets/js/54.07c319e7.js"><link rel="prefetch" href="/javablog/public/assets/js/55.1bf06790.js"><link rel="prefetch" href="/javablog/public/assets/js/56.8f219348.js"><link rel="prefetch" href="/javablog/public/assets/js/57.fb2ace21.js"><link rel="prefetch" href="/javablog/public/assets/js/58.a0ead3d2.js"><link rel="prefetch" href="/javablog/public/assets/js/59.3b98afc2.js"><link rel="prefetch" href="/javablog/public/assets/js/6.8fa998f6.js"><link rel="prefetch" href="/javablog/public/assets/js/60.fcc9d1a5.js"><link rel="prefetch" href="/javablog/public/assets/js/61.73eb43b4.js"><link rel="prefetch" href="/javablog/public/assets/js/62.79efaea7.js"><link rel="prefetch" href="/javablog/public/assets/js/63.d06ea46f.js"><link rel="prefetch" href="/javablog/public/assets/js/64.b9da3e0c.js"><link rel="prefetch" href="/javablog/public/assets/js/65.5aa9584c.js"><link rel="prefetch" href="/javablog/public/assets/js/67.02cea56c.js"><link rel="prefetch" href="/javablog/public/assets/js/68.1b36888e.js"><link rel="prefetch" href="/javablog/public/assets/js/69.ee80b98b.js"><link rel="prefetch" href="/javablog/public/assets/js/7.d780c1cc.js"><link rel="prefetch" href="/javablog/public/assets/js/70.17fa67db.js"><link rel="prefetch" href="/javablog/public/assets/js/71.ea9b3fbb.js"><link rel="prefetch" href="/javablog/public/assets/js/72.310fc765.js"><link rel="prefetch" href="/javablog/public/assets/js/73.81db4691.js"><link rel="prefetch" href="/javablog/public/assets/js/74.4d50c2c3.js"><link rel="prefetch" href="/javablog/public/assets/js/75.51ee9d6b.js"><link rel="prefetch" href="/javablog/public/assets/js/76.608c20cd.js"><link rel="prefetch" href="/javablog/public/assets/js/77.5b3a1780.js"><link rel="prefetch" href="/javablog/public/assets/js/78.2b4bd2e6.js"><link rel="prefetch" href="/javablog/public/assets/js/79.ee3fe3a7.js"><link rel="prefetch" href="/javablog/public/assets/js/8.b4f2cb64.js"><link rel="prefetch" href="/javablog/public/assets/js/80.72c9f136.js"><link rel="prefetch" href="/javablog/public/assets/js/81.761f8dfb.js"><link rel="prefetch" href="/javablog/public/assets/js/82.f0c87c00.js"><link rel="prefetch" href="/javablog/public/assets/js/83.945e6197.js"><link rel="prefetch" href="/javablog/public/assets/js/84.e250c71d.js"><link rel="prefetch" href="/javablog/public/assets/js/85.0612371e.js"><link rel="prefetch" href="/javablog/public/assets/js/86.86374dfc.js"><link rel="prefetch" href="/javablog/public/assets/js/87.e69e1f60.js"><link rel="prefetch" href="/javablog/public/assets/js/88.b04c770b.js"><link rel="prefetch" href="/javablog/public/assets/js/89.588493e8.js"><link rel="prefetch" href="/javablog/public/assets/js/9.8fa54418.js"><link rel="prefetch" href="/javablog/public/assets/js/90.a6e72912.js"><link rel="prefetch" href="/javablog/public/assets/js/92.6a4985f5.js"><link rel="prefetch" href="/javablog/public/assets/js/93.4d9ebb2c.js"><link rel="prefetch" href="/javablog/public/assets/js/94.697f9c92.js"><link rel="prefetch" href="/javablog/public/assets/js/95.b79da481.js"><link rel="prefetch" href="/javablog/public/assets/js/96.9b8c9415.js"><link rel="prefetch" href="/javablog/public/assets/js/97.d545cae3.js"><link rel="prefetch" href="/javablog/public/assets/js/98.336720c2.js"><link rel="prefetch" href="/javablog/public/assets/js/99.b83d3155.js">
    <link rel="stylesheet" href="/javablog/public/assets/css/0.styles.0bd56f36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>码路全栈开发</h3> <p class="description" data-v-59e6cb88>快来玩java全栈呀</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>码路</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javablog/public/" class="home-link router-link-active"><img src="/javablog/public/logo.png" alt="码路全栈开发" class="logo"> <span class="site-name">码路全栈开发</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javablog/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      全栈开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/javablog/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/javablog/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/javablog/public/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    码路
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>165</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>43</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/javablog/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      全栈开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/javablog/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/javablog/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/javablog/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javablog/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>04-Gateway</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>码路</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">04-Gateway</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>码路</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>12/15/2028</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>Gateway</span></i></div></div> <div class="theme-reco-content content__default"><h3 id="_1-网关在微服务中的应用"><a href="#_1-网关在微服务中的应用" class="header-anchor">#</a> 1, 网关在微服务中的应用</h3> <p>没有服务网关：</p> <p><img src="/javablog/public/assets/img/1718343281294.7df41274.png" alt="1718343281294"></p> <p><strong>问题：</strong></p> <ol><li>地址太多</li> <li>安全性</li> <li>管理问题</li></ol> <p>**为什么要使用服务网关：**网关是微服务架构中不可或缺的部分。使用网关后，客户端和微服务之间的网络结构如下。</p> <p><img src="/javablog/public/assets/img/1718343328350.7c4eb653.png" alt="1718343328350"></p> <p><strong>注意：</strong></p> <p>网关统一向外部系统（如访问者、服务）提供REST API。在SpringCloud 中，使用Zuul、Spring Cloud Gateway等作为API Gateway来实现动态路由、监控、回退、安全等功能。</p> <p><strong>认识Spring Cloud Gateway：</strong></p> <p>Spring Cloud Gateway 是 Spring Cloud生态系统中的网关，它是基于Spring 5.0、SpringBoot 2.0和Project Reactor等技术开发的，旨在为微服务架构提供一种简单有效的、统一的API路由管理方式，并为微服务架构提供安全、监控、指标和弹性等功能。其目标是替代Zuul。</p> <p><img src="/javablog/public/assets/img/1718343369870.2cc80431.png" alt="1718343369870"></p> <p><strong>注意：</strong></p> <p>Spring Cloud Gateway 用&quot;Netty + Webflux&quot;实现，不要加入Web依赖，否则会报错，它需要加入Webflux依赖。</p> <p><strong>什么是WebFlux：</strong></p> <p>Webflux模式替换了旧的Servlet线程模型。用少量的线程处理request和response io操作，这些线程称为Loop线程，而业务交给响应式编程框架处理，响应式编程是非常灵活的，用户可以将业务中阻塞的操作提交到响应式框架的work线程中执行，而不阻塞的操作依然可以在Loop线程中进行处理，大大提高了Loop线程的利用率。</p> <p><img src="/javablog/public/assets/img/1718343410804.02f45d9c.png" alt="1718343410804"></p> <p><strong>注意：</strong></p> <p>Webflux虽然可以兼容多个底层的通信框架，但是一般情况下，底层使用的还是Netty，毕竟，Netty是目前业界认可的最高性能的通信框架。而Webflux的Loop线程，正好就是著名的Reactor模式IO处理模型的Reactor线程，如果使用的是高性能的通信框架Netty。</p> <p><strong>温馨提示：</strong></p> <p>什么是Netty，Netty 是一个基于NIO的客户、服务器端的编程框架。提供异步的、事件驱动的网络应用程序框架和工具，用以快速开发高性能、高可靠性的网络服务器和客户端程序。</p> <p><strong>Spring Cloud Gateway特点：</strong></p> <ul><li>易于编写谓词( Predicates )和过滤器（ Filters ) 。其Predicates和Filters可作用于特定路由。</li> <li>支持路径重写。</li> <li>支持动态路由。</li> <li>集成了Spring Cloud DiscoveryClient。</li></ul> <h3 id="_2-三个核心概念"><a href="#_2-三个核心概念" class="header-anchor">#</a> 2, 三个核心概念</h3> <p><img src="/javablog/public/assets/img/1718343652973.3b9853fa.png" alt="1718343652973"></p> <p><strong>路由(Route)：</strong></p> <p>这是网关的基本构建块。它由一个ID，一个目标URI，一组断言和一组过滤器定义。如果断言为真，则路由匹配。</p> <p><strong>断言(predicate)：</strong></p> <p>输入类型是一个ServerWebExchange。我们可以使用它来匹配来自HTTP请求的任何内容，例如headers或参数。</p> <p><strong>过滤(filter)：</strong></p> <p>可以在请求被路由前或者之后对请求进行修改。</p> <p><img src="/javablog/public/assets/img/1718343666908.7eb58ea8.png" alt="1718343666908"></p> <p><strong>举个例子：</strong></p> <p>你想去动物园游玩，那么你买了一张熊猫馆的门票，只能进入熊猫馆的区域，而不能去犀牛管瞎转。因为没有犀牛馆的门票，进不去，就算走到门口，机器也不能识别。这里门票就相当于请求URL，熊猫馆相当于<strong>路由</strong>，而门口识别门卡的机器就是<strong>断言</strong>。然后我进入熊猫馆里面看到工作人员我想很有可能是<strong>过滤器</strong>，结果还真是，他在我进入馆之前拿手持设备对我全身扫描看看有没有危险品(请求前改代码)，并且在我出熊猫馆之后要求再次检察看看我是否携带熊猫出馆(请求后改动代码)。这个工作人员相当于<strong>过滤器</strong>。</p> <p><strong>总结：</strong></p> <p>首先任何请求进来，网关都会把它们拦住。根据请求的URL把它们分配到不同的<strong>路由</strong>上，<strong>路由</strong>上面会有<strong>断言</strong>，来判断请求能不能进来。进来之后会有一系列的<strong>过滤器</strong>对请求被转发前或转发后进行改动。 具体怎么个改动法，那就根据业务不同而自定义了。一般就是监控，限流，日志输出等等。</p> <h3 id="_3-入门案例"><a href="#_3-入门案例" class="header-anchor">#</a> 3, 入门案例</h3> <p>创建cloud-gateway-gateway9527工程</p> <p><img src="/javablog/public/assets/img/1718344195105.2cec3e2c.png" alt="1718344195105"></p> <p>依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--  引入网关Gateway依赖   --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>主启动类:</p> <p><img src="/javablog/public/assets/img/1718344331855.28118949.png" alt="1718344331855"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayMain</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GatewayMain</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;********** GatewayMain 服务启动成功 *********&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>配置：</p> <p><img src="/javablog/public/assets/img/1718344468538.48b3f03d.png" alt="1718344468538"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token comment"># 路由ID，没有固定规则但要求唯一，建议配合服务名</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>openfeign<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
          <span class="token comment"># 匹配后提供服务的路由地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">80</span>
          <span class="token comment"># 断言</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token comment"># 路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Path=/order/*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>测试:</strong></p> <ul><li>启动注册中心 7001,7002</li> <li>启动服务提供者8001</li> <li>启动网关服务9527</li></ul> <p>请求：http://localhost:9527/payment/index</p> <p><img src="/javablog/public/assets/img/1718344587549.8c274df2.png" alt="1718344587549"></p> <h3 id="_4-java-api构建路由"><a href="#_4-java-api构建路由" class="header-anchor">#</a> 4, JAVA API构建路由</h3> <p><img src="/javablog/public/assets/img/1718344614702.1355e0ff.png" alt="1718344614702"></p> <p>代码注入RouteLocator:</p> <p><img src="/javablog/public/assets/img/1718344735549.ebf71be3.png" alt="1718344735549"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">customRouteLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> routeLocatorBuilder<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">RouteLocatorBuilder<span class="token punctuation">.</span>Builder</span> routes <span class="token operator">=</span> routeLocatorBuilder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置路由</span>
        routes<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;path_rote&quot;</span><span class="token punctuation">,</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/guonei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://news.baidu.com/guonei&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>测试：</p> <p><img src="data:image/png;base64,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" alt="1718344888798"></p> <h3 id="_5-路由规则"><a href="#_5-路由规则" class="header-anchor">#</a> 5, 路由规则</h3> <p>Gateway 的路由规则主要有三个部分，分别是路由、断言(谓词)和过滤器。</p> <p><img src="/javablog/public/assets/img/1718347536763.34baa32c.png" alt="1718347536763"></p> <p>**路由：**路由是 Gateway 的⼀个基本单元。</p> <p>**断言：**也称谓词，实际上是路由的判断规则。一个路由中可以添加多个谓词的组合。</p> <p><strong>提示：</strong></p> <ul><li>打个比方，你可以为某个路由设置⼀条谓词规则，约定访问路径的匹配规则为</li> <li>Path=/bingo/*，在这种情况下只有以 /bingo 打头的请求才会被当前路由选中。</li></ul> <p><strong>过滤器：</strong></p> <p><img src="/javablog/public/assets/img/1718347631234.6ca1079f.png" alt="1718347631234"></p> <p>Gateway 组件使用了⼀种 FilterChain的模式对请求进行处理，每⼀个服务请求（Request）在发送到目标标服务之前都要被⼀串 FilterChain处理。同理，在 Gateway接收服务响应（Response）的过程中也会被 FilterChain 处理⼀把。</p> <h3 id="_6-动态路由"><a href="#_6-动态路由" class="header-anchor">#</a> 6, 动态路由</h3> <p>创建payment8002，依赖使用的和8001是一样的。</p> <p><img src="/javablog/public/assets/img/1718347919075.55575261.png" alt="1718347919075"></p> <p>配置：</p> <p><img src="/javablog/public/assets/img/1718347998122.35a85663.png" alt="1718347998122"></p> <p><img src="/javablog/public/assets/img/1718348019465.98a310cb.png" alt="1718348019465"></p> <p><img src="/javablog/public/assets/img/1718348127851.5ec1700b.png" alt="1718348127851"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/lb&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">lb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动：</p> <p><img src="/javablog/public/assets/img/1718348309925.ca9d67da.png" alt="1718348309925"></p> <p><img src="/javablog/public/assets/img/1718348328807.4f744b01.png" alt="1718348328807"></p> <p>默认情况下Gateway会根据注册中心的服务列表，以注册中心上微服务名为路径创建动态路由进行转发，从而实现动态路由的功能。</p> <p><strong>添加eureka依赖：</strong></p> <p><img src="/javablog/public/assets/img/1718348412889.88ad79e2.png" alt="1718348412889"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--  引入Eureka client依赖  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>启动类：</p> <p><img src="/javablog/public/assets/img/1718348855987.fe6f2572.png" alt="1718348855987"></p> <p><strong>添加yml配置:</strong></p> <p><img src="/javablog/public/assets/img/1718348789896.8cfaee33.png" alt="1718348789896"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment"># Eureka server 地址</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka7002.com<span class="token punctuation">:</span>7002/eureka
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token comment">#根据需要自己起名字</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>gateway9527
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token comment"># 路由ID，没有固定规则但要求唯一，建议配合服务名</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>openfeign<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
          <span class="token comment"># 匹配后提供服务的路由地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">80</span>
          <span class="token comment"># 断言</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token comment"># 路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Path=/order/*
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
          <span class="token comment"># # 匹配后提供服务的路由地址 lb后跟提供服务的微服务的名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//CLOUD<span class="token punctuation">-</span>PAYMENT<span class="token punctuation">-</span>PROVIDER
          <span class="token comment"># 断言</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token comment"># 路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Path=/payment/*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>测试：</strong></p> <ul><li>启动eureka服务注册发现 7001,7002</li> <li>启动服务提供者payment8001,8002</li> <li>启动网关服务测试</li></ul> <p><img src="/javablog/public/assets/img/1718348899659.d19243a2.png" alt="1718348899659"></p> <p><img src="/javablog/public/assets/img/1718348958787.510dfe6f.png" alt="1718348958787"></p> <h3 id="_7-断言"><a href="#_7-断言" class="header-anchor">#</a> 7, 断言</h3> <p>一个请求在抵达网关层后，首先就要进行断言匹配，在满足所有断言之后才会进入Filter阶段。说白了Predicate就是一种路由规则，通过Gateway中丰富的内置断言的组合，我们就能让一个请求找到对应的Route来处理。</p> <p><strong>After路由断言 Factory：</strong></p> <p>After Route Predicate Factory采用一个参数——日期时间。在该日期时间之后发生的请求都将被匹配。</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token comment"># 路径相匹配的进行路由</span>
  <span class="token punctuation">-</span> Path=/payment/<span class="token important">**</span>
  <span class="token punctuation">-</span> After=2030<span class="token punctuation">-</span>02<span class="token punctuation">-</span>15T14<span class="token punctuation">:</span>54<span class="token punctuation">:</span>23.317+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>  <span class="token comment"># UTC时间格式的时间参数。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>UTC时间格式的时间参数时间生成方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ZonedDateTime</span> now <span class="token operator">=</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Before路由断言 Factory:</strong></p> <p>Before Route Predicate Factory采用一个参数——日期时间。在该日期时间之前发生的请求都将被匹配。</p> <p>yml文件添加配置：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Before=2030<span class="token punctuation">-</span>02<span class="token punctuation">-</span>15T14<span class="token punctuation">:</span>54<span class="token punctuation">:</span>23.317+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>Between 路由断言 Factory：</strong></p> <p>Between 路由断言 Factory有两个参数，datetime1和datetime2。在datetime1和datetime2之间的请求将被匹配。datetime2参数的实际时间必须在datetime1之后。</p> <p>yml文件添加配置：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Between=2030<span class="token punctuation">-</span>02<span class="token punctuation">-</span>15T14<span class="token punctuation">:</span>54<span class="token punctuation">:</span>23.317+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span><span class="token punctuation">,</span>2030<span class="token punctuation">-</span>02<span class="token punctuation">-</span>15T14<span class="token punctuation">:</span>54<span class="token punctuation">:</span>23.317+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>Cookie路由断言 Factory:</strong></p> <p>顾名思义，Cookie验证的是Cookie中保存的信息，Cookie断言和上面介绍的两种断言使用方式大同小异，唯一的不同是它必须连同属性值一同验证，不能单独只验证属性是否存在。</p> <p>yml文件添加配置：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token comment"># 路径相匹配的进行路由</span>
   <span class="token punctuation">-</span> Cookie=username<span class="token punctuation">,</span>zzyy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/javablog/public/assets/img/1718349644527.b24ceeda.png" alt="1718349644527"></p> <p><strong>Header路由断言 Factory:</strong></p> <p>这个断言会检查Header中是否包含了响应的属性，通常可以用来验证请求是否携带了访问令牌。</p> <p>yml文件添加配置：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 请求头要有X-Request-Id属性并且值为整数的正则表达式</span>
<span class="token key atrule">predicates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/javablog/public/assets/img/1718349624269.8457f408.png" alt="1718349624269"></p> <p><strong>Host路由断言 Factory:</strong></p> <p>Host 路由断言 Factory包括一个参数：host name列表。使用Ant路径匹配规则， <code>.</code>作为分隔符。访问的主机匹配http或者https, baidu.com 默认80端口, 就可以通过路由。 多个<code>,</code>号隔开。</p> <p>yml文件添加配置：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">predicates</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> Host=malu.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Host文件新增配置:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1 malu.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Method路由断言 Factory:</strong></p> <p>这个断言是专门验证HTTP Method的，在下面的例子中，我们把Method断言和Path断言通过一个and连接符合并起来，共同作用于路由判断，当我们访问“/gateway/sample”并且HTTP Method是GET的时候，将适配下面的路由。</p> <p>yml文件添加配置：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token comment"># 路由ID，没有固定规则但要求唯一，建议配合服务名</span>
     <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> payment_provider
     <span class="token comment"># 匹配后提供服务的路由地址</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//CLOUD<span class="token punctuation">-</span>PAYMENT<span class="token punctuation">-</span>PROVIDER
     <span class="token comment"># 断言</span>
      <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
      <span class="token comment"># 路径相匹配的进行路由</span>
       <span class="token punctuation">-</span> Path=/payment/<span class="token important">**</span>
       <span class="token punctuation">-</span> Method=GET
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>Query路由断言 Factory:</strong></p> <p>请求断言也是在业务中经常使用的，它会从ServerHttpRequest中的Parameters列表中查询指定的属性，有如下两种不同的使用方式。</p> <p>yml文件添加配置：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token comment"># 路由ID，没有固定规则但要求唯一，建议配合服务名</span>
     <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> payment_provider
     <span class="token comment"># 匹配后提供服务的路由地址</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//CLOUD<span class="token punctuation">-</span>PAYMENT<span class="token punctuation">-</span>PROVIDER
     <span class="token comment"># 断言</span>
      <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
      <span class="token comment"># 路径相匹配的进行路由</span>
       <span class="token punctuation">-</span> Path=/payment/<span class="token important">**</span>
      <span class="token comment"># 要有参数名称并且是正整数才能路由</span>
       <span class="token punctuation">-</span> Query=username<span class="token punctuation">,</span>\d+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/javablog/public/assets/img/1718349592956.f6b13d92.png" alt="1718349592956"></p> <h3 id="_8-过滤器"><a href="#_8-过滤器" class="header-anchor">#</a> 8, 过滤器</h3> <p>微服务系统中的服务非常多。如果每个服务都自己做鉴权、限流、日志输出，则非常不科学。所以，可以通过网关的过滤器来处理这些工作。在用户访问各个服务前，应在网关层统一做好鉴权、限流等工作。</p> <p><strong>Filter的生命周期:</strong></p> <p>根据生命周期可以将Spring Cloud Gateway中的Filter分为&quot;PRE&quot;和&quot;POST&quot;两种。</p> <ul><li><strong>PRE</strong>：代表在请求被路由之前执行该过滤器，此种过滤器可用来实现参数校验、权限校验、流量监控、日志输出、协议转换等功能。</li> <li><strong>POST</strong>：代表在请求被路由到微服务之后执行该过滤器。此种过滤器可用来实现响应头的修改（如添加标准的HTTP Header )、收集统计信息和指标、将响应发送给客户端、输出日志、流量监控等功能。</li></ul> <p><strong>Filter分类:</strong></p> <p>根据作用范围，Filter可以分为以下两种。</p> <ul><li>GatewayFilter：网关过滤器，此种过滤器只应用在单个路由或者一个分组的路由上。</li> <li>GlobalFilter：全局过滤器，此种过滤器会应用在所有的路由上。</li></ul> <h3 id="_9-网关过滤器"><a href="#_9-网关过滤器" class="header-anchor">#</a> 9, 网关过滤器</h3> <p>网关过滤器( GatewayFilter )允许以某种方式修改传入的HTTP请求,或输出的HTTP响应。网关过滤器作用于特定路由。Spring Cloud Gateway内置了许多网关过滤器工厂来编写网关过滤器。</p> <table><thead><tr><th>过滤器工厂</th> <th>作用</th> <th>参数</th></tr></thead> <tbody><tr><td>AddRequestHeader</td> <td>为原始请求添加Header</td> <td>Header的名称及值</td></tr> <tr><td>AddRequestParameter</td> <td>为原始请求添加请求参数</td> <td>参数名称及值</td></tr> <tr><td>AddResponseHeader</td> <td>为原始响应添加Header</td> <td>Header的名称及值</td></tr> <tr><td>DedupeResponseHeader</td> <td>剔除响应头中重复的值</td> <td>需要去重的Header名称及去重策略</td></tr> <tr><td>Hystrix</td> <td>为路由引入Hystrix的断路器保护 HystrixCommand的名称</td> <td></td></tr> <tr><td>FallbackHeaders</td> <td>为fallbackUri的请求头中添加具体的异常信息</td> <td>Header的名称</td></tr> <tr><td>PrefixPath</td> <td>为原始请求路径添加前缀</td> <td>前缀路径</td></tr> <tr><td>PreserveHostHeader</td> <td>为请求添加一个preserveHostHeader=true的属性，路由过滤器会检查该属性以决定是否要发送原始的Host</td> <td>无</td></tr> <tr><td>RequestRateLimiter</td> <td>用于对请求限流，限流算法为令牌桶</td> <td>keyResolver、rateLimiter、statusCode、denyEmptyKey、emptyKeyStatus</td></tr> <tr><td>RedirectTo</td> <td>将原始请求重定向到指定的URL</td> <td>http状态码及重定向的url</td></tr> <tr><td>RemoveHopByHopHeadersFilter</td> <td>为原始请求删除IETF组织规定的一系列Header</td> <td>默认就会启用，可以通过配置指定仅删除哪些Header</td></tr> <tr><td>RemoveRequestHeader</td> <td>为原始请求删除某个Header</td> <td>Header名称</td></tr> <tr><td>RemoveResponseHeader</td> <td>为原始响应删除某个Header</td> <td>Header名称</td></tr> <tr><td>RewritePath</td> <td>重写原始的请求路径</td> <td>原始路径正则表达式以及重写后路径的正则表达式</td></tr> <tr><td>RewriteResponseHeader</td> <td>重写原始响应中的某个Header</td> <td>Header名称，值的正则表达式，重写后的值</td></tr> <tr><td>SaveSession</td> <td>在转发请求之前，强制执行WebSession::save操作</td> <td>无</td></tr> <tr><td>secureHeaders</td> <td>为原始响应添加一系列起安全作用的响应头</td> <td>无，支持修改这些安全响应头的值</td></tr> <tr><td>SetPath</td> <td>修改原始的请求路径</td> <td>修改后的路径</td></tr> <tr><td>SetResponseHeader</td> <td>修改原始响应中某个Header的值</td> <td>Header名称，修改后的值</td></tr> <tr><td>SetStatus</td> <td>修改原始响应的状态码</td> <td>HTTP 状态码，可以是数字，也可以是字符串</td></tr> <tr><td>StripPrefix</td> <td>用于截断原始请求的路径</td> <td>使用数字表示要截断的路径的数量</td></tr> <tr><td>Retry</td> <td>针对不同的响应进行重试</td> <td>retries、statuses、methods、series</td></tr> <tr><td>RequestSize</td> <td>设置允许接收最大请求包的大小。如果请求包大小超过设置的值，则返回 413 Payload Too Large</td> <td>请求包大小，单位为字节，默认值为5M</td></tr> <tr><td>ModifyRequestBody</td> <td>在转发请求之前修改原始请求体内容</td> <td>修改后的请求体内容</td></tr> <tr><td>ModifyResponseBody</td> <td>修改原始响应体的内容</td> <td>修改后的响应体内容</td></tr> <tr><td>Default</td> <td>为所有路由添加过滤器</td> <td>过滤器工厂名称及值</td></tr></tbody></table> <p><strong>常用内置过滤器的使用:</strong> 配置文件中加入SetStatus过滤器</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment">#过滤器，请求在传递过程中可以通过过滤器对其进行一定的修改</span>
<span class="token key atrule">filters</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> SetStatus=250 <span class="token comment"># 修改原始响应的状态码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>配置：</p> <p><img src="/javablog/public/assets/img/1718350048159.caf8c03d.png" alt="1718350048159"></p> <h3 id="_10-自定义网关过滤器"><a href="#_10-自定义网关过滤器" class="header-anchor">#</a> 10, 自定义网关过滤器</h3> <p><img src="/javablog/public/assets/img/1718350141563.0d2b33ed.png" alt="1718350141563"></p> <p>需求：通过过滤器，配置是否在控制台输出日志信息，以及是否记录日志。实现步骤：</p> <ul><li>1、类名必须叫做XxxGatewayFilterFactory，注入到Spring容器后使用时的名称就叫做Xxx。</li> <li>2、创建一个静态内部类Config， 里面的属性为配置文件中配置的参数， - 过滤器名称=参数1,参数2…</li> <li>2、类必须继承 AbstractGatewayFilterFactory，让父类帮实现配置参数的处理。</li> <li>3、重写shortcutFieldOrder()方法，返回List参数列表为Config中属性集合</li></ul> <p>return Arrays.asList(“参数1”,参数2…)</p> <ul><li>4、无参构造方法中super(Config.class)</li> <li>5、编写过滤逻辑 public GatewayFilter apply(Config config)</li></ul> <p>自定义一个过滤器工厂，实现里面的方法：</p> <p><img src="/javablog/public/assets/img/1718350261567.a812633e.png" alt="1718350261567"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 自定义局部过滤器
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">LogGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">shortcutFieldOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;consoleLog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>consoleLog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;console日志已开启...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">boolean</span> consoleLog<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>配置：</p> <p><img src="/javablog/public/assets/img/1718350366015.b7d64f09.png" alt="1718350366015"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 过滤器，请求在传递过程中可以通过过滤器对其进行一定的修改</span>
<span class="token key atrule">filters</span><span class="token punctuation">:</span> 
  <span class="token comment"># 控制日志是否开启</span>
  <span class="token punctuation">-</span> Log=true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>请求http://localhost:9527/payment/lb</p> <p><img src="/javablog/public/assets/img/1718350479435.d4e2824e.png" alt="1718350479435"></p> <h3 id="_11-自定义全局网关过滤器"><a href="#_11-自定义全局网关过滤器" class="header-anchor">#</a> 11, 自定义全局网关过滤器</h3> <p>全局过滤器作用于所有路由，无需配置。通过全局过滤器可以实现对权限的统一校验，安全性验证等功能。</p> <p><strong>内置的全局过滤器:</strong></p> <p>SpringCloud Gateway内部也是通过一系列的内置全局过滤器对整个路由转发进行处理的。</p> <ul><li>路由过滤器（Forward）</li> <li>路由过滤器（LoadBalancerClient）</li> <li>Netty路由过滤器</li> <li>Netty写响应过滤器（Netty Write Response F）</li> <li>RouteToRequestUrl 过滤器</li> <li>路由过滤器 (Websocket Routing Filter)</li> <li>网关指标过滤器（Gateway Metrics Filter)</li> <li>组合式全局过滤器和网关过滤器排序（Combined Global Filter and GatewayFilter Ordering）</li> <li>路由（Marking An Exchange As Routed）</li></ul> <p><strong>自定义全局过滤器:</strong></p> <p><img src="/javablog/public/assets/img/1718350659531.9c7456af.png" alt="1718350659531"></p> <p>开发中的鉴权逻辑:(对于验证用户是否已经登录及鉴权的过程，可以在网关统一校验)</p> <ul><li>当客户端第一次请求服务时，服务端对用户进行信息认证（登录）</li> <li>认证通过，将用户信息进行加密形成token，返回给客户端，作为登录凭证</li> <li>以后每次请求，客户端都携带认证的token</li> <li>服务端对token进行解密，判断是否有效。</li></ul> <p>下面我们通过自定义一个GlobalFIlter，去校验所有请求的请求参数中是否包含“token”，如果不包含请求参数“token”则不转发路由，否则执行正常逻辑。</p> <p><img src="/javablog/public/assets/img/1718351163248.40eeada3.png" alt="1718351163248"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 自定义全局过滤器，需要实现GlobalFilter和Ordered接口
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;鉴权失败。确少token参数。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;token无效...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 继续执行filter链</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 顺序，数值越小，优先级越高
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1718351344475.a16e5504.png" alt="1718351344475"></p> <h3 id="_12-解决跨域"><a href="#_12-解决跨域" class="header-anchor">#</a> 12, 解决跨域</h3> <p><strong>为什么会出现跨域问题：</strong></p> <p>出于浏览器的同源策略限制。同源策略是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说Web是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。</p> <p><strong>什么是跨域：</strong></p> <p>当一个请求url的<strong>协议、域名、端口</strong>三者之间任意一个与当前页面url不同即为跨域</p> <table><thead><tr><th><strong>当前页面url</strong></th> <th><strong>被请求页面url</strong></th> <th><strong>是否跨域</strong></th> <th><strong>原因</strong></th></tr></thead> <tbody><tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://www.test.com/index.html" target="_blank" rel="noopener noreferrer">http://www.test.com/index.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>否</td> <td>同源（协议、域名、端口号相同）</td></tr> <tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="https://www.test.com/index.html" target="_blank" rel="noopener noreferrer">https://www.test.com/index.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>协议不同（http/https）</td></tr> <tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://www.baidu.com/" target="_blank" rel="noopener noreferrer">http://www.baidu.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>主域名不同（test/baidu）</td></tr> <tr><td><a href="http://www.test.com/" target="_blank" rel="noopener noreferrer">http://www.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://blog.test.com/" target="_blank" rel="noopener noreferrer">http://blog.test.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>子域名不同（www/blog）</td></tr> <tr><td><a href="http://www.test.com:8080/" target="_blank" rel="noopener noreferrer">http://www.test.com:8080/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td><a href="http://www.test.com:7001/" target="_blank" rel="noopener noreferrer">http://www.test.com:7001/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>跨域</td> <td>端口号不同（8080/7001）</td></tr></tbody></table> <p>编写index页面：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://libs.baidu.com/jquery/2.0.0/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

  $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:9527/payment/lb?token=jack&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Data: &quot;</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">&quot;\nStatus: &quot;</span> <span class="token operator">+</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>出现问题：</p> <p><img src="/javablog/public/assets/img/1718351482040.86fb883a.png" alt="1718351482040"></p> <p>**Gateway解决如何允许跨域：**CORS</p> <ul><li>如何允许跨域，一种解决方法就是<strong>目的域告诉请求者允许什么来源域来请求</strong>，那么浏览器就会知道B域是否允许A域发起请求。</li> <li>CORS（&quot;跨域资源共享&quot;(Cross-origin resource sharing)）就是这样一种解决手段。</li></ul> <p>CORS使得浏览器在向目的域发起请求之前先发起一个OPTIONS方式的请求到目的域获取目的域的信息，比如获取目的域允许什么域来请求的信息。</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
     <span class="token key atrule">cors-configurations</span><span class="token punctuation">:</span>
      <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
       <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
       <span class="token key atrule">allowedOriginPatterns</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
       <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
       <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
     <span class="token key atrule">add-to-simple-url-handler-mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>配置：</p> <p><img src="/javablog/public/assets/img/1718597345981.1b56bbec.png" alt="1718597345981"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment"># Eureka server 地址</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka7002.com<span class="token punctuation">:</span>7002/eureka
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token comment">#根据需要自己起名字</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>gateway9527
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
        <span class="token key atrule">cors-configurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">allowedOriginPatterns</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
            <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
        <span class="token key atrule">add-to-simple-url-handler-mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token comment"># 路由ID，没有固定规则但要求唯一，建议配合服务名</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>openfeign<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
          <span class="token comment"># 匹配后提供服务的路由地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">80</span>
          <span class="token comment"># 断言</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token comment"># 路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Path=/order/*
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
          <span class="token comment"># # 匹配后提供服务的路由地址 lb后跟提供服务的微服务的名</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//CLOUD<span class="token punctuation">-</span>PAYMENT<span class="token punctuation">-</span>PROVIDER
          <span class="token comment"># 断言</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token comment"># 路径相匹配的进行路由</span>
            <span class="token punctuation">-</span> Path=/payment/*
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Log=true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="_13-实现用户鉴权-什么是jwt"><a href="#_13-实现用户鉴权-什么是jwt" class="header-anchor">#</a> 13, 实现用户鉴权_什么是JWT</h3> <p><strong>什么是JWT:</strong></p> <p>JWT是一种用于双方之间传递安全信息的简洁的、<a href="https://so.csdn.net/so/search?q=URL&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">URL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>安全的声明规范。定义了一种简洁的，自包含的方法用于通信双方之间以Json对象的形式安全的传递信息。特别适用于分布式站点的单点登录（SSO）场景。</p> <p><strong>传统的session认证:</strong></p> <p>每次提到无状态的 JWT 时相信都会看到另一种基于 Session 的用户认证方案介绍，这里也不例外，Session 的认证流程通常会像这样：</p> <p><img src="/javablog/public/assets/img/1718597513438.8d41c1e3.png" alt="1718597513438"></p> <p><strong>缺点：</strong></p> <ul><li><strong>安全性</strong>：CSRF攻击因为基于cookie来进行用户识别, cookie如果被截获，用户就会很容易受到跨站请求伪造的攻击。</li> <li><strong>扩展性</strong>：对于分布式应用，需要实现 session 数据共享</li> <li><strong>性能</strong>：每一个用户经过后端应用认证之后，后端应用都要在服务端做一次记录，以方便用户下次请求的鉴别，通常而言session都是保存在内存中，而随着认证用户的增多，服务端的开销会明显增大，与REST风格不匹配。因为它在一个无状态协议里注入了状态。</li></ul> <p><strong>JWT方式:</strong></p> <p><img src="/javablog/public/assets/img/1718597544289.3503bc5d.png" alt="1718597544289"></p> <p><strong>优点：</strong></p> <ul><li>无状态</li> <li>适合移动端应用</li> <li>单点登录友好</li></ul> <h3 id="_14-实现用户鉴权-jwt原理"><a href="#_14-实现用户鉴权-jwt原理" class="header-anchor">#</a> 14, 实现用户鉴权_JWT原理</h3> <p>JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
 &quot;姓名&quot;: &quot;张三&quot;,
 &quot;角色&quot;: &quot;管理员&quot;,
 &quot;到期时间&quot;: &quot;2030年7月1日0点0分&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。为了防止用户篡改数据，服务器在生成这个对象的时候会加上签名，服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。</p> <p><strong>JWT的结构:</strong></p> <p><img src="/javablog/public/assets/img/1718597601396.ec0c37fc.png" alt="1718597601396"></p> <p>它是一个很长的字符串，中间用点（<code>.</code>）分隔成三个部分。注意，JWT 内部是没有换行的，这里只是为了便于展示，将它写成了几行。JWT 的三个部分依次如下:</p> <ul><li>头部（header)</li> <li>载荷（payload)</li> <li>签证（signature)</li></ul> <p><strong>Header:</strong></p> <p>JSON对象，描述 JWT 的元数据。其中 alg 属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；typ 属性表示这个令牌（token）的类型（type），统一写为 JWT。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
 &quot;alg&quot;: &quot;HS256&quot;,
 &quot;typ&quot;: &quot;JWT&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面代码中，<code>alg</code>属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；<code>typ</code>属性表示这个令牌（token）的类型（type），JWT 令牌统一写为<code>JWT</code>然后将头部进行<strong>Base64编码</strong>构成了第一部分，Base64是一种用64个字符来表示任意二进制数据的方法，Base64是一种任意二进制到文本字符串的编码方法，常用于在URL、Cookie、网页中传输少量二进制数据。</p> <p><strong>Payload:</strong></p> <p><strong>内容又可以分为3种标准</strong></p> <ul><li><p>标准中注册的声明</p></li> <li><p>公共的声明</p></li> <li><p>私有的声明</p></li></ul> <p><strong>payload-标准中注册的声明 (建议但不强制使用) ：</strong></p> <ul><li><strong>iss</strong>: jwt签发者</li> <li><strong>sub</strong>: jwt所面向的用户</li> <li><strong>aud</strong>: 接收jwt的一方</li> <li><strong>exp</strong>: jwt的过期时间，这个过期时间必须要大于签发时间</li> <li><strong>nbf</strong>: 定义在什么时间之前，该jwt都是不可用的.</li> <li><strong>iat</strong>: jwt的签发时间</li> <li><strong>jti</strong>: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</li></ul> <p><strong>payload-公共的声明 ：</strong></p> <p>公共的声明可以添加任何的信息。一般这里我们会存放一下用户的基本信息（非敏感信息）。</p> <p><strong>payload-私有的声明 ：</strong></p> <p>私有声明是提供者和消费者所共同定义的声明。需要注意的是，<strong>不要存放敏感信息，不要存放敏感信息，不要存放敏感信息</strong>！！！</p> <p>因为：这里<strong>也是base64编码，任何人获取到jwt之后都可以解码！！</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
 &quot;sub&quot;: &quot;1234567890&quot;,
 &quot;name&quot;: &quot;John Doe&quot;,
 &quot;iat&quot;: 1516239022
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>sub和iat是标准声明，分别代表所面向的用户和jwt签发时间。</p> <ul><li><strong>sub</strong>：这个是发给一个账号是1234567890的用户（也许是ID）</li> <li><strong>name</strong>：名字叫John Doe</li> <li><strong>iat</strong>：签发时间是1516239022（2030/1/18 9:30:22）</li></ul> <p><strong>Signature:</strong></p> <p>这部分就是 JWT 防篡改的精髓，其值是对前两部分base64UrlEncode 后使用指定算法签名生成，以默认 HS256 为例，指定一个密钥（secret），就会按照如下公式生成：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>HMACSHA256(
 base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload),
 secret,
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用&quot;点&quot;（<code>.</code>）分隔，就可以返回给用户。</p> <p><img src="/javablog/public/assets/img/1718597878653.68287163.png" alt="1718597878653"></p> <p><strong>JWT 的使用方式:</strong></p> <p><img src="/javablog/public/assets/img/1718597791502.af5e314c.png" alt="1718597791502"></p> <p>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。此后，客户端每次与服务器通信，都要带上这个 JWT。你可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以更好的做法是放在 HTTP 请求的头信息<code>Authorization</code>字段里面。</p> <h3 id="_15-实现用户鉴权-用户微服务"><a href="#_15-实现用户鉴权-用户微服务" class="header-anchor">#</a> 15, 实现用户鉴权_用户微服务</h3> <p>创建cloud-auth-user6500工程：</p> <p><img src="/javablog/public/assets/img/1718598029020.04a86dac.png" alt="1718598029020"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- redis --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- eureka client 依赖 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_16-实现用户鉴权-jwt工具类"><a href="#_16-实现用户鉴权-jwt工具类" class="header-anchor">#</a> 16, 实现用户鉴权_JWT工具类</h3> <p>引入JWT依赖:</p> <p><img src="/javablog/public/assets/img/1718598208258.5bc2ae13.png" alt="1718598208258"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.79<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.auth0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>java-jwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>创建JWT工具类JWTUtils:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTUtil</span> <span class="token punctuation">{</span>
  <span class="token comment">// 秘钥</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;erbadagang-123456&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// token过期时间</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">TOKEN_EXPIRE_TIME</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token comment">// 签发人</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ISSUER</span> <span class="token operator">=</span> <span class="token string">&quot;issuer&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 用户名</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>生成签名方法:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">token</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
    <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 签发人</span>
         <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
        <span class="token comment">// 签发时间</span>
         <span class="token punctuation">.</span><span class="token function">withIssuedAt</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>
        <span class="token comment">// 过期时间</span>
         <span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">TOKEN_EXPIRE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 保存权限标记</span>
         <span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span><span class="token constant">USER_NAME</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>


    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;jwt generated user={}&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> token<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>验证签名:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
      <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">JWTVerifier</span> verifier <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//如果校验有问题会抛出异常。</span>
      verifier<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>测试JWT:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token comment">// 生成Token</span>
    <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">JWTUtil</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token string">&quot;ityls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//验证Token</span>
    <span class="token keyword">boolean</span> verify <span class="token operator">=</span> <span class="token class-name">JWTUtil</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJpc3N1ZXIiLCJleHAiOjE2NDUwNjMyNzYsImlhdCI6MTY0NTA2Mjk3NiwidXNlcm5hbWUiOiJpdGJhaXpoYW4ifQ.uKKVEMCTW0-e_bPHLyb-JY8CwRU7ciU8vP5B78lDY3s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>verify<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>完整代码：</p> <p><img src="/javablog/public/assets/img/1718598488481.a3232109.png" alt="1718598488481"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTUtil</span> <span class="token punctuation">{</span>
    <span class="token comment">// 秘钥</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;erbadagang-123456&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// token过期时间</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">TOKEN_EXPIRE_TIME</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token comment">// 签发人</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ISSUER</span> <span class="token operator">=</span> <span class="token string">&quot;issuer&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 用户名</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">token</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
        <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 签发人</span>
                <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
                <span class="token comment">// 签发时间</span>
                <span class="token punctuation">.</span><span class="token function">withIssuedAt</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>
                <span class="token comment">// 过期时间</span>
                <span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">TOKEN_EXPIRE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 保存权限标记</span>
                <span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span><span class="token constant">USER_NAME</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;jwt generated user={}&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> token<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
            <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">JWTVerifier</span> verifier <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//如果校验有问题会抛出异常。</span>
            verifier<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 生成Token</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">JWTUtil</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token string">&quot;ityls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//验证Token</span>
        <span class="token keyword">boolean</span> verify <span class="token operator">=</span> <span class="token class-name">JWTUtil</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJpc3N1ZXIiLCJleHAiOjE3MTg1OTg3MzksImlhdCI6MTcxODU5ODQzOSwidXNlcm5hbWUiOiJpdHlscyJ9.bqR54UZGcAey9qyj0cK3Xzh7HCzeBg90e-e4TaKJkGA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>verify<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="_17-实现用户鉴权-用户服务实现jwt鉴权"><a href="#_17-实现用户鉴权-用户服务实现jwt鉴权" class="header-anchor">#</a> 17, 实现用户鉴权_用户服务实现JWT鉴权</h3> <p>配置：</p> <p><img src="/javablog/public/assets/img/1718599191655.ec67db2b.png" alt="1718599191655"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6500</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token comment"># 实例名字</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>auth<span class="token punctuation">-</span>user6500
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment"># 指定单机eureka server地址</span>
      <span class="token comment">#defaultZone: http://localhost:7001/eureka/</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7002/eureka/
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>auth<span class="token punctuation">-</span>user
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>启动类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 主启动类
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMain6500</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">UserMain6500</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;************** UserMain6500 启动成功 **********&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>统一返回实体类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 统一返回实体类
 */</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span>

    <span class="token comment">// 返回状态码</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>

    <span class="token comment">// 返回描述信息</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

    <span class="token comment">// 返回token信息 令牌</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> token<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>controller:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用户控制层
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 登录
     * @param username 用户名
     * @param password 密码
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1. 验证用户名和密码</span>
        <span class="token comment">// TODO 模拟数据库操作</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 2. 生成令牌</span>
            <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">JWTUtil</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span>  <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">&quot;succes&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>  <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">&quot;用户名或密码不正确&quot;</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>工具类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTUtil</span> <span class="token punctuation">{</span>
    <span class="token comment">// 秘钥</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;erbadagang-123456&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// token过期时间</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">TOKEN_EXPIRE_TIME</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token comment">// 签发人</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ISSUER</span> <span class="token operator">=</span> <span class="token string">&quot;issuer&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 用户名</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// public static String token(String username) {</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
        <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 签发人</span>
                <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
                <span class="token comment">// 签发时间</span>
                <span class="token punctuation">.</span><span class="token function">withIssuedAt</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>
                <span class="token comment">// 过期时间</span>
                <span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">TOKEN_EXPIRE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 保存权限标记</span>
                <span class="token comment">// .withClaim(USER_NAME, username)</span>
                <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// log.info(&quot;jwt generated user={}&quot;, username);</span>
        <span class="token keyword">return</span> token<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
            <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">JWTVerifier</span> verifier <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//如果校验有问题会抛出异常。</span>
            verifier<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 生成Token</span>
        <span class="token comment">// String token = JWTUtil.token(&quot;ityls&quot;);</span>
        <span class="token comment">// System.out.println(token);</span>

        <span class="token comment">//验证Token</span>
        <span class="token comment">// boolean verify = JWTUtil.verify(&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJpc3N1ZXIiLCJleHAiOjE3MTg1OTg3MzksImlhdCI6MTcxODU5ODQzOSwidXNlcm5hbWUiOiJpdHlscyJ9.bqR54UZGcAey9qyj0cK3Xzh7HCzeBg90e-e4TaKJkGA&quot;);</span>
        <span class="token comment">// System.out.println(verify);</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1718599291260.547eb1bc.png" alt="1718599291260"></p> <h3 id="_18-实现用户鉴权-网关过滤器加入jwt鉴权"><a href="#_18-实现用户鉴权-网关过滤器加入jwt鉴权" class="header-anchor">#</a> 18, 实现用户鉴权_网关过滤器加入JWT鉴权</h3> <p><img src="/javablog/public/assets/img/1718599366949.3c963903.png" alt="1718599366949"></p> <p>配置路由：</p> <p><img src="/javablog/public/assets/img/1718599725909.264fc044.png" alt="1718599725909"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>auth<span class="token punctuation">-</span>user
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//CLOUD<span class="token punctuation">-</span>AUTH<span class="token punctuation">-</span>USER
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/user/*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注释掉之前的全局过滤器：</p> <p><img src="/javablog/public/assets/img/1718599765397.05c1cdf8.png" alt="1718599765397"></p> <p>测试：</p> <p><img src="/javablog/public/assets/img/1718599775487.cdbf5d44.png" alt="1718599775487"></p> <p>依赖：</p> <p><img src="/javablog/public/assets/img/1718600091407.e7b0810f.png" alt="1718600091407"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.79<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.auth0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>java-jwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>返回信息：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 返回信息
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Response</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>工具类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>auth0<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span></span><span class="token class-name">JWT</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>auth0<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span></span><span class="token class-name">JWTVerifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>auth0<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span>algorithms<span class="token punctuation">.</span></span><span class="token class-name">Algorithm</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">// 秘钥</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;erbadagang-123456&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// token过期时间</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">TOKEN_EXPIRE_TIME</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token comment">// 签发人</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ISSUER</span> <span class="token operator">=</span> <span class="token string">&quot;issuer&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 用户名</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// public static String token(String username) {</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
        <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 签发人</span>
                <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
                <span class="token comment">// 签发时间</span>
                <span class="token punctuation">.</span><span class="token function">withIssuedAt</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>
                <span class="token comment">// 过期时间</span>
                <span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">TOKEN_EXPIRE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 保存权限标记</span>
                <span class="token comment">// .withClaim(USER_NAME, username)</span>
                <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// log.info(&quot;jwt generated user={}&quot;, username);</span>
        <span class="token keyword">return</span> token<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//SECRET_KEY是用来加密数据签名秘钥</span>
            <span class="token class-name">Algorithm</span> algorithm <span class="token operator">=</span> <span class="token class-name">Algorithm</span><span class="token punctuation">.</span><span class="token function">HMAC256</span><span class="token punctuation">(</span><span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">JWTVerifier</span> verifier <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span><span class="token constant">ISSUER</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//如果校验有问题会抛出异常。</span>
            verifier<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 生成Token</span>
        <span class="token comment">// String token = JWTUtil.token(&quot;ityls&quot;);</span>
        <span class="token comment">// System.out.println(token);</span>

        <span class="token comment">//验证Token</span>
        <span class="token comment">// boolean verify = JWTUtil.verify(&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJpc3N1ZXIiLCJleHAiOjE3MTg1OTg3MzksImlhdCI6MTcxODU5ODQzOSwidXNlcm5hbWUiOiJpdHlscyJ9.bqR54UZGcAey9qyj0cK3Xzh7HCzeBg90e-e4TaKJkGA&quot;);</span>
        <span class="token comment">// System.out.println(verify);</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>哪些路径需要跳过：</p> <p><img src="/javablog/public/assets/img/1718600507441.c303caaa.png" alt="1718600507441"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">org</span><span class="token punctuation">:</span>
  <span class="token key atrule">my</span><span class="token punctuation">:</span>
    <span class="token key atrule">jwt</span><span class="token punctuation">:</span>
      <span class="token comment">#跳过认证的路由</span>
      <span class="token key atrule">skipAuthUrls</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> /user/login
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>创建用户鉴权全局过滤器：</p> <p><img src="/javablog/public/assets/img/1718600321662.7123da1f.png" alt="1718600321662"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">Response</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">JWTUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">DataBuffer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Flux</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>

<span class="token comment">/**\
* 用户鉴权全局过滤器
*/</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;org.my.jwt&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAuthGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> skipAuthUrls<span class="token punctuation">;</span>

   <span class="token comment">/**
    * 过滤器逻辑
    * @param exchange
    * @param chain
    * @return
    */</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token comment">// user/login</span>
       <span class="token comment">// 获取请求url地址</span>
       <span class="token class-name">String</span> path <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">// 跳过不需要验证的路径</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> skipAuthUrls <span class="token operator">&amp;&amp;</span> <span class="token function">isSkip</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// 1. 从请求头中获取token</span>
       <span class="token class-name">String</span> token <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// 2. 判断token</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">// 3. 设置响应</span>
           <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 4. 设置响应状态码</span>
           response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 5. 设置响应头</span>
           response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 6. 创建响应对象</span>
           <span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;token 参数缺失&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 7. 对象转字符串</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 8. 数据流返回数据</span>
           <span class="token class-name">DataBuffer</span> wrap <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">bufferFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">writeWith</span><span class="token punctuation">(</span><span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>wrap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// 验证token</span>
       <span class="token keyword">boolean</span> verify <span class="token operator">=</span> <span class="token class-name">JWTUtils</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>verify<span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">// 3. 设置响应</span>
           <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 4. 设置响应状态码</span>
           response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 5. 设置响应头</span>
           response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 6. 创建响应对象</span>
           <span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;token 失效&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 7. 对象转字符串</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 8. 数据流返回数据</span>
           <span class="token class-name">DataBuffer</span> wrap <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">bufferFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">writeWith</span><span class="token punctuation">(</span><span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>wrap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// 如果各种判断都通过。。</span>
       <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isSkip</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> skipurl <span class="token operator">:</span>skipAuthUrls<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>skipurl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br></div></div><p>测试：</p> <p><img src="/javablog/public/assets/img/1718600620824.b6f24461.png" alt="1718600620824"></p> <p><img src="/javablog/public/assets/img/1718600732254.f39a9a61.png" alt="1718600732254"></p> <p><img src="/javablog/public/assets/img/1718601788917.347fad7f.png" alt="1718601788917"></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/17/2024, 5:33:44 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_1-网关在微服务中的应用" class="sidebar-link reco-side-_1-网关在微服务中的应用" data-v-b57cc07c>1, 网关在微服务中的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_2-三个核心概念" class="sidebar-link reco-side-_2-三个核心概念" data-v-b57cc07c>2, 三个核心概念</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_3-入门案例" class="sidebar-link reco-side-_3-入门案例" data-v-b57cc07c>3, 入门案例</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_4-java-api构建路由" class="sidebar-link reco-side-_4-java-api构建路由" data-v-b57cc07c>4, JAVA API构建路由</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_5-路由规则" class="sidebar-link reco-side-_5-路由规则" data-v-b57cc07c>5, 路由规则</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_6-动态路由" class="sidebar-link reco-side-_6-动态路由" data-v-b57cc07c>6, 动态路由</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_7-断言" class="sidebar-link reco-side-_7-断言" data-v-b57cc07c>7, 断言</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_8-过滤器" class="sidebar-link reco-side-_8-过滤器" data-v-b57cc07c>8, 过滤器</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_9-网关过滤器" class="sidebar-link reco-side-_9-网关过滤器" data-v-b57cc07c>9, 网关过滤器</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_10-自定义网关过滤器" class="sidebar-link reco-side-_10-自定义网关过滤器" data-v-b57cc07c>10, 自定义网关过滤器</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_11-自定义全局网关过滤器" class="sidebar-link reco-side-_11-自定义全局网关过滤器" data-v-b57cc07c>11, 自定义全局网关过滤器</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_12-解决跨域" class="sidebar-link reco-side-_12-解决跨域" data-v-b57cc07c>12, 解决跨域</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_13-实现用户鉴权-什么是jwt" class="sidebar-link reco-side-_13-实现用户鉴权-什么是jwt" data-v-b57cc07c>13, 实现用户鉴权_什么是JWT</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_14-实现用户鉴权-jwt原理" class="sidebar-link reco-side-_14-实现用户鉴权-jwt原理" data-v-b57cc07c>14, 实现用户鉴权_JWT原理</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_15-实现用户鉴权-用户微服务" class="sidebar-link reco-side-_15-实现用户鉴权-用户微服务" data-v-b57cc07c>15, 实现用户鉴权_用户微服务</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_16-实现用户鉴权-jwt工具类" class="sidebar-link reco-side-_16-实现用户鉴权-jwt工具类" data-v-b57cc07c>16, 实现用户鉴权_JWT工具类</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_17-实现用户鉴权-用户服务实现jwt鉴权" class="sidebar-link reco-side-_17-实现用户鉴权-用户服务实现jwt鉴权" data-v-b57cc07c>17, 实现用户鉴权_用户服务实现JWT鉴权</a></li><li class="level-3" data-v-b57cc07c><a href="/javablog/public/blogs/springcloud/Gateway/Gateway.html#_18-实现用户鉴权-网关过滤器加入jwt鉴权" class="sidebar-link reco-side-_18-实现用户鉴权-网关过滤器加入jwt鉴权" data-v-b57cc07c>18, 实现用户鉴权_网关过滤器加入JWT鉴权</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/javablog/public/assets/js/app.e7970ae7.js" defer></script><script src="/javablog/public/assets/js/91.b7a84495.js" defer></script><script src="/javablog/public/assets/js/1.8cfd729d.js" defer></script><script src="/javablog/public/assets/js/66.d37dcd18.js" defer></script>
  </body>
</html>
